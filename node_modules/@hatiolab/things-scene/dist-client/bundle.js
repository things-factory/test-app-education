!function(t){function e(e){for(var n,a,o=e[0],l=e[1],h=e[2],d=0,u=[];d<o.length;d++)a=o[d],i[a]&&u.push(i[a][0]),i[a]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);for(c&&c(e);u.length;)u.shift()();return s.push.apply(s,h||[]),r()}function r(){for(var t,e=0;e<s.length;e++){for(var r=s[e],n=!0,o=1;o<r.length;o++){var l=r[o];0!==i[l]&&(n=!1)}n&&(s.splice(e--,1),t=a(a.s=r[0]))}return t}var n={},i={1:0},s=[];function a(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=n,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/dist-client";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var h=0;h<o.length;h++)e(o[h]);var c=l;s.push([120,0]),r()}({0:function(t,e,r){"use strict";r.d(e,"b",function(){return n}),r.d(e,"c",function(){return i}),r.d(e,"a",function(){return s});"undefined"==typeof window||window;var n=(...t)=>{var e=[];t.forEach(t=>t&&t.stack&&e.push(t.stack)),console.error("[ERROR]",...t,e.join(" "))},i=(...t)=>{var e=[];t.forEach(t=>t&&t.stack&&e.push(t.stack)),console.warn("[WARN]",...t,e.join(" "))},s=(...t)=>console.log("[DEBUG]",...t)},113:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return buildEvaluator});var _core_logger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_core_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2);function tostring(t){var e=Object(_core_utils__WEBPACK_IMPORTED_MODULE_1__.e)(t);return null==e?"":String(e)}function tonumber(t){return Number(Object(_core_utils__WEBPACK_IMPORTED_MODULE_1__.e)(t))}function value(t){return t}function valueString(t){return tostring(t)}function valueNumber(t){return tonumber(t)}function map(t){if(this.param)return t=tostring(t),this.param.hasOwnProperty(t)?this.param[t]:this.param.default}function range(t){var{param:e}=this;if(e){for(let r in e){let[n,i]=r.split("~"),s=!!n,a=!!i;if(n=parseFloat(n),i=parseFloat(i),t=tonumber(t),s&&!a&&t>=n)return e[r];if(!s&&a&&t<n)return e[r];if(t>=n&&t<i)return e[r]}return e.default}}function radian(t){return tonumber(t)*Math.PI/180}function noop(){}function build(script){var evaluator;try{return eval(`evaluator = function(value, targets) {${script}}`),evaluator}catch(t){return Object(_core_logger__WEBPACK_IMPORTED_MODULE_0__.b)(t),noop}}function buildEvaluator(t,e,r,n,i){switch(r){case"value":return"text"===i||"string"===i?valueString.bind(t):"number"===i?valueNumber.bind(t):value.bind(e);case"map":return map.bind(t);case"range":return range.bind(t);case"radian":return radian.bind(t);case"eval":return build(n).bind(e);default:return value.bind(e)}}},12:function(t,e,r){"use strict";(function(t){r.d(e,"a",function(){return h}),r.d(e,"b",function(){return d});const n="hatio lab.",i="UNLIMITED",s="Production";var a={},o=!1,l=!1;class h{static get certified(){if(l)return l;if(!h.key)return!1;try{for(var t=Number(h.key.charAt(0)),e=Number(h.key.substring(h.key.length-t)),r=h.key.substring(1,h.key.length-t),n=0,i=0;i<r.length;i++)n+=r.charCodeAt(i);return n===e&&(a=JSON.parse(atob(r)),l=!0)}catch(t){return console.error("license invalid"),!1}}static get key(){return h._key}static set key(t){h._key=t,o=!1,l=!1}static get licenseType(){return a["License Type"]}static get expirationDate(){var t=a["Expiration Date"]||"";return t==i?t:new Date(t.replace(/\./g,"-"))}static get hostname(){return a.Hostname}static get licenseKey(){return a.Key}static get baseUrl(){return h._baseUrl||""}static set baseUrl(t){h._baseUrl=t}static isHostnameValid(){var t=location.hostname;if(""===t)return!0;for(var e=h.hostname.split(","),r=0;r<e.length;r++){if(h.matchLicenseHost(e[r].trim(),h.baseUrl))return!0;if(h.matchLicenseHost(e[r].trim(),t))return!0}return!1}static matchLicenseHost(t,e){if((e="127.0.0.1"==e?"localhost":e)==(t="127.0.0.1"==t?"localhost":t))return"localhost"!=t||h.licenseType!=s;var r=t.split("."),n=e.split(".");if(r.length==n.length){for(var i=0;i<r.length;i++){var a=r[i],o=n[i];if(!("*"==a||a==o))return!1}return!0}return!1}static isUnlimited(){return h.expirationDate==i}static isUnexpired(){if(h.isUnlimited())return!0;var t=new Date;return h.expirationDate>t}static isKeyValid(){JSON.stringify(a,null," ");return a.Key==function(t,e){var r=JSON.parse(JSON.stringify(t));delete r.Key;var n=c(JSON.stringify(r)),i=[];return n.split("").forEach((t,r)=>{i.push(String.fromCharCode(Math.abs(t.charCodeAt()-e[r%e.length].charCodeAt())))}),c(i.join(""))}(a,n)}static get valid(){return!!h.certified&&(o||(o=h.isKeyValid()&&h.isHostnameValid()&&h.isUnexpired()),o)}}function c(e){return new t(e).toString("base64")}function d(t){h.key=t}}).call(this,r(232).Buffer)},120:function(t,e,r){t.exports=r(240)},2:function(t,e,r){"use strict";r.d(e,"a",function(){return u}),r.d(e,"d",function(){return p}),r.d(e,"h",function(){return f}),r.d(e,"e",function(){return g});var n=r(41),i=r.n(n);r.d(e,"b",function(){return i.a});var s=r(77),a=r.n(s);r.d(e,"g",function(){return a.a});var o=r(78),l=r.n(o);r.d(e,"f",function(){return l.a});var h=r(79),c=r.n(h);r.d(e,"c",function(){return c.a});var d=0;function u(t){return JSON.parse(JSON.stringify(t))}function p(t={},...e){return"object"!=typeof t&&(t={}),e.forEach(e=>{for(let r in e)"object"!=typeof e[r]?t[r]=e[r]:e[r].length>0?t[r]=e[r].map(t=>{let n;return n="object"!=typeof e[r]?t:p({},t)}):t[r]=p(t[r],e[r])}),t}function f(t){return`${t||""}${++d}`}function g(t){for(;t&&"object"==typeof t;){let e=t;for(let e in t){t=t[e];break}if(t===e){t=void 0;break}}return t}},29:function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"insertAt",function(){return x}),r.d(n,"append",function(){return _}),r.d(n,"prepend",function(){return b}),r.d(n,"remove",function(){return w}),r.d(n,"getAt",function(){return A}),r.d(n,"forEach",function(){return E}),r.d(n,"indexOf",function(){return k}),r.d(n,"size",function(){return S}),r.d(n,"clear",function(){return M}),r.d(n,"moveForward",function(){return P}),r.d(n,"moveBackward",function(){return T}),r.d(n,"moveToHead",function(){return C}),r.d(n,"moveToTail",function(){return I});var i={};r.r(i),r.d(i,"push",function(){return O}),r.d(i,"pop",function(){return R});var s={};r.r(s),r.d(s,"hide",function(){return nr}),r.d(s,"show",function(){return ir});var a={};r.r(a),r.d(a,"compile",function(){return ci}),r.d(a,"duplicate",function(){return De}),r.d(a,"select",function(){return y}),r.d(a,"match",function(){return g});"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e}),"function"!=typeof Object.values&&(Object.values=function(t){let e=[];for(let r in t)e.push(t[r]);return e}),"function"!=typeof Object.keys&&(Object.values=function(t){let e=[];for(let r in t)e.push(r);return e}),"undefined"!=typeof CanvasRenderingContext2D&&null==CanvasRenderingContext2D.prototype.ellipse&&(CanvasRenderingContext2D.prototype.ellipse=function(t,e,r,n,i,s,a,o){this.save(),this.translate(t,e),this.rotate(i),this.translate(-r,-n),this.scale(r,n),this.arc(1,1,1,s,a,o),this.restore()}),function(){for(var t=0,e=["ms","moz","webkit","o"],r=0;r<e.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[e[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[r]+"CancelAnimationFrame"]||window[e[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(console.warn("requestAnimationFrame not supported"),window.requestAnimationFrame=function(e,r){var n=performance.now(),i=Math.max(0,33-(n-t)),s=window.setTimeout(function(){e(n+i)},i);return t=n+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.substr(e,t.length)===t});var o=o||function(){return class{get(){}set(){}has(){}delete(){}}}(),l=l||function(){return class{add(){}}}(),h=r(44),c=r.n(h),d=r(112),u=r.n(d);function p(t,e,r,n){var i=e.get("class");return!!i&&(i.split(" ")||[]).indexOf(t.substr(1))>=0}function f(t,e,r,n){return t==e.get("type")}function g(t,e,r,n){if("(all)"==t)return!0;switch(t.charAt(0)){case"#":return function(t,e,r,n){return t.substr(1)==e.get("id")}(t,e);case".":return p(t,e);case"(":return function(t,e,r,n){switch(t){case"(all)":return!0;case"(self)":return n===e;case"(root)":return!n.parent&&n===e;case"(descendant)":return n!==e;case"(child)":return n===e.parent;default:return!1}}(t,e,0,n);default:return f(t,e)}}function m(t,e,r,n){switch(t){case"(all)":return!0;case"(parent)":return r&&r.parent===e;case"(child)":case"(children)":return r&&r===e.parent;case"(sibling)":case"(siblings)":return r&&r.parent===e.parent&&r!==e;default:return!1}}function y(t,e,r){if("(root)"==t)return[e];if("(self)"==t)return r?[r]:[];var n;switch(t.charAt(0)){case"#":let r=e.root.findById(t.substr(1));return r?[r]:[];case".":n=p;break;case"(":n=m;break;default:n=f}return function t(e,r,n,i,s,a){return e(r,n,i,s)&&a.push(n),n.components&&n.components.forEach(n=>{t(e,r,n,i,s,a)}),a}(n,t,e,r,e,[])}var v=r(2);function x(t,e){return this.__collection__?(-1==(t=this.__collection__.indexOf(e))&&this.__collection__.splice(t,0,e),this):this}function _(t){return this.__collection__||(this.__collection__=[]),-1==this.__collection__.indexOf(t)&&this.__collection__.push(t),this}function b(t){return this.__collection__||(this.__collection__=[]),-1==this.__collection__.indexOf(t)&&this.__collection__.unshift(t),this}function w(t){if(!this.__collection__)return this;var e=this.__collection__.indexOf(t);return e>=0&&this.__collection__.splice(e,1),this}function A(t){if(this.__collection__)return this.__collection__[t]}function E(t,e){this.__collection__&&this.__collection__.forEach(t,e)}function k(t){if(this.__collection__)return this.__collection__.indexOf(t)}function S(){return this.__collection__?this.__collection__.length:0}function M(){this.__collection__=[]}function P(t){var e=this.indexOf(t);-1!=e&&0!=e&&(this.__collection__[e]=this.__collection__[e-1],this.__collection__[e-1]=t)}function T(t){var e=this.indexOf(t);-1!=e&&e!=this.size()-1&&(this.__collection__[e]=this.__collection__[e+1],this.__collection__[e+1]=t)}function C(t){var e=this.indexOf(t);if(-1!=e&&0!=e){var r=this.__collection__.splice(0,e),n=this.__collection__.splice(1);this.__collection__=this.__collection__.concat(r,n)}}function I(t){var e=this.indexOf(t);if(-1!=e&&e!=this.size()-1){var r=this.__collection__.splice(0,e),n=this.__collection__.splice(1);this.__collection__=r.concat(n,this.__collection__)}}function O(t){throw new Error("Not Implemented Yet")}function R(t){throw new Error("Not Implemented Yet")}function B(){}B.prototype=n;var L=/\s+/;function D(t,e,r,n){if(!r)return!0;if("object"==typeof r){for(let n in r){let i=r[n];t[e].apply(t,[n,i])}return!1}return!L.test(r)||(r.split(L).forEach(r=>t[e].apply(t,[r].concat(n))),!1)}const H=["on","off","once","delegate_on","delegate_off","trigger","listenTo"];var F={withEvent:function(){H.forEach(t=>this[t]=F[t])},on:function(t,e,r){return D(this,"on",t,[e,r])&&e?(this._listeners||(this._listeners={}),(this._listeners[t]||(this._listeners[t]=[])).push({callback:e,context:r,ctx:r||this}),this):this},once:function(t,e,r){if(!D(this,"once",t,[e,r])||!e)return this;var n=this,i=v.f(function(){n.off(t,i),e.apply(n,arguments)});i._callback=e,this.on(t,i,r)},off:function(t,e,r){if(!this._listeners||!D(this,"off",t,[e,r]))return this;if(!t&&!e&&!r)return this._listeners=void 0,this;var n;n=t?[t]:Object.keys(this._listeners);for(let t=0;t<n.length;t++){let i=n[t],s=this._listeners[i];if(s){let t=[];if(this._listeners[i]=t,e||r)for(let n=0;n<s.length;n++){let i=s[n];(e&&e!==i.callback&&e!==i.callback._callback||r&&r!==i.context)&&t.push(i)}t.length||delete this._listeners[i]}}return this},delegate_on:function(t){return this._delegators||(this._delegators=new B),this._delegators.append(t),this},delegate_off:function(t){return this._delegators?(this._delegators.remove(t),this):this},delegate:function(){if(this._delegators&&this._delegators.size()>0&&Y(this._delegators,arguments),!this._listeners)return this;var t=arguments.length-1,e=arguments[t];arguments[t]={origin:e.origin,name:e.name,deliverer:this};var r=this._listeners[e.name],n=this._listeners["(all)"];return r&&N(r,arguments),n&&N(n,arguments),this},trigger:function(t){var e=[].slice.call(arguments,1);if(e.push({origin:this,name:t,deliverer:this}),this._delegators&&this._delegators.size()>0&&Y(this._delegators,e),!this._listeners)return this;if(!D(this,"trigger",t,e))return this;var r=this._listeners[t],n=this._listeners["(all)"];return r&&N(r,e),n&&N(n,e),this},stopListening:function(t,e,r){var n=this._listeningTo;if(!n)return this;var i=!e&&!r;r||"object"!=typeof e||(r=this),t&&((n={})[t._listenId]=t);for(let t in n){let s=n[t];s.off(e,r,this),(i||v.c(s._events))&&delete this._listeningTo[t]}return this}};function N(t,e){t.forEach(t=>t.callback.apply(t.ctx,e))}function Y(t,e){t.forEach(t=>F.delegate.apply(t,e))}var j={listenTo:"on",listenToOnce:"once"};for(let t in j){var z=j[t];F[t]=function(t,e,r){this._listeningTo||(this._listeningTo={});var n=this._listeningTo;return t._listenId||(t._listenId=v.h("l")),n[t._listenId]=t,r||"object"!=typeof e||(r=this),t[z](e,r,this),this}}var W=F;function G(t,e){if(e instanceof Array)e.forEach(e=>G(t,e));else{if(t.mixedIn=t.hasOwnProperty("mixedIn")?t.mixedIn:[],t.mixingIn=t.hasOwnProperty("mixingIn")?t.mixingIn:[],t.mixedIn.indexOf(e)>=0)return t;if(t.mixingIn.indexOf(e)>=0)throw new Error(`found cyclic dependencies between ${t.mixingIn}`);t.mixingIn.push(e),e.call(t),t.mixingIn.pop(),t.mixedIn.push(e)}return t}var U={linear:function(t){return t},quad:function(t){return Math.pow(t,2)},circ:function(t){return 1-Math.sin(Math.acos(t))},back:function(t,e={x:1.5}){return Math.pow(t,2)*((e.x+1)*t-e.x)},bounce:function(t){for(let e=0,r=1;;e+=r,r/=2)if(t>=(7-4*e)/11)return-Math.pow((11-6*e-11*t)/4,2)+Math.pow(r,2)},elastic:function(t,e={x:1.5}){return Math.pow(2,10*(t-1))*Math.cos(20*Math.PI*e.x/3*t)}};class X{constructor(t,e){this.client=t,this.config=e,this._started=!1;var{delta:r="linear",options:n,ease:i}=this.config;"string"==typeof r&&(r=U[r]),this.delta="out"==i?function(t,e){return function(r){return 1-t(1-r,e)}}(r,n):"inout"==i?function(t,e){return function(r){return r<.5?t(2*r,e)/2:(2-t(2*(1-r),e))/2}}(r,n):r,this.init()}dispose(){this.stop(),delete this.client}init(){}start(){if(!this._started){var{duration:t=2e3,delay:e=0,repeat:r=!1}=this.config;this._started=!0,setTimeout(()=>{let n=0,i=()=>{if(!this._started)return;0==n&&(n=performance.now(),this.client.touch());let s=performance.now()-n,a=e/t,o=s/t,l=r?o%(1+a):Math.min(o,1);l=Math.max(l-a,0),this.step(this.delta(l)),this.client&&this.client.invalidate(),!(o>=1)||r&&this._started||(this.stop(),n=0),this._started&&(this._raf=requestAnimationFrame(i))};this._raf=requestAnimationFrame(i)},0)}}stop(){this._raf&&cancelAnimationFrame(this._raf),this._raf=null,this._started=!1}get started(){return this._started}set started(t){this.started!=!!t&&(t?this.start():this.stop())}}var q={rotation:class extends X{step(t){var{theta:e=6.28}=this.config;this.client.delta("theta",t*e)}},vibration:class extends X{step(t){var{theta:e=.2617993877991494}=this.config,r=4*e,n=t*r;t<.25?n*=-1:t<.75?n-=2*e:n=r-n,this.client.delta("theta",n)}},heartbeat:class extends X{step(t){var e,{scale:r=1.3}=this.config,n=2*(r-1);e=t<.5?1+n*t:1+(1-t)*n,this.client.delta("sx",e),this.client.delta("sy",e)}},moving:class extends X{step(t){var{x:e=0,y:r=0}=this.config;this.client.delta("tx",t*e),this.client.delta("ty",t*r)}},outline:class extends X{step(t){var{rideOn:e}=this.config,r=this.client;if(e&&r&&r.root){var n=r.center,i=r.root.findById(e);if(i){var s=i.outline(t);n=r.transcoordS2T(n.x,n.y),i&&(r.delta("tx",s.x-n.x),r.delta("ty",s.y-n.y))}}}},fade:class extends X{step(t){var e,{startAlpha:r=1,endAlpha:n=0}=this.config,i=r>n?n:r,s=2*((r<n?n:r)-i);e=t<.5?1-(i+t*s):1-(i+(1-t)*s),this.client.delta("fade",e)}}};const Q={x:1,y:1};function V(t,e,r){var{left:n=0,top:i=0,blurSize:s=0,color:a="transparent"}=e,o=r.rootModel.get("scale")||Q;t.shadowOffsetX=n*o.x,t.shadowOffsetY=i*o.y,t.shadowBlur=s*o.x,t.shadowColor=a}var K={gradation:function(t,e,r){var{type:n,subType:i,from:s,to:a,colors:o}=r;switch(i){case"linear":var l=e.createLinearGradient(s.x,s.y,a.x,a.y);break;case"radial":l=e.createRadialGradient(s.x,s.y,s.r,a.x,a.y,a.r);break;default:l=e.createLinearGradient(s.x,s.y,a.x,a.y)}o&&(o.forEach(function(t){l.addColorStop(t.endPoint,t.color)}),e.fillStyle=l,e.fill())},shadow:V};var J,Z=r(0);function $(t,e,r){var n=t.__lookupGetter__(e);n?r?t.__defineGetter__(e,function(){return void 0===this.__cache__[e]&&(this.__cache__[e]=n.call(this)),v.a(this.__cache__[e])}):t.__defineGetter__(e,function(){return void 0===this.__cache__[e]&&(this.__cache__[e]=n.call(this)),this.__cache__[e]}):Object(Z.b)(`${e} is not defined in ${t.constructor.name}`)}function tt(t){var{duration:e=1e3,delay:r=30,step:n,delta:i,ease:s,options:a,repeat:o=!1}=t;"string"==typeof i&&(i=U[i]),"out"==s?i=function(t,e){return function(r){return 1-t(1-r,e)}}(i,a):"inout"==s&&(i=function(t,e){return function(r){return r<.5?t(2*r,e)/2:(2-t(2*(1-r),e))/2}}(i,a));var l=!1;return{start:function(){if(l)return this;l=!0;var t=0,r=()=>{if(l){0==t&&(t=performance.now());var s=(performance.now()-t)/e,h=o?s%1:Math.min(s,1);n(i(h,a)),!(s>=1)||o&&l||(this.stop(),t=0),l&&requestAnimationFrame(r)}};return requestAnimationFrame(r),this},stop:function(){return l=!1,this}}}function et(t,e,r,n,i){var{alpha:s=1}=n,a=i.fillStyle;if(t.globalAlpha*=s,a)if("string"==typeof a)t.fillStyle=a,t.fill();else if("object"==typeof a)if("gradient"==a.type){t.translate(r.x,r.y);let n,{width:i,height:s}=e;if("linear"==a.gradientType){let e=3.141592653589793,r=a.rotation;if(r>=.436332&&r<=1.13446||r>=2.00713&&r<=2.70526||r>=3.57792&&r<=4.27606||r>=5.14872&&r<=5.84685){let a=Math.sqrt(Math.pow((i-4)/2,2)+Math.pow((s-4)/2,2));a-=a-(i+s)/3,n=t.createLinearGradient(a*Math.cos(r+e),a*Math.sin(r+e),a*Math.cos(r),a*Math.sin(r))}else n=t.createLinearGradient((i-4)/2*Math.cos(r+e),(s-4)/2*Math.sin(r+e),(i-4)/2*Math.cos(r),(s-4)/2*Math.sin(r))}else if("radial"==a.gradientType){let e=.95*Math.sqrt(Math.pow((i-4)/2,2)+Math.pow((s-4)/2,2));switch(a.center){case"center":n=t.createRadialGradient(0,0,0,0,0,e);break;case"left-top":n=t.createRadialGradient(-i/2,-s/2,0,-i/2,-s/2,2*e);break;case"right-top":n=t.createRadialGradient(i/2,-s/2,0,i/2,-s/2,2*e);break;case"left-bottom":n=t.createRadialGradient(-i/2,s/2,0,-i/2,s/2,2*e);break;case"right-bottom":n=t.createRadialGradient(i/2,s/2,0,i/2,s/2,2*e);break;default:n=t.createRadialGradient(0,0,0,0,0,e)}}a.colorStops.forEach(t=>{if(t.position>=0&&t.position<=1)try{n.addColorStop(t.position,t.color)}catch(e){Object(Z.c)("Invalid Color for colorstop : ",t.color),n.addColorStop(t.position,"#fff")}}),t.fillStyle=n,t.fill(),t.translate(-r.x,-r.y)}else if("pattern"==a.type&&a.image){i.prepareFillIf(!i._pattern_image_origin);var o=i._pattern_image;if(!o)return;let r=0,n=0,s=0,l=0,h=e.left,c=e.top;if(!a.fitPattern){switch(r=a.offsetX,n=a.offsetY,a.align){case"center":s=e.width/2-(a.width?a.width/2:0),l=e.height/2+(a.height?a.height/2:0);break;case"left-top":break;case"left-bottom":l=a.height?e.height%a.height:e.height;break;case"right-top":s=a.width?e.width%a.width:e.width;break;case"right-bottom":s=a.width?e.width%a.width:e.width,l=a.height?e.height%a.height:e.height;break;case"left":l=e.height/2+(a.height?a.height/2:0);break;case"right":s=a.width?e.width%a.width:e.width,l=e.height/2+(a.height?a.height/2:0);break;case"top":s=e.width/2-(a.width?a.width/2:0);break;case"bottom":s=e.width/2-(a.width?a.width/2:0),l=a.height?e.height%a.height:e.height}h+=r+s,c+=n+l}t.translate(h,c),a.fitPattern?Math.abs((o.width-e.width)*(o.height-e.height))>1?(delete i._pattern_image,delete i._pattern_image_origin):t.fillStyle=t.createPattern(o,"no-repeat"):t.fillStyle=t.createPattern(o,"repeat"),t.fill(),t.translate(-h,-c)}}function rt(t,e,r){var{strokeStyle:n,lineDash:i,lineWidth:s,lineCap:a,lineJoin:o,alpha:l}=e;if(n&&0!=s){if(a&&(t.lineCap=a),i){var h="round"==a;switch(i){case"solid":i=[0,0];break;case"round-dot":i=h?[0,2*s]:[s,s];break;case"square-dot":i=h?[s,2*s]:[2*s,s];break;case"dash":i=h?[3*s,2.5*s]:[4*s,1.5*s];break;case"dash-dot":i=h?[3*s,3*s,0,3*s]:[4*s,2*s,s,2*s];break;case"long-dash":i=h?[5*s,4*s]:[6*s,3*s];break;case"long-dash-dot":i=h?[5*s,3*s,0,3*s]:[6*s,2*s,s,2*s];break;case"long-dash-dot-dot":i=h?[5*s,2*s,0,2*s,0,2*s]:[6*s,s,s,s,s,s]}t.setLineDash(i)}t.globalAlpha*=l,t.strokeStyle=n,t.lineWidth=s,t.lineJoin=o,t.stroke()}}J="undefined"==typeof document?function(t,e){return new Canvas(t,e)}:function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,r};const nt={},it=0,st=1,at=2,ot="undefined"==typeof window?1:window.devicePixelRatio||(window.matchMedia&&window.matchMedia("(min-resolution: 2dppx), (-webkit-min-device-pixel-ratio: 1.5),(-moz-min-device-pixel-ratio: 1.5),(min-device-pixel-ratio: 1.5)").matches?2:1)||1,lt=["mousemove","mouseup","mousedown","mouseout","wheel","click","touchstart","touchmove","touchend","dblclick"],ht=["keydown","keyup"],ct={ALPHA:1,FONT_SIZE:15,FONT_FAMILY:"serif",FONT_COLOR:"black",TEXT_ALIGN:"center",TEXT_BASELINE:"middle",TEXT_WRAP:!1,BOLD:!1,ITALIC:!1,STROKE_STYLE:"#999",LINE_DASH:"solid"};function dt(t,e,r){if(e.length<2)return e;for(var n=2;n<e.length;n++){var i=e.substring(0,n);if(!(t.measureText(i).width<r))break}return e.substring(0,n-1)}function ut(t,e,r,n){var i=String(e).split("\n");return n?[].concat.apply([],i.map(e=>(function(t,e,r){var n,i,s=e.split(" "),a=[],o=[];for(n=0,i=1;i<=s.length;i++)if(o=s.slice(n,i),t.measureText(o.join(" ")).width>r){if(i-n==1){let e=dt(t,o[0],r);a.push([e]),s.splice(n,1,e,o[0].substring(e.length))}else{for(;""==s[i-1];)i++;a.push(s.slice(n,--i))}n=i}return i-n>1&&a.push(o),0==a.length&&a.push([""]),a})(t,e,r))):i.map(t=>t.split(" "))}function pt(t,e,r,n,i){if(!n)return[];t.save(),t.font=r;var s=ut(t,n,e,!!i);return t.restore(),s}function ft(t){var{fontFamily:e=ct.FONT_FAMILY,bold:r=ct.BOLD,italic:n=ct.ITALIC,fontSize:i=ct.FONT_SIZE}=t,s=[];return r&&s.push("bold"),n&&s.push("italic"),s.push(i+"px"),s.push(e),s.join(" ")}function gt(t,e,r,n){var{alpha:i=ct.FONT_COLOR,fontColor:s=ct.FONT_COLOR,textAlign:a=ct.TEXT_ALIGN,textBaseline:o=ct.TEXT_BASELINE,fontSize:l=ct.FONT_SIZE,lineHeight:h=1.2*l}=n;t.save(),t.beginPath();var{left:c,top:d,width:u,height:p}=e;t.font=ft(n);var f,g,m=r.length*h;switch(o){case"top":f=d,t.textBaseline="top";break;case"bottom":f=d+p-m+h,t.textBaseline="bottom";break;case"middle":default:f=d+p/2-m/2+h/2,t.textBaseline="middle"}switch(a){case"left":g=c,t.textAlign="left";break;case"right":g=c+u,t.textAlign="right";break;case"justify":g=c,t.textAlign="left";break;case"center":default:g=c+u/2,t.textAlign="center"}t.globalAlpha*=i,t.fillStyle=s,"justify"!=a?r.forEach((e,r)=>{t.fillText(e.join(" "),g,f+r*h)}):r.forEach((e,r)=>{let n=f+r*h;if(1==e.length)t.fillText(e[0],g,n);else{let r=e.map(e=>t.measureText(e).width),i=r.reduce((t,e)=>t+e,0),s=(u-i)/(e.length-1),a=g;e.forEach((e,i)=>{t.fillText(e,a,n),a+=r[i]+s})}}),t.restore()}const mt=function(t){return t};function yt(t){var e=t.substr(2,t.length-3).trim().replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split(".").filter(t=>!!t.trim()),r=e.slice(1);return{match:t,target:e[0],accessor:r.length>0?function(t){return r.reduce((t,e)=>t?t[e]:void 0,t)}:mt}}function vt(t,e){if(t){var r=String(t),n=(r.match(/#{(\S*)}/gi)||[]).map(t=>yt(t)),i=(r.match(/\${[^}]*}/gi)||[]).map(t=>yt(t));if(0!=n.length||0!=i.length)return function(){var t=r;return n.forEach(r=>{let n=Object(v.e)(r.accessor(e.getState(r.target)));t=t.replace(r.match,void 0===n?"":n)}),i.forEach(r=>{let n=e.root.findById(r.target),i=Object(v.e)(r.accessor(n&&n.data));t=t.replace(r.match,void 0===i?"":i)}),t}}}var xt=r(113);const _t=function(t){return t};class bt{constructor(t,e){this.owner=e,this.model=t}dispose(){delete this._model,delete this.owner,delete this.evaluator,delete this.accessor}get model(){return this._model}set model(t){var{target:e,property:r,rule:n,param:i,accessor:s}=t;this._model=t,this.evaluator=Object(xt.a)(this,this.owner,n,i,function(t){switch(t){case"ref":case"fillStyle":case"strokeStyle":return"string";default:return}}(r)),this.accessor=function(t){if(!t)return _t;var e=String(t).trim().replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split(".").filter(t=>!!t.trim());return e.length>0?function(t){return e.reduce((t,e)=>t?t[e]:void 0,t)}:_t}(s)}get target(){return this.model.target}get property(){return this.model.property}get param(){return this.model.param}}function wt(){this.mappings&&this.mappings.forEach(t=>{try{var{target:e,property:r,accessor:n}=t;if(null==(n=n(this.data)))return;if("(root)"==(e=e.trim())||"(key)"==e){let e=Object.keys(n||{}).map(t=>this.root.findOrCreate(t)).filter(t=>!!t);e.length>0&&e.forEach(e=>e[r]=t.evaluator(n[e.get("id")],[e]))}else if(e.startsWith("[")){if(!e.endsWith("]"))throw String("mapping target should end with ']' to designate property-id.("+e+")");var i=e.substring(1,e.length-1);if(n instanceof Array)n.forEach(e=>{let n=e[i];if(n){let i=this.root.findOrCreate(n);i&&(i[r]=t.evaluator(e,[i]))}});else{if(!(n instanceof Object))throw String("mapping data should be an object to target property-id.("+this.data+")");{let e=n[i];if(e){let i=this.root.findOrCreate(e);i&&(i[r]=t.evaluator(n,[i]))}}}}else{let i=this.root.findAll(e,this);if(i.length>0){let e=t.evaluator(n,i);i.forEach(t=>t[r]=e)}}}catch(e){Object(Z.b)(e,this,t)}})}function At(t,e,r={x:0,y:0},n=0,i={x:1,y:1}){return t-=r.x,e-=r.y,{x:(t*Math.cos(-n)-e*Math.sin(-n)+r.x)/i.x,y:(t*Math.sin(-n)+e*Math.cos(-n)+r.y)/i.y}}function Et(t,e,r={x:0,y:0},n=0,i={x:1,y:1}){return t-=r.x,e-=r.y,{x:(t*Math.cos(n)-e*Math.sin(n)+r.x)*i.x,y:(t*Math.sin(n)+e*Math.cos(n)+r.y)*i.y}}function kt(t){var e=t.element,r=t.fillStyle,n=e.style;if(n.background="",r)if("string"==typeof r)n.backgroundColor=r;else switch(r.type){case"pattern":n.backgroundImage="url("+r.image+")",r.fitPattern?n.backgroundSize="100% 100%":r.width||r.height?n.backgroundSize=`${r.width?r.width+"px":"auto"} ${r.height?r.height+"px":"auto"}`:n.backgroundSize="contain";break;case"gradient":n.background=function(t,e){var r=e.colorStops,n=e.gradientType;if(r instanceof Array&&r.length>0)switch(n){case"radial":let i=e.center||"center";return"radial-gradient(farthest-corner at "+function(t,e){var{width:r,height:n}=t.bounds;switch(e){case"center":return[r/2,n/2];case"left-top":return[0,0];case"right-top":return[r,0];case"left-bottom":return[0,n];default:return[r,n]}}(t,i).map(t=>t+"px").join(" ")+","+r.map(t=>`${t.color} ${100*t.position}%`).join(",")+")";case"linear":let s=180*(e.rotation||0)/3.141592653589793+90+"deg";return"linear-gradient("+s+", "+r.map(t=>`${t.color} ${100*t.position}%`).join(",")+")"}return""}(t,r)}}const St={x:1,y:1},Mt={x:0,y:0},Pt={boxSizing:"border-box",margin:"0px",position:"absolute",outline:"none"};function Tt(t){var{id:e,scale:r=St,translate:n=Mt,bold:i,italic:s,fontFamily:a="",textAlign:o,textBaseline:l,paddingTop:h=0,paddingBottom:c=0,paddingLeft:d=0,paddingRight:u=0,fontSize:p=ct.FONT_SIZE,lineWidth:f=0,lineDash:g}=t.state,m=t.state.class,{strokeStyle:y,fillStyle:v,rotation:x=0,fontColor:_,hidden:b}=(t.text,t),{left:w,top:A,width:E,height:k}=t.bounds,S=t.element;S.hidden=b,e&&(S.id=e),m&&(S.className=m),Object.assign(S.style,Pt,{fontFamily:a,fontSize:p+"px",left:w+"px",top:A+"px",width:E+"px",height:k+"px",paddingTop:h+"px",paddingRight:u+"px",paddingBottom:c+"px",paddingLeft:d+"px",border:f+"px",borderColor:y,borderStyle:f>0?g||ct.LINE_DASH:"",color:_,fontWeight:i?"bold":"",fontStyle:s?"italic":"",textAlign:"end"==o?"right":"start"==o?"left":"",verticalAlign:l}),kt(t);var M=t.delta(),P=(r&&r.x||1)*M.sx,T=(r&&r.y||1)*M.sy,C=(x||0)+M.theta,I=M.tx||0,O=M.ty||0;["-webkit-","-moz-","-ms-","-o-",""].forEach(t=>{S.style[t+"transform"]=`rotate(${C}rad) translate(${I}px, ${O}px) scale(${P}, ${T}) perspective(1px)`})}var Ct,It=[];function Ot(){Ct=null;var t=performance.now(),e=(It=It.filter(t=>Rt(t))).reduce((e,r)=>{let n=t-r.updatedAt;return n>=r.retention?e.kills.push(r):e.next=0==e.next?r.retention-n:Math.min(e.next,r.retention-n),e},{next:0,kills:[]});e.kills.forEach(t=>{let e=It.indexOf(t);-1!=e?(It.splice(e,1),t.removeSelf(!0)):Object(Z.b)("Should not be here. Maybe reentrance problem.")}),e.next>0&&(Ct=setTimeout(Bt,Math.max(e.next,500)))}function Rt(t){return!t.disposed&&t.retention>0&&!t.isTemplate()&&t.app&&t.app.isViewMode}var Bt=Object(v.g)(function(){requestAnimationFrame(Ot)},500);var Lt=new class{add(t){Rt(t)&&-1==It.indexOf(t)&&(It.push(t),t.touch()),this.touch()}remove(t){var e=It.indexOf(t);e>0&&It.splice(e,1),this.touch()}touch(){null!==Ct&&(clearTimeout(Ct),Ct=null),Bt()}get length(){return It.length}},Dt={};const Ht={mutable:!1,resizable:!0,rotatable:!0,properties:[],"value-property":"text",sample:{xx:0}},Ft=[],Nt={theta:0,tx:0,ty:0,sx:1,sy:1,fade:0},Yt=new WeakMap;var jt=0;class zt{static get nature(){return Ht}static buildSample(t,e){var r=this.register(t);if(r){var n=r.nature.sample||{};return Object.assign({type:t},n,e)}console.error("Class not registered.",t)}static register(t,e){if(!e)return Dt[t];Dt[t]=e}static get residents(){return Yt}constructor(t,e){this._app=e,this._model=t||{},this._state={},this._delta=v.a(Nt),e&&this.animation&&(this.animation.started=!0),this.clearCache(),Lt.add(this),Yt.set(this,jt++)}created(){}added(t){}removed(t){}ready(){}touch(){this.updatedAt=performance.now()}clearCache(...t){!function(t,...e){0==e.length?t.__cache__={}:e.forEach(e=>delete t.__cache__[e])}(this,...t)}removeSelf(t){t?this.dispose():this.parent&&this.parent.removeComponent(this)}dispose(){this._animation&&(this._animation.dispose(),delete this._animation),this.disposeMappings(),this.parent&&this.parent.removeComponent(this),delete this._text_substitutor,delete this._value_substitutor,this._disposed=!0,this.retention&&Lt.touch(),this.clearCache(),delete this._app}get nature(){return this.constructor.nature}get disposed(){return!!this._disposed}isLayer(){return!1}isGroup(){return!1}isContainer(){return!1}isLine(){return!1}isRoot(){return!1}isRootModel(){return!1}is3dish(){return!1}isTemplate(){return!!this.get("templatePrefix")}isHTMLElement(){return!1}get retention(){return Number(this.get("retention"))||0}get hasTextProperty(){return!0}get app(){return!this._app&&this.parent&&(this._app=this.parent.app),this._app}get model(){return this._model}get state(){return Object.assign({},this._model,this._state)}get hierarchy(){var t=v.a(this._model);return this.volatile.forEach(e=>{delete t[e]}),t}get volatile(){return Ft}get textHidden(){return!!this._textHidden}set textHidden(t){this._textHidden=!!t,this.invalidate()}get(t){return this._model[t]}set(t,e){if("string"==typeof t)return this.set({[t]:e});var r={},n={},i=!1,s=(t=v.a(t),this);return Object.getOwnPropertyNames(t).forEach(function(e){let a=s._model[e],o=t[e];c()(a,o)||(n[e]=a,r[e]=o,s._model[e]=o,delete s._state[e],i=!0)}),i&&(this.clearCache(),r.hasOwnProperty("text")&&delete this._text_substitutor,r.hasOwnProperty("retention")&&Lt.add(this),r.hasOwnProperty("fillStyle")&&this.onchangeFill(r,n),r.hasOwnProperty("mappings")&&this.onchangeMappings(r,n),r.hasOwnProperty("data")&&this.onchangeData(r,n),this.onchange&&this.onchange(r,n),this.trigger("change",r,n)),this}getState(t){return this._state.hasOwnProperty(t)?this._state[t]:this.get(t)}setState(t,e){if("string"==typeof t)return this.setState({[t]:e});var r={},n={},i=!1,s=(t=v.a(t),this);return Object.getOwnPropertyNames(t).forEach(function(e){let a=s.getState(e),o=t[e];c()(a,o)||(n[e]=a,r[e]=o,s._state[e]=o,i=!0)}),i&&(this.clearCache(),r.hasOwnProperty("text")&&delete this._text_substitutor,r.hasOwnProperty("fillStyle")&&this.onchangeFill(r,n),r.hasOwnProperty("data")&&this.onchangeData(r,n),this.onchange&&this.onchange(r,n),this.trigger("change",r,n)),this}get root(){return this.isRoot()?this:this.parent&&this.parent.root}get rootModel(){return this.isRootModel()?this:this.parent&&this.parent.rootModel}get parent(){return this._parent}set parent(t){this._parent=t}isDescendible(t){return!0}getContext(){return this._parent.getContext()}get center(){var t=this.bounds;return{x:t.left+t.width/2,y:t.top+t.height/2}}set center(t){if(t&&!isNaN(t.x)&&!isNaN(t.y)){var e=this.center;if(Math.round(100*t.x)/100!=Math.round(100*e.x)/100||Math.round(100*t.y)/100!=Math.round(100*e.y)/100){var r=t.x-e.x,n=t.y-e.y;this.path=this.path.map(t=>({x:t.x+r,y:t.y+n}))}}}get location(){return this.center}set location(t){this.center=t}get dimension(){return this.get("dimension")}set dimension(t){this.set("dimension",t)}get bounds(){var t,e,r,n,i=this.path;t=e=i[0].x,r=n=i[0].y;for(let s=1;s<i.length;s++){let a=i[s];a.x<t?t=a.x:a.x>e&&(e=a.x),a.y<r?r=a.y:a.y>n&&(n=a.y)}return{left:t,top:r,width:e-t,height:n-r}}set bounds(t){var e=this.bounds;if(Math.round(100*t.width)/100!=Math.round(100*e.width)/100||Math.round(100*t.height)/100!=Math.round(100*e.height)/100||Math.round(100*t.left)/100!=Math.round(100*e.left)/100||Math.round(100*t.top)/100!=Math.round(100*e.top)/100){var r=0==e.width?1:t.width/e.width,n=0==e.height?1:t.height/e.height;this.path=this.path.map(i=>({x:t.left+(i.x-e.left)*r,y:t.top+(i.y-e.top)*n}))}}get path(){return Object(Z.b)("이 컴포넌트에 get path 가 구현되어있지 않음.",this),[]}set path(t){Object(Z.b)("이 컴포넌트에 get path 가 구현되어있지 않음.",this)}outline(t){return function(t,e){var r=t.path.slice();if(r&&r.length){var n=1,i=[];if(t.isLine()||r.push(r[0]),e<=0)return t.transcoordS2T(r[0].x,r[0].y);if(e>=1)return t.transcoordS2T(r[r.length-1].x,r[r.length-1].y);for(;r[n];){let t=r[n-1],e=r[n],s=e.x-t.x,a=e.y-t.y;i.push(Math.sqrt(s*s+a*a)),n++}var s=i.reduce(function(t,e){return t+e},0);n=0;var a=0;do{a+=i[n++]}while(a/s<e);e=(e-(a-=i[--n])/s)*(s/i[n]);var o=r[n%r.length],l=r[(n+1)%r.length],h=o.x+Math.round((l.x-o.x)*e),c=o.y+Math.round((l.y-o.y)*e);return t.transcoordS2T(h,c)}Object(Z.b)("path should not be empty")}(this,t||0)}get anchors(){return[]}get strokeStyle(){return this.get("strokeStyle")}set strokeStyle(t){this.set("strokeStyle",t)}get fillStyle(){return this.getState("fillStyle")}set fillStyle(t){this.setState("fillStyle",t)}get fontColor(){return this.get("fontColor")}set fontColor(t){this.set("fontColor",String(v.e(t)))}get rotation(){return this.getState("rotation")}set rotation(t){this.setState("rotation",Number(v.e(t)))}contains(t,e){return!1}get mutable(){return Ht.mutable}get resizable(){return Ht.resizable&&!this.stuck}adjustResize(t,e,r){if(r){let e=this.bounds,r=e.height/e.width,n=t.width-e.width,i=t.height-e.height;n*r>i?i=n*r:n=i/r;let s=t.left-e.left,a=t.top-e.top;return 0!=s&&0!=a?(a=-i,s=-n):0!=s?s=-n:0!=a&&(a=-i),{left:e.left+s,top:e.top+a,width:e.width+n,height:e.height+i}}return t}get rotatable(){return Ht.rotatable&&!this.stuck}adjustRotation(t,e){if(e||this.app.rotateStepForced){let e=this.app.rotateStep;return Math.floor((t+e/2)/e)*e}return t}get capturable(){return!1!==this.get("capturable")&&(this.app.isEditMode||!this.hidden)}get stuck(){return!!(this.parent&&this.parent.layout.isStuck(this)||this.get("locked"))}findFirst(t,...e){if(t(this,...e))return this}findAll(t,...e){return"string"==typeof t?y(t,this,e[0]||this):"function"==typeof t&&t(this,...e)?[this]:void 0}capture(t,e){if(!this.capturable)return!1;var r=this.transcoordP2S(t,e);return this.contains(r.x,r.y)?this:void 0}prepare(t,e){t(this)}prepareIf(t){t&&this.prepare&&this.prepare(t=>{this.invalidate()},t=>{Object(Z.b)(t)})}get hidden(){return this.getState("hidden")||this.isTemplate()}set hidden(t){this.setState("hidden",t)}draw(t){t.save(),this.__proto__.hasOwnProperty("_pre_draw")?this._pre_draw(t):this.prerender(t),this.__proto__.hasOwnProperty("_draw")?this._draw(t):this.render(t),this.__proto__.hasOwnProperty("_post_draw")?this._post_draw(t):this.postrender(t),t.restore()}delta(t,e){if(void 0===e)return t?this._delta[t]:this._delta;this._delta[t]=e}prerender(t){var e=this.rotatePoint,{scale:r,rotation:n,shadow:i,alpha:s}=this.model,a=(r&&r.x||1)*this._delta.sx,o=(r&&r.y||1)*this._delta.sy,l=(n||0)+this._delta.theta,{tx:h=0,ty:c=0}=this._delta,d=(s||1)-this._delta.fade;(h||c)&&t.translate(h,c),(1!=a||1!=o||l)&&(t.translate(e.x,e.y),1==a&&1==o||t.scale(a,o),l&&t.rotate(l),t.translate(-e.x,-e.y)),d&&(t.globalAlpha=d),i&&V(t,i,this),this.app.isEditMode&&this.hidden&&(t.globalAlpha*=.5)}render(t){}postrender(t){this.drawText(t)}drawText(t){!this.textHidden&&this.text&&this.hasTextProperty&&gt(t,this.textBounds,this.textLines(t),this.model)}drawStroke(t){rt(t,this.model)}drawFill(t){this.fillStyle&&"transparent"!=this.fillStyle&&(et(t,this.bounds,this.center,this.model,this),function(t){t.shadowColor="transparent"}(t))}animate(t){return this._animate&&this._animate.stop(),this._animate=tt(t),this._animate}move({x:t,y:e}){var r=this.path,n=t,i=e;this.path=r.map(t=>({x:t.x+n,y:t.y+i}))}symmetryX(t){"number"!=typeof t&&(t=this.center.x);var{rotation:e}=this.model,r=this.fillStyle;if(this.set("rotation",2*Math.PI-e),r&&"gradient"===r.type&&"linear"===r.gradientType){var n=v.a(r);n.rotation=(Math.PI-parseFloat(r.rotation||0))%(2*Math.PI),this.set("fillStyle",n)}this.path=this.path.map(e=>({x:2*t-e.x,y:e.y}))}symmetryY(t){this.symmetryX(),this.set("rotation",(Math.PI+this.model.rotation)%(2*Math.PI)),t&&this.move({x:0,y:2*(t-this.center.y)})}get animation(){if(this.app.isViewMode&&!this.isTemplate()){if(!this._animation){var t=this.model.animation;t&&t.oncreate&&(this._animation=(e=this,r=t.oncreate,(n=q[r.type])?new n(e,r):null))}var e,r,n;return this._animation}}effect(t,e){return function(t,e,r){var n=K[r.type];n&&n(t,e,r)}(this,t,e)}set started(t){this.animation&&(this.animation.started=t)}invalidate(){this.parent&&this.parent.invalidate()}get font(){return ft(this.model)}get lineHeight(){var t=this.get("lineHeight");return t||1.2*this.fontSize}defaultTextSubstitutor(){var t=this.getState("text");return null==t?"":String(t)}get textSubstitutor(){return this._text_substitutor||(this._text_substitutor=vt(this.getState("text"),this)||this.defaultTextSubstitutor),this._text_substitutor}get text(){var t=this.get("textFormat");return t?function(t,e){if(!t||isNaN(+e))return e;var r,n,i,s,a,o,l,h,c,d=t.length,u=t.search(/[0-9\-\+#]/),p=u>0?t.substring(0,u):"",f=t.split("").reverse().join(""),g=f.search(/[0-9\-\+#]/),m=d-g,y=t.substring(m,m+1),v=m+("."===y||","===y?1:0),x=g>0?t.substring(v,d):"";if(r=(e="-"===(t=t.substring(u,v)).charAt(0)?-e:+e)<0?e=-e:0,i=(n=t.match(/[^\d\-\+#]/g))&&n[1]&&n[0]||",",t=t.split("."),e=+(e=e.toFixed(t[1]&&t[1].length))+"",a=t[1]&&t[1].lastIndexOf("0"),(!(l=e.split("."))[1]||l[1]&&l[1].length<=a)&&(e=(+e).toFixed(a+1)),h=t[0].split(i),t[0]=h.join(""),(s=t[0]&&t[0].indexOf("0"))>-1)for(;l[0].length<t[0].length-s;)l[0]="0"+l[0];else 0==+l[0]&&(l[0]="");if((e=e.split("."))[0]=l[0],o=h[1]&&h[h.length-1].length){for(f="",m=(c=e[0]).length%o,d=c.length,v=0;v<d;v++)f+=c.charAt(v),!((v-m+1)%o)&&v<d-o&&(f+=i);e[0]=f}return e[1]=t[1]&&e[1]?"."+e[1]:"","0"!==(n=e.join(""))&&""!==n||(r=!1),p+("+"==t[0].substring(0,1)?r?"-":"+":r?"-":"")+n+x}(t,this.textSubstitutor()):this.textSubstitutor()}set text(t){delete this._text_substitutor;var e=v.e(t);this.setState("text",null==e?"":String(e))}textLines(t){return pt(t||this.getContext(),this.textBounds.width,this.font,this.text,this.get("textWrap"))}get textBounds(){var{paddingTop:t=0,paddingLeft:e=0,paddingRight:r=0,paddingBottom:n=0}=this.model,{left:i,top:s,width:a,height:o}=this.bounds;return{left:i+e,top:s+t,width:Math.max(a-e-r,0),height:Math.max(o-t-n,0)}}get rotatePoint(){return this.center}trim(){delete this._model[""],"chartjs"!==this._model.type&&delete this._model.chart}get value(){var t=this.nature["value-property"]||"text";return"value"==t?this.getState("value"):this[t]}set value(t){var e=this.nature["value-property"]||"text";"value"==e?this.setState("value",t):this[e]=t}get data(){return this.getState("data")}set data(t){this.setState("data",t),this.touch()}get mappings(){return!this._mappings&&this.parent&&this.buildMappings(),this._mappings}serialize(...t){return JSON.stringify(this.hierarchy,...t)}get controls(){}}zt.union=function(t){var e,r,n,i;return t.forEach(t=>{void 0===e?(e=t.left,r=t.top,n=t.left+t.width,i=t.top+t.height):(e=Math.min(t.left,e),r=Math.min(t.top,r),n=Math.max(t.left+t.width,n),i=Math.max(t.top+t.height,i))}),{left:e,top:r,width:n-e,height:i-r}},zt.transcoordR=At,zt.transcoordRR=Et,zt.createCanvas=J,zt.memoize=$,zt.mixin=G,zt.drawText=gt,zt.font=ft,zt.textLines=pt,zt.drawStroke=rt,zt.drawFill=et,zt.reposition=Tt,zt.RetentionManager=Lt,zt.template=u.a,Object.assign(zt.prototype,{drawEffect:function(t){this._model.effects&&this._model.effects.forEach(e=>{this.effect(t,e)})},prepareFill:function(t,e){var r=this.fillStyle;if(r&&"pattern"==r.type&&r.image){if("string"!=typeof r.image)return this._pattern_image_origin=this._pattern_image=r.image,void t(this);this._pattern_image=null,this._pattern_image_origin=new Image;var n=this;this._pattern_image_origin.onload=function(){if(!r.fitPattern&&!r.width&&!r.height)return n._pattern_image=n._pattern_image_origin,void t(this);let e=r.width||this.width,i=r.height||this.height;r.fitPattern&&(e=n.bounds.width,i=n.bounds.height);let s=J(e,i);s.getContext("2d").drawImage(this,0,0,this.width,this.height,0,0,e,i),n._pattern_image=s,t(this)},this._pattern_image_origin.onerror=function(t){e(t)};try{"data"!==String(r.image).substring(0,4)?this._pattern_image_origin.crossOrigin="use-credentials":this._pattern_image_origin.crossOrigin=null,this._pattern_image_origin.src=this.app.url(r.image)}catch(t){e(t)}}else t(this)},prepareFillIf:function(t){t&&this.prepareFill(t=>{this.invalidate()},t=>{Object(Z.b)(t)})},onchangeFill:function(t,e){var r=this.fillStyle;"pattern"===r.type?this.prepareFillIf(r.image):this._pattern_image&&(this._pattern_image=null,this._pattern_image_origin=null)},mutateBounds:function(t,e){var r=this.bounds,n=this.rotatePoint,i=this.get("rotation"),s=this.get("scale");if(t){var a=t.call(e,r);a&&(r=a)}var{left:o,top:l,width:h,height:c}=r,d=[{x:o,y:l},{x:o+h,y:l+c}],u=(d=d.map(t=>zt.transcoordRR(t.x,t.y,n,i,s)))[0],p=d[1];n={x:(u.x+p.x)/2,y:(u.y+p.y)/2},u=(d=d.map(t=>zt.transcoordR(t.x,t.y,n,i,s)))[0],p=d[1],this.bounds={left:u.x,top:u.y,width:p.x-u.x,height:p.y-u.y}},mutatePath:function(t,e,r){var n=this.path,i=this.rotatePoint;this.get("rotation"),this.get("scale"),t&&(n=t.call(r,n));var s=n.map(t=>this.transcoordS2P(t.x,t.y));e&&(n=e.call(r,s))&&(s=n);var a,o,l,h,c={x:0,y:0};a=o=(n=s.map(t=>this.transcoordP2S(t.x,t.y,c)))[0].x,l=h=n[0].y;for(let t=1;t<n.length;t++){let e=n[t];e.x<a?a=e.x:e.x>o&&(o=e.x),e.y<l?l=e.y:e.y>h&&(h=e.y)}i={x:(a+o)/2,y:(l+h)/2},i=this.transcoordS2P(i.x,i.y,c),this.path=s.map(t=>this.transcoordP2S(t.x,t.y,i))},substitute:function(t){if(t){var e=String(t),r=(e.match(/#{(\S*)}/gi)||[]).map(t=>yt(t)),n=(e.match(/\${[^}]*}/gi)||[]).map(t=>yt(t));if(0==r.length&&0==n.length)return e;var i=e;return r.forEach(t=>{let e=Object(v.e)(t.accessor(this.getState(t.target)));i=i.replace(t.match,void 0===e?"":e)}),n.forEach(t=>{let e=this.root.findById(t.target),r=Object(v.e)(t.accessor(e&&e.data));i=i.replace(t.match,void 0===r?"":r)}),i}},onchangeMappings:function(t,e){this.disposeMappings(),wt.call(this)},onchangeData:function(t,e){wt.call(this)},buildMappings:function(){if(this._model.mappings)return!this._model.mappings instanceof Array?(Object(Z.b)("Mappings model is invalid (should be a Array) ..",this._model.mappings),void(this._mappings=[])):void(this._mappings=(this._model.mappings||[]).map(t=>new bt(t,this)));this._mappings=[]},executeMappings:wt,disposeMappings:function(){this._mappings&&this._mappings.forEach(t=>t.dispose()),delete this._mappings},ondropfile:function(t,e){for(let r=0;r<t.length;r++)if(t[r].type.startsWith("image/"))return void this.set("fillStyle",{type:"pattern",image:e[r],fitPattern:!0})},transcoordS2P:function(t,e,r){if(!this.parent)return{x:t,y:e};var{rotation:n=0,scale:i={x:1,y:1}}=this.model;if(this.isLayer()){let r=this.model.translate,s=Et(t,e,void 0,n,i);return r&&(s.x+=r.x,s.y+=r.y),s}var s=Et(t,e,r=r||this.rotatePoint,n,i);return{x:s.x-(r.x-r.x/i.x),y:s.y-(r.y-r.y/i.y)}},transcoordP2S:function(t,e,r){if(!this.parent)return{x:t,y:e};var{rotation:n=0,scale:i={x:1,y:1}}=this.model;if(this.isLayer()){let r=this.model.translate,s=At(t,e,r,n,i);return r&&(s.x-=r.x/(i?i.x:1),s.y-=r.y/(i?i.y:1)),s}var s=At(t,e,r=r||this.rotatePoint,n,i);return{x:s.x+(r.x-r.x/i.x),y:s.y+(r.y-r.y/i.y)}},transcoordS2T:function(t,e,r){r=r||this.rootModel;var n=[];for(let t=this.parent;t&&t!==r;t=t.parent)n.push(t);var i=this.transcoordS2P(t,e);return n.forEach(t=>{let{scale:e}=t.model,r=t.bounds;if(e){let n=t.rotatePoint;i.x+=(n.x-r.left)*e.x,i.y+=(n.y-r.top)*e.y}else i.x+=r.left,i.y+=r.top;i=t.transcoordS2P(i.x,i.y)}),i},transcoordT2S:function(t,e,r){r=r||this.rootModel;var n=[];for(let t=this.parent;t&&t!==r;t=t.parent)n.splice(0,0,t);var i={x:t,y:e};return n.forEach(t=>{let{scale:e}=t.model;i=t.transcoordP2S(i.x,i.y);let r=t.bounds;if(e){let n=t.rotatePoint;i.x-=(n.x-r.left)/e.x,i.y-=(n.y-r.top)/e.y}else i.x-=r.left,i.y-=r.top}),this.transcoordP2S(i.x,i.y)},transcoordS2TR:function(t,e,r){r=r||this.rootModel;var n=this.transcoordS2T(t,e,r);return Et(n.x,n.y,void 0,r.get("rotation")||0)},transcoordS2O:function(t,e,r){var n=this.rootModel,i=this.transcoordS2T(t,e,n);return r.transcoordT2S(i.x,i.y,n)},transcoordC2S:function(t,e,r){if(!r)for(r=this;r&&!r.isLayer();)r=r.parent;var{translate:n,scale:i,rotation:s}=r.model,a=At(t,e,n,s,i);return n&&(a.x-=n.x/(i?i.x:1),a.y-=n.y/(i?i.y:1)),r===this?a:this.transcoordT2S(a.x,a.y,r)},transcoordS2C:function(t,e,r){if(!r)for(r=this;r&&!r.isLayer();)r=r.parent;if(r!==this)var n=this.transcoordS2T(t,e,r);else n={x:t,y:e};var{translate:i,rotation:s,scale:a}=r.model;return n=Et(n.x,n.y,void 0,s,a),i&&(n.x+=i.x,n.y+=i.y),n},_pre_draw:zt.prototype.prerender,_draw:zt.prototype.render,_post_draw:zt.prototype.postrender}),["rotatePoint","font","lineHeight","retention"].forEach(t=>zt.memoize(zt.prototype,t,!1)),["bounds","center","textBounds"].forEach(t=>zt.memoize(zt.prototype,t,!0)),zt.mixin(zt.prototype,W.withEvent);var Wt={};var Gt={list:function(){return{...Wt}},register:function(t,e){Wt[t]=e},unregister:function(t){delete Wt[t]},get:function(t){if(t){var e=Wt[t];return e||Object(Z.b)("Layout Not Found - ",t),e}}},Ut={reflow:function(t,e){},capturables:function(t){return t.components},drawables:function(t){return t.app.isViewMode?t.components.filter(t=>!t.hidden):t.components},isStuck:function(t){return!1},ABSOLUTE:!0};Gt.register("absolute",Ut);var Xt=Ut;function qt(t){var e=t.components.filter(t=>!t.hidden),r=t.get("layoutConfig")||{},n=e[r&&r.activeIndex||0];return n&&[n]||[]}var Qt={reflow:function(t){var e=t.bounds,r=t.get("layoutConfig")||{},n={left:0,top:0,width:e.width,height:e.height};t.forEach((t,e)=>{let i=e!=r.activeIndex;t.bounds=n,t.set("rotation",0),t.element&&(t.element.style.display=i?"none":"initial")})},capturables:function(t){return qt(t)},drawables:function(t){return qt(t)},isStuck:function(t){return!0}};Gt.register("card",Qt);var Vt=Qt;function Kt(t){var e=t.get("layoutConfig");return e&&e.weight||1}var Jt={reflow:function(t){var e=this.drawables(t),r=t.get("padding")||{},n=e.reduce((t,e)=>t+Kt(e),0),i=t.bounds,s=n>0?(i.width-((r.left||0)+(r.right||0)))/n:i.width,a=i.height-((r.top||0)+(r.bottom||0)),o=0;e.forEach(t=>{let e=Kt(t),n=t.get("margin")||{};t.bounds={left:s*o+(r.left||0)+(n.left||0),top:0+(r.top||0)+(n.top||0),width:e*s-((n.left||0)+(n.right||0)),height:a-((n.top||0)+(n.bottom||0))},t.set("rotation",0),o+=e})},capturables:function(t){return t.components},drawables:function(t){return t.app.isViewMode?t.components.filter(t=>!t.hidden):t.components},isStuck:function(t){return!0}};Gt.register("linear-horizontal",Jt);var Zt=Jt;function $t(t){var e=t.get("layoutConfig");return e&&e.weight||1}var te={reflow:function(t){var e=this.drawables(t),r=t.get("padding")||{},n=e.reduce((t,e)=>t+$t(e),0),i=t.bounds,s=n>0?(i.height-((r.top||0)+(r.bottom||0)))/n:i.height,a=i.width-((r.left||0)+(r.right||0)),o=0;e.forEach(t=>{let e=$t(t),n=t.get("margin")||{};t.bounds={left:0+(r.left||0)+(n.left||0),top:s*o+(r.top||0)+(n.top||0),width:a-((n.left||0)+(n.right||0)),height:e*s-((n.top||0)+(n.bottom||0))},t.set("rotation",0),o+=e})},capturables:function(t){return t.components},drawables:function(t){return t.app.isViewMode?t.components.filter(t=>!t.hidden):t.components},isStuck:function(t){return!0}};Gt.register("linear-vertical",te);var ee=te,re={reflow:function(t){var e=t.get("layoutConfig"),r=e&&e.columns||t.get("columns"),n=e&&e.rows||t.get("rows"),i=e&&e.widths||t.get("widths"),s=e&&e.heights||t.get("heights"),a=i?i.filter((t,e)=>e<r).reduce((t,e)=>t+e,0):r,o=s?s.filter((t,e)=>e<n).reduce((t,e)=>t+e,0):n,l=t.textBounds,h=t.get("paddingLeft")||0,c=t.get("paddingTop")||0,d=l.width/a,u=l.height/o,p=0,f=0;t.components.forEach((t,e)=>{let n=i?i[e%r]:1,a=s?s[Math.floor(e/r)]:1,o=t.colspan||1,l=0;for(;--o>0;)l+=i?i[(e+o)%r]:1;let g=t.rowspan||1,m=0;for(;--g>0;)m+=s?s[Math.floor(e/r)+g]:1;t.bounds={left:h+p,top:c+f,width:d*(n+l),height:u*(a+m)},t.set("rotation",0),e%r==r-1?(p=0,f+=a*u):p+=n*d})},capturables:function(t){return t.components.filter(t=>!t.merged)},drawables:function(t){return t.components.filter(t=>!t.merged)},isStuck:function(t){return!0},keyNavigate:function(t,e,r){var n=t.get("layoutConfig"),i=n&&n.columns||t.get("columns"),s=n&&n.rows||t.get("rows"),{row:a,column:o}=t.getRowColumn(e);switch(r.code){case"ArrowUp":if(a>0)return t.getAt((a-1)*i+o);break;case"ArrowDown":if(a<s-1)return t.getAt((a+1)*i+o);break;case"ArrowRight":if(o<i-1)return t.getAt(a*i+o+1);break;case"ArrowLeft":if(o>0)return t.getAt(a*i+o-1);break;default:return e}},joinType:!0};Gt.register("table",re);var ne=re,ie={reflow:function(t,e){this.drawables(t).filter(t=>t.isHTMLElement()).forEach(t=>t.reposition())},capturables:function(t){return t.components},drawables:function(t){return t.app.isViewMode?t.components.filter(t=>!t.hidden):t.components},isStuck:function(t){return!1},ABSOLUTE:!0};Gt.register("html-absolute",ie);var se=ie,ae=t=>{var e=class extends t{contains(t,e){var{left:r,top:n,width:i,height:s,lineWidth:a=0}=this.model,o=a/2;return t<Math.max(r+i,r)+o&&t>Math.min(r+i,r)-o&&e<Math.max(n+s,n)+o&&e>Math.min(n+s,n)-o}set path(t){var e=t[0],r=t[2],{width:n,height:i}=this.model;this.set({left:e.x,top:e.y,width:r.x-e.x,height:r.y-e.y})}get path(){var{left:t=0,top:e=0,width:r=0,height:n=0}=this.model;return[{x:t,y:e},{x:t+r,y:e},{x:t+r,y:e+n},{x:t,y:e+n}]}};return $(e.prototype,"path",!1),e};const oe=new Image;oe.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAclBMVEVHcEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC0BbqFAAAAJXRSTlMAgAP3VSI6/g9fBk5FavJsMrariSjzPnO1enRRL5SMhmOOWB9keFTE0wAAANxJREFUOMutk9kWgyAMRLFuiLjUtdp9yf//YglVsQXz1HniMPcEMgHGvpX2O0Ypi+EgCL+IAShC+wB7QfubRDT7AFcnUPoLMLiP4PyJbsb55i05AgnR5iaQDsICgtH0cotBWoAP1c7kC6kFxEseCfZfB6gEgbNeBrira2QmH1uVYCXlA3is8UmgUCPIyQJKEmu8QtQJN0e9DPXVpzG2G216c1CqRmcBOdxXk07sWUSPv07zo0amCNQycv+NzmR6cRcwmfbuI7p2nZ/z4be0P83Foz6vIkhfZXr82XgDlZsspIq4peUAAAAASUVORK5CYII=";var le=t=>{return class extends t{postrender(t){super.postrender(t),this.app.isEditMode&&this._focused&&this.showMoveHandle&&this._draw_move_handle(t)}_draw_move_handle(t){var{left:e,top:r,width:n}=this.bounds;t.save(),t.beginPath(),t.rect(e+n,r,25,25),t.fillStyle="rgba(235, 235, 235, 1)",t.strokeStyle="#333",t.fill(),t.stroke(),t.drawImage(oe,e+n+3.75,r+3.75,17.5,17.5),t.closePath(),t.restore()}contains(t,e){var r=super.contains(t,e);if(this.app.isViewMode)return r;var{left:n,top:i,width:s,height:a}=this.bounds,o=n+s;return this.showMoveHandle&&(r=r||t<Math.max(o+25,o)&&t>Math.min(o+25,o)&&e<Math.max(i+25,i)&&e>Math.min(i+25,i)),this._focused=!!r,this.invalidate(),r}}};const he=[];class ce extends(le(ae(zt))){constructor(t,e){super(t,e),this._components=[]}get showMoveHandle(){return!0}dispose(){this.components.slice().forEach(t=>t.dispose()),super.dispose()}isContainer(){return!0}containable(t){return t.isDescendible(this)&&"variable"!==t.get("type")}get hasTextProperty(){return!1}get components(){return this._components}get focusible(){return!0}get layout(){return Gt.get(this.get("layout"))||Xt}reflow(){this.layout.reflow(this),this.components&&this.components.forEach(t=>{t.isContainer()&&t.reflow()})}get hierarchy(){var t=super.hierarchy;return this.components&&(t.components=this.components.map(t=>t.hierarchy)),t}addComponent(t){var e=t.parent;if(e){if(this===e)return;e.removeComponent(t)}var r=this._components.push(t)-1;t.parent=this,t.added(this),this.trigger("add",this,t,r),t.delegate_on(this),t.trigger("added",this,t,r),this.root&&this.root.isReady&&t.ready()}removeComponent(t){var e=this._components.indexOf(t);-1!=e&&(this._components.splice(e,1),t.parent=null,t.removed(this),this.trigger("remove",this,t),t.trigger("removed",this,t),t.delegate_off(this))}insertComponentAt(t,e){var r=t.parent;r&&r.removeComponent(t);var n=this._components.splice(0,e);this._components=n.concat(t,this._components),e=this._components.indexOf(t),t.parent=this,t.added(this),this.trigger("add",this,t,e),t.delegate_on(this),t.trigger("added",this,t,e)}add(t){return t instanceof Array?(t.forEach(t=>{-1==this._components.indexOf(t)&&this.addComponent(t)}),this):this.add.call(this,[t])}remove(t){return t instanceof Array?this._components?(t.forEach(t=>{this.removeComponent(t)}),this):this:this.remove.call(this,[t])}getAt(t){if(this._components)return this._components[t]}forEach(t,e){this._components&&this._components.forEach(t,e)}traverse(t,e){t.call(e,this),this._components&&this._components.forEach(r=>{r.isContainer()?r.traverse(t,e):t.call(e,r)})}indexOf(t){return(this._components||he).indexOf(t)}size(){return(this._components||he).length}moveChildAt(t,e){var r=this.indexOf(e);if(-1!=r){var n=this._components.splice(0,r),i=this._components.splice(1);this._components=n.concat(i),t=Math.max(0,t),t=Math.min(t,this._components.length),n=this._components.splice(0,t),this._components=n.concat(e,this._components)}}moveChildForward(t){var e=this.indexOf(t);-1!=e&&e!=this.size()-1&&(this._components[e]=this._components[e+1],this._components[e+1]=t)}moveChildBackward(t){var e=this.indexOf(t);-1!=e&&0!=e&&(this._components[e]=this._components[e-1],this._components[e-1]=t)}moveChildToFront(t){var e=this.indexOf(t);if(-1!=e&&e!=this.size()-1){var r=this._components.splice(0,e),n=this._components.splice(1);this._components=r.concat(n,this._components)}}moveChildToBack(t){var e=this.indexOf(t);if(-1!=e&&0!=e){var r=this._components.splice(0,e),n=this._components.splice(0);this._components=this._components.concat(r,n)}}symmetryX(t){super.symmetryX(t),this.components.map(t=>{t.symmetryX(0)})}findAll(t,...e){if("string"==typeof t)return y(t,this,e[0]||this);if("function"==typeof t){var r=[];for(let n=this.components.length-1;n>=0;n--){let i=this.components[n].findAll(t,...e);i&&(r=r.concat(i))}return t(this,...e)&&r.push(this),r}}findFirst(t,...e){if("string"==typeof t)return y(t,this,e[0])[0];if("function"==typeof t){for(let n=this.components.length-1;n>=0;n--){var r=this.components[n].findFirst(t,...e);if(null!=r)return r}return t(this,...e)?this:null}}findById(t){return this.root.findById(t)}contains(t,e){var r=super.contains(t,e);if(!r){var{left:n,top:i,width:s,height:a,lineWidth:o=0}=this.model,l=this.stuck?0:10+o/2;r=t<Math.max(n+s,n)+l&&t>Math.min(n+s,n)-l&&e<Math.max(i+a,i)+l&&e>Math.min(i+a,i)-l}return r}capture(t,e){var r=this.transcoordP2S(t,e);if(!this.contains(r.x,r.y))return!1;var n=this.bounds;r.x-=n.left,r.y-=n.top;var i=this.layout.capturables(this);for(let t=i.length-1;t>=0;t--){var s=i[t].capture(r.x,r.y);if(s)return s}return this.capturable&&this}capturePath(t,e){if(e){if(e.indexOf(this)>-1)return!1;for(let t=0;t<e.length;t++)if(!this.containable(e[t]))return!1}var r=[],{left:n,top:i,width:s,height:a}=this.bounds;for(let e=0;e<t.length;e++){let o=this.transcoordP2S(t[e].x,t[e].y);if(o.x<n||o.x>n+s||o.y<i||o.y>i+a)return!1;o.x-=n,o.y-=i,r.push(o)}let o=this.layout.capturables(this);for(let t=o.length-1;t>=0;t--){let n=o[t];if(!n.isContainer())continue;let i=n.capturePath(r,e);if(i)return i}return this.focusible&&this}render(t){var{left:e=0,top:r=0,width:n,height:i}=this.bounds;t.beginPath(),t.rect(e,r,n,i),this.drawFill(t),this.drawStroke(t)}postrender(t){super.postrender(t);var{top:e,left:r,scale:n}=this.model;t.translate(r,e),this.layout.drawables(this).forEach(e=>{e.draw(t)}),t.translate(-r,-e),this.drawText(t)}trim(){this.components.forEach(t=>{t.trim()}),super.trim()}}["layout"].forEach(t=>zt.memoize(ce.prototype,t,!1));var de=t=>{return class extends t{isHTMLElement(){return!0}get element(){return this._element}set element(t){this._element=t}get tagName(){return this.get("type")}setElementProperties(t){throw new Error("Not Implemented Yet")}createElement(){this.element=document.createElement(this.tagName),this.element&&(this.parent.isHTMLElement()?this.parent.element.appendChild(this.element):this.root.model_layer.overlay.appendChild(this.element),this.oncreate_element&&this.oncreate_element(this.element))}reposition(){this.element&&Tt(this)}disposeElement(){var t=this.element;t&&t.parentElement&&t.parentElement.removeChild(t),delete this.element}ready(){!this.element&&this.createElement(),this.setElementProperties(this.element),this.reposition()}added(){this.element&&(this.parent.isHTMLElement()?this.parent.element.appendChild(this.element):this.root.model_layer.overlay.appendChild(this.element),this.reposition())}dispose(){this.disposeElement(this),super.dispose()}get hasTextProperty(){return!0}get textHidden(){return!0}onchange(t,e){this.element&&this.setElementProperties(this.element),this.reposition()}isDescendible(t){return t.isHTMLElement()}}};const ue={x:1,y:1},pe={boxSizing:"border-box",margin:"0px",position:"absolute",outline:"none"},fe={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"layout",label:"layout",name:"layoutOption"}]};class ge extends(de(ce)){get tagName(){return"div"}get nature(){return fe}oncreate_element(t){t.style.pointerEvents="none"}setElementProperties(t){}get layout(){return Gt.get(this.get("layout"))||se}reposition(){if(this.element){var{id:t,class:e,scale:r=ue}=this.state,{rotation:n=0,hidden:i}=this,{left:s,top:a,width:o,height:l}=this.bounds,h=this.element;h.hidden=i,t&&(h.id=t),e&&(h.className=e),Object.assign(h.style,pe,{left:s+"px",top:a+"px",width:o+"px",height:l+"px",backgroundColor:"transparent"});var c=this.delta(),d=(r&&r.x||1)*c.sx,u=(r&&r.y||1)*c.sy,p=(n||0)+c.theta,f=c.tx||0,g=c.ty||0;["-webkit-","-moz-","-ms-","-o-",""].forEach(t=>{h.style[t+"transform"]=`rotate(${p}rad) translate(${f}px, ${g}px) scale(${d}, ${u}) perspective(1px)`})}}}function me(t,e,r){var n=t.unitScale;e.set("scale",{x:n,y:n}),e.set("translate",{x:0,y:0})}function ye(){var t=arguments,e=t[t.length-1],r=this.event_pump;r.listeners.forEach(n=>{!function(t,e,r,n,i){for(let s in r){let a=r[s];if(g(s,n.origin,0,t))for(let t in a){let r=a[t];t==n.name&&(n.listener=e,r.apply(e,i))}}}(r.deliverer,n.listener,n.cloned_handlers,e,t)})}zt.register("container",ge);class ve{constructor(t){if(void 0===t.on)throw new Error("Deliverer should be a event handlable object.");this.deliverer=t,this.listeners=[]}start(){this.deliverer.on("(all)",ye,{event_pump:this})}stop(){this.deliverer.off("(all)",ye)}on(t,e){var r=Object.assign({},e);Object.keys(r).forEach(e=>{if(0==e.indexOf("?")){let n=r[e],i=e.substr(1),s=t.get(i);delete r[e],s?r[s]=n:Object(Z.c)("EventPump#on","variable #{selector} is not evaluated on listener")}}),this.listeners.push({listener:t,handlers:e,cloned_handlers:r})}off(t,e){for(let r=0;r<this.listeners.length;r++){let n=this.listeners[r];n.listener!==t||e&&n.handlers!==e||this.listeners.splice(r,1)}}clear(){this.listeners=[]}dispose(){this.stop(),this.clear()}}class xe{constructor(t){this.eventMaps=[],this.root=t,t.eventMap&&this.add(t,t.eventMap)}set root(t){this._root=t}get root(){return this._root}stop(){this.eventMaps.forEach(t=>t.eventPump.stop())}add(t,e){if(this.root)for(let r in e){let n=e[r];if("(self)"===r&&void 0===t.on)throw new Error("(self) selector not available when deliverer is not a event handlable object.");y(r,this.root,t).forEach(r=>{var i=new ve(r);i.on(t,n),i.start(),this.eventMaps.push({eventPump:i,listener:t,handlerMap:e,deliverer:r})})}}remove(t,e){var r=this.eventMaps.slice(0);for(let n=0;n<r.length;n++){let i=r[n];i.listener!==t||e&&i.handlerMap!==e||(this.eventMaps.splice(n,1),i.eventPump.dispose())}}clear(){this.eventMaps.slice(0).forEach(t=>t.eventPump.dispose()),this.eventMaps=[]}dispose(){this.stop(),this.clear()}}const _e={NORMAL:0,DRAGGABLE:1,DRAGGING:2},be={NORMAL:0,TOUCH_START:1,TOUCH_MOVE:2,TOUCH_END:3,TOUCH_CANCEL:4},we=16,Ae=500,Ee=500;var ke={},Se=0;class Me{constructor(t){this._type=t.type,this._ctrlKey=t.ctrlKey,this._altKey=t.altKey,this._shiftKey=t.shiftKey,this._metaKey=t.metaKey;var e=function(t){if(t.touches){let e=t.touches[0];if(!e)return ke;let r=t.target.getBoundingClientRect();return ke={x:t.offsetX||e.clientX-(r.x||r.left),y:t.offsetY||e.clientY+(r.y||r.top)}}return{x:t.offsetX,y:t.offsetY}}(t);if(this._offsetX=e.x,this._offsetY=e.y,"wheel"==t.type)this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaZ=t.deltaZ;else if("drop"==t.type)this.dataTransfer=t.dataTransfer;else if(t.type.match(/^touch/)&&(this._scale=t.scale,this._touches=t.touches,this._changedTouches=t.changedTouches,null==this._scale)){var r=function(t){var e,r,n=0,i=0,s=0;if(1===t.touches.length)return s;Array.from(t.touches).forEach(t=>{e=null!=e?Math.min(t.screenX,e):t.screenX,n=Math.max(t.screenX,n),r=null!=r?Math.min(t.screenY,r):t.screenY,i=Math.max(t.screenY,i)});var a=n-e||0,o=i-r||0;return s=Math.sqrt(Math.pow(a,2)+Math.pow(o,2))||0}(t);Se>0&&(this._scale=r/Se),Se=r}}get type(){return this._type}set type(t){this._type=t}get offsetX(){return this._offsetX}get offsetY(){return this._offsetY}get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get shiftKey(){return this._shiftKey}get metaKey(){return this._metaKey}get touches(){return this._touches}get changedTouches(){return this._changedTouches}get scale(){return this._scale}stopPropagation(){this._stop_=!0}isPropagationStopped(){return this._stop_}}function Pe(t,e){return t.capture(e.offsetX,e.offsetY)}function Te(t,e,r){if(t&&t.app&&(!t.app.isViewMode||!t.hidden)){(r=new Me(r)).type=e;var n="on"+e;t[n]&&t[n](r),r.isPropagationStopped()||t.trigger(e,r)}}class Ce{constructor(t,e){this.container=t,this.html_element=e,this.status=_e.NORMAL,this.last_target=null,this.gesture_handlers=lt.map(t=>this.gestureHandlerBuilder(t)),this.keyevent_handlers=ht.map(t=>this.keyeventHandlerBuilder(t)),lt.forEach((t,r)=>e.addEventListener(t,this.gesture_handlers[r])),ht.forEach((t,r)=>e.addEventListener(t,this.keyevent_handlers[r])),e.ondragover=this.gestureHandlerBuilder("dragover"),e.ondrop=this.gestureHandlerBuilder("drop"),e.tabIndex=1}dispose(){lt.forEach((t,e)=>this.html_element.removeEventListener(t,this.gesture_handlers[e])),ht.forEach((t,e)=>this.html_element.removeEventListener(t,this.keyevent_handlers[e])),delete this.gesture_handlers,delete this.keyevent_handlers,delete this.last_target}gestureHandlerBuilder(t){var e=this[`on${t}`].bind(this);return t=>(e(new Me(t))&&t.preventDefault(),!1)}keyeventHandlerBuilder(t){return this[`on${t}`].bind(this)}ondragover(t){return Te(Pe(this.container,t),t.type,t),!1}ondrop(t){return Te(Pe(this.container,t),t.type,t),!1}onclick(t){return Te(Pe(this.container,t),t.type,t),this.last_target=null,!1}ondblclick(t){return Te(Pe(this.container,t),t.type,t),this.last_target=null,!1}onkeydown(t){return this.container.trigger(t.type,t),!1}onkeyup(t){return this.container.trigger(t.type,t),!1}onmousemove(t){switch(this.status){case _e.DRAGGABLE:let r=t.offsetX-this.__dragstart_e.offsetX,n=t.offsetY-this.__dragstart_e.offsetY;if(r*r+n*n<we)break;this.status=_e.DRAGGING,Te(this.last_target,"dragstart",this.__dragstart_e),this.__dragmove_e=t,Te(this.last_target,"dragmove",t);break;case _e.DRAGGING:this.__dragmove_e=t,Te(this.last_target,"dragmove",t);break;default:var e=Pe(this.container,t);this.last_target!==e&&(this.last_target&&Te(this.last_target,"mouseleave",t),e&&Te(e,"mouseenter",t)),Te(e,t.type,t),this.last_target=e}return!1}onmousedown(t){switch(this.status){case _e.DRAGGING:Te(this.last_target,"dragend",t),this.last_target=null,this.status=_e.NORMAL;break;default:var e=Pe(this.container,t);this.last_target=e,this.status=_e.DRAGGABLE,this.__dragstart_e=t,Te(e,t.type,t)}return!1}onmouseup(t){switch(this.status){case _e.DRAGGING:Te(this.last_target,"dragend",t);break;default:Te(Pe(this.container,t),t.type,t)}return this.last_target=null,this.status=_e.NORMAL,!1}onmouseout(t){var e=Pe(this.container,t);switch(this.status){case _e.DRAGGING:Te(this.last_target,"dragend",t);break;default:if(this.last_target&&this.last_target===e)return;this.last_target&&Te(this.last_target,"mouseleave",t)}return this.last_target=null,this.status=_e.NORMAL,!1}ontouchstart(t){var e=Pe(this.container,t);return this.last_target=e,this.status=be.TOUCH_START,this.touchPoints||(this.touchPoints=[]),this.touchPoints.push(t.changedTouches[0]),this.holdTimer=setTimeout(()=>{this.status=be.NORMAL,Te(this.last_target,"hold",t),delete this.holdTimer},Ee),Te(e,t.type,t),!1}ontouchmove(t){if(!t.touches||!t.changedTouches)return Te(this.last_target,"dragstart",t),Te(this.last_target,"dragmove",t),!1;var e=Pe(this.container,t);switch(this.status){case be.TOUCH_START:Array.from(t.changedTouches).forEach(t=>{var e=this.touchPoints.find(e=>e.identifier===t.identifier);if(e){var r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(Math.pow(r,2)+Math.pow(n,2))>=we?(this.status=be.TOUCH_MOVE,void(this.holdTimer&&(clearTimeout(this.holdTimer),delete this.holdTimer))):void 0}});break;case be.TOUCH_MOVE:if(this.holdTimer&&(clearTimeout(this.holdTimer),delete this.holdTimer),2===t.changedTouches.length&&null!=t.scale&&1!==t.scale&&(t.scale<.9||t.scale>1.1))return Te(this.last_target,"pinch",t),!1;Te(this.last_target,"pan",t),e=this.last_target;break;default:this.last_target!==e&&(this.last_target&&Te(this.last_target,"mouseleave",t),e&&Te(e,"mouseenter",t)),this.last_target=e}return Te(e,"touchmove",t),!1}ontouchend(t){var e=Pe(this.container,t);switch(this.status){case be.TOUCH_MOVE:e=this.last_target;break;case be.TOUCH_START:var r=performance.now(),n=r-this.touchedAt;this.holdTimer&&(clearTimeout(this.holdTimer),delete this.holdTimer,Te(e,n<Ae?"doubletap":"tap",t),this.touchedAt=r)}Te(e,"touchend",t);var i=this.touchPoints.findIndex(e=>e.identifier===t.changedTouches[0].identifier);return this.touchPoints.splice(i,1),this.last_target=null,this.status=be.NORMAL,!1}onwheel(t){return Te(Pe(this.container,t),t.type,t),!0}}var Ie={};var Oe={register:function(t,e){Ie[t]=e},unregister:function(t){delete Ie[t]},get:function(t){return Ie[t]}};class Re{constructor(t){this.params=Object.assign({},t)}excute(){}}class Be extends Re{execute(){this.params.changes.forEach(t=>t.component.set(t.after))}static before(t){return t.map(t=>({component:t}))}static after(t,e){e.execute(null,!1)}static around(t,e,r){e.call(r),t.execute(null,!1)}}function Le(t){if(t.hasTextProperty&&!t.textHidden){var{text:e="",rotation:r=0,bold:n=ct.BOLD,italic:i=ct.ITALIC,textWrap:s=ct.TEXT_WRAP,fontFamily:a=ct.FONT_FAMILY,fontColor:o=ct.FONT_COLOR,textAlign:l=ct.TEXT_ALIGN,textBaseline:h=ct.TEXT_BASELINE,paddingTop:c=0,paddingBottom:d=0,paddingLeft:u=0,paddingRight:p=0,fontSize:f=ct.FONT_SIZE,lineHeight:g=1.2*f}=t.model,{left:m,top:y,width:v,height:x}=t.bounds;t.textHidden=!0;var _=document.createElement("textarea");lt.forEach(function(t){_.addEventListener(t,function(t){t.stopPropagation()},!0)}),ht.forEach(function(t){_.addEventListener(t,function(t){t.stopPropagation()},!0)});var b=t.transcoordS2C(m,y),{rotation:r,scale:w}=function(t){for(var e=0,r=1,n=t;n;){e+=n.get("rotation")||0;let{x:t,y:i}=n.get("scale")||{x:1,y:1};r*=Math.max(t,i)||1,n=n.parent}return{rotation:e,scale:r}}(t),A=v-u-p,E=A,k=x-c-d;switch(_.style.position="absolute",_.style.width=E+"px",_.style.height=k+"px",_.style.paddingLeft=Math.max(u,0)+"px",_.style.paddingRight=p+"px",_.style.paddingTop=Math.max(c,0)+"px",_.style.paddingBottom=d+"px",_.value=e,_.style.fontFamily=a,_.style.fontSize=f+"px",_.style.lineHeight=g+"px",_.style.overflow="hidden",_.style.resize="none",_.style.outline="none",_.style.border=0,_.style.backgroundColor="transparent",_.style.display="inline-block",_.style.color=o,n&&(_.style.fontWeight="bold"),i&&(_.style.fontStyle="italic"),l){case"right":case"end":_.style.textAlign="right";break;case"justify":_.style.textAlign="justify";break;case"left":case"start":_.style.textAlign="left";break;case"center":default:_.style.textAlign="center"}var S=[n,i,f+"px",a].filter(t=>!!t).join(" ");O(e);var M=t.root.target_element;M.appendChild(_),_.select();var P,T=!1;_.onkeydown=function(t){"Escape"!=t.code&&(t.shiftKey||"Enter"!=t.code&&"NumpadEnter"!=t.code)?setTimeout(()=>{O(_.value)}):(T=P.skipUpdate="Escape"==t.code,document.createEvent?_.dispatchEvent(P):_.fireEvent(P.eventType,P))},document.createEvent?(P=document.createEvent("HTMLEvents")).initEvent("blur",!0,!1):(P=document.createEventObject()).eventType="blur";var C=t.root.selected,I=function(r){t.root.selected=C,t.textHidden=!1,_.removeEventListener("blur",I,!1),_.parentElement&&_.parentElement.removeChild(_),M.focus(),r.skipUpdate||T||t.app.commander.execute(new Be({changes:[{component:t,before:{text:e},after:{text:_.value}}]}))};_.addEventListener("blur",I,!1)}function O(e){var n={left:0,top:0},i=g*function(t,e,r,n){var i,s=t.getContext();return s.save(),s.font=r,i=ut(s,e,n,t.get("textWrap")).length,s.restore(),i}(t,e,S,A);switch(_.style.height=i+"px",h){case"top":case"hanging":break;case"bottom":case"alphabetic":n.top=k-i;break;case"middle":default:n.top=k/2-i/2}if(!s){var a=function(t,e,r,n){var i=e.split("\n"),s=n;let a=t.getContext();return a.save(),a.font=r,i.forEach(t=>{let e=a.measureText(t).width;e>s&&(s=e)}),a.restore(),s}(t,e,S,A);switch(_.style.width=a+"px",l){case"right":case"end":n.left=A-a;break;case"left":case"start":break;case"center":case"justify":default:n.left=(A-a)/2}}_.style.marginLeft=n.left+"px",_.style.marginTop=n.top+"px";var o=`translate(${b.x}px, ${b.y}px) scale(${w}) rotate(${r}rad) perspective(1px)`;["-webkit-","-moz-","-ms-","-o-",""].forEach(t=>{_.style[t+"transform"]=o,_.style[t+"transform-origin"]=`${-n.left}px ${-n.top}px`})}}function De(t){var e=Object(v.a)(t.hierarchy);return void 0!==e.id&&delete e.id,ci(e,t.app)}Oe.register("text-editor",{"(root)":{"(self)":{keydown:function(t,e){var{origin:r,deliverer:n}=e,i=n.selected;return!(1!==i.length||!i[0].hasTextProperty||"Enter"!=t.code&&"NumpadEnter"!=t.code||(Le(i[0]),t.preventDefault(),0))}}},"model-layer":{"(descendant)":{dblclick:function(t,e){Le(e.origin)}}}});const He=["left","top","width","height","rotation","animation"];class Fe extends ge{isGroup(){return!0}get(t){return this._model[t]}set(t,e){if("string"==typeof t)return this.set({[t]:e});var r=He.reduce((e,r)=>(t.hasOwnProperty(r)&&(e[r]=t[r]),e),{});return super.set(r)}capture(t,e){var r=super.capture(t,e);if(r!==this)return r}set bounds(t){if(this.__MUTATING__)super.bounds=t;else{var e=this.bounds,r=t.width/e.width,n=t.height/e.height;this.path=this.path.map(i=>({x:t.left+(i.x-e.left)*r,y:t.top+(i.y-e.top)*n})),this.components&&this.components.forEach(t=>{if(t.mutable)t.mutatePath(null,function(t){return t.map(function(t){return{x:t.x*r,y:t.y*n}})});else{let e=t.bounds,i=t.center,s={x:i.x*(1-r),y:i.y*(1-n)},a=e.width*(1-r),o=e.height*(1-n),l=-(s.x-a/2),h=-(s.y-o/2);t.bounds={left:e.left+l,top:e.top+h,width:e.width*r,height:e.height*n}}})}}get focusible(){return!1}get bounds(){return super.bounds}get hasTextProperty(){return!1}calculateBounds(){this.clearCache(),this.__MUTATING__=!0,this.mutateBounds(function(t){var e=zt.union(this.components.map(t=>t.bounds));return this.components.forEach(t=>{let r=t.bounds;t.bounds={left:r.left-e.left,top:r.top-e.top,width:r.width,height:r.height}}),{left:t.left+e.left,top:t.top+e.top,width:e.width,height:e.height}},this),this.__MUTATING__=!1,this.parent.isGroup()&&this.parent.calculateBounds()}render(t){}postrender(t){var{top:e,left:r,scale:n}=this.model;t.translate(r,e),this.layout.drawables(this).forEach(e=>{e.draw(t)}),t.translate(-r,-e)}}function Ne(t){for(var e=0;t&&!t.isRootModel();)e+=t.get("rotation")||0,t=t.parent;return e%(2*Math.PI)}zt.register("group",Fe);class Ye extends Re{execute(){this.params.changes.forEach(t=>{let{component:e,to_container:r,to_index:n,to_left:i,to_top:s,hint:a}=t,o=function(t){if(t.isRootModel())return t.bounds;var{bounds:e,rotatePoint:r}=t,n=r;return{left:(n=t.transcoordS2T(n.x,n.y)).x-(r.x-e.left),top:n.y-(r.y-e.top),width:e.width,height:e.height}}(e),l=Ne(e);if(e.removeSelf(!r),e.bounds=o,e.set("rotation",l),r){e.set("rotation",function(t,e){return((t.get("rotation")||0)-Ne(e))%(2*Math.PI)}(e,r));let a=function(t,e){if(e.isRootModel())return t.bounds;var{bounds:r,rotatePoint:n}=t,i=e.transcoordT2S(n.x,n.y),s=e.bounds;return{left:i.x-(n.x-r.left)-s.left,top:i.y-(n.y-r.top)-s.top,width:r.width,height:r.height}}(e,r);t.to_left=void 0!==i?i:a.left,t.to_top=void 0!==s?s:a.top,e.bounds={left:t.to_left,top:t.to_top,width:a.width,height:a.height},void 0===n?r.addComponent(e):r.insertComponentAt(e,n)}})}}const je=0,ze=2,We=3,Ge=4;var Ue=Object(v.b)(function(t,e,r){if(r)t.focused=null;else{var n=[];e[0].parent.isGroup()?t.focused=e[0].parent:(e.forEach(t=>{t.path.forEach(e=>{n.push(t.transcoordS2T(e.x,e.y))})}),t.focused=t.capturePath(n,e))}},300);Oe.register("move-handler",{"model-layer":{"(descendant)":{dragstart:function(t,e){var{origin:r,deliverer:n}=e;if(!r.stuck){var i=n.selected,s=n.selected.filter(t=>!t.stuck);if(i.length!==s.length&&(i=n.selected=s),0!=i.length){var a=i[0].transcoordC2S(t.offsetX,t.offsetY);a=i[0].transcoordS2P(a.x,a.y),this.last_pos=a,this.direction=je,n.focused=i[0].parent,t.altKey?(n.selected=i.map(t=>{let e=De(t);return t.parent.addComponent(e),e}),this.duplicates=n.selected.map(t=>({component:t}))):this.changes=Be.before(i)}}},dragmove:function(t,e){var{origin:r,deliverer:n}=e;if(!r.stuck){var i=n.selected;if(0!=i.length){var{x:s,y:a}=i[0].transcoordC2S(t.offsetX,t.offsetY),o=i[0].transcoordS2P(s,a);t.shiftKey?this.direction==ze&&(this.direction=je):this.direction=ze;var l=o.x-this.last_pos.x,h=o.y-this.last_pos.y;if(this.direction==je){if(l*l+h*h<25)return;Math.abs(l)>Math.abs(h)?this.direction=We:this.direction=Ge}this.direction==We?h=0:this.direction==Ge&&(l=0),i.forEach(t=>{t.move({x:l,y:h})}),this.last_pos=o,Ue(n,i)}}},dragend:function(t,e){var{origin:r,deliverer:n}=e;if(!r.stuck){var i=n.selected;if(0!=i.length){var s=r.parent,a=n.focused||e.deliverer;if(this.changes&&!a.isGroup())if(a&&a!==s){var o=this.changes.map(t=>{let{component:e,before:r}=t;return{component:e,to_container:a}});n.app.commander.execute(new Ye({changes:o}))}else Be.after(this.changes,n.app.commander);else if(this.duplicates){this.duplicates=this.duplicates.map(t=>(t.to_container=a,t));let t=new Ye({changes:this.duplicates});n.app.commander.execute(t)}i.forEach(t=>{t.parent&&t.parent.calculateBounds&&t.parent.calculateBounds()}),this.last_pos=null,this.changes=null,this.duplicates=null,Ue(n,i,!0)}}}}},"(root)":{"(self)":{keydown:function(t,e){var{origin:r,deliverer:n}=e,i={},s=t.shiftKey?r.rootModel.MPP:1;switch(t.which){case 37:i.x=-s,i.y=0;break;case 38:i.x=0,i.y=-s;break;case 39:i.x=s,i.y=0;break;case 40:i.x=0,i.y=s;break;default:return}var a=n.selected;Be.around(n.app.commander,function(){a.forEach(t=>{!t.stuck&&t.move(i)})})}}}});const Xe="center",qe="left-top",Qe="right-top",Ve="left-bottom",Ke="right-bottom",Je="auto",Ze='\n<div class="popup-content">\n</div>\n<button class="closable">&#88</button>\n',$e="\nbutton.closable {\n  width: 20px;\n  height: 20px;\n  right: 0px;\n  top: 0px;\n  padding: 0;\n  margin: 0;\n  border: 0px;\n  text-align: center;\n  cursor: pointer;\n  font-size: 12px;\n  color: black;\n  position: absolute;\n  background-color: transparent;\n}\n\nbutton.closable:hover {\n  background-color:#60bb23;\n}\n",tr=20,er=new WeakMap;function rr(t){var e=er.get(t);if(e){var r=e.div.parentNode;r&&r.removeChild(e.div);var n=e.scene;n.target=null,n.release(),er.delete(t)}}function nr(t){rr(t)}function ir(t,e,r={}){var{data:n,location:i=Xe}=r,s=t.app.refProvider;s&&s.get(e,!0).then(function(e){var r=document.createElement("div");r.style.position="absolute",r.style.display="inline-block",r.innerHTML=Ze;var s=r.querySelector(".popup-content"),{width:a,height:o}=e.root.model;s.style.width=a+"px",s.style.height=o+"px";var l=document.createElement("style");l.type="text/css",l.styleSheet?l.styleSheet.cssText=$e:l.appendChild(document.createTextNode($e)),r.appendChild(l),lt.forEach(function(t){r.addEventListener(t,function(t){t.stopPropagation()})}),ht.forEach(function(t){r.addEventListener(t,function(t){t.stopPropagation()})}),t.root.model_layer.overlay.appendChild(r),function(t,e,r){rr(t),er.set(t,{div:e,scene:r})}(t.root,r,e),r.querySelector(".closable").addEventListener("click",function(e){e.preventDefault(),nr(t.root)},!1),e.target=s,e.data=n||t.data,e.fit("both");var h=function(t,e,r,n=Xe){var i=t.bounds,s=e.bounds,a=Math.max(i.width/4-s.width/2,tr),o=Math.min(3*i.width/4+s.width/2,i.width-tr)-s.width,l=Math.max(i.height/4-s.height/2,tr),h=Math.min(3*i.height/4+s.height/2,i.height-tr)-s.height;switch(n){case Je:return{x:r.x<i.width/2?o:a,y:r.y<i.height/2?h:l};case qe:return{x:a,y:l};case Qe:return{x:o,y:l};case Ve:return{x:a,y:h};case Ke:return{x:o,y:h};case Xe:default:return{x:(i.width-s.width)/2,y:(i.height-s.height)/2}}}(t.rootModel,e.root,t.center,i);r.style.left=h.x+"px",r.style.top=h.y+"px"},function(t){console.error("cannot fetch board: "+e,t)})}var sr=[];"undefined"!=typeof window&&window.addEventListener("resize",()=>{sr.forEach(t=>{t.resize()})});class ar extends ce{constructor(t,e){super(Object.assign({type:"root",scale:{x:1,y:1}},t||{}),e),t=t||{},this._app=e,this.target_element=t.target_element,this.rebuildContentModel(this.model.model),sr.push(this)}dispose(){this._app&&this._app.dispose(),super.dispose(),this._disposeAllResources(),this.target_element=null,delete this._refresh_mapping_debouncer,nr(this);var t=sr.indexOf(this);t>=0&&sr.splice(t,1)}isRoot(){return!0}get app(){return this._app}get target_element(){return this._target_element}set target_element(t){this._ua_event_handler&&(this._ua_event_handler.dispose(),delete this._ua_event_handler),t&&(this._ua_event_handler=new Ce(this,t)),this.forEach(e=>e.target=t),this._target_element=t}variable(t,e){var r=this.findById(t);if(!r){let e=this.findTemplateFor(t);if(!e)return;r=ci(Object.assign(v.a(e.hierarchy),{id:t,templatePrefix:""}),this.app),this.model_layer.addComponent(r)}if(void 0===e)return r.data;r.data=e,r.touch()}buildVariables(t){!t||t instanceof Array||(t=Object.keys(t).map(e=>{let r=t[e];return r.key=e,r})),t&&t.forEach((t,e)=>{let r=this.indexMap[t.key];if(r)r.set({data:t.value,mappings:t.mappings&&t.mappings.slice(),dataType:t.dataType});else{let r=ci({type:"variable",id:t.key,left:-120,top:0+20*e,strokeStyle:"black",width:100,height:20,dataType:t.type,data:t.value,mappings:t.mappings&&t.mappings.slice()},this.app);this.model_layer.addComponent(r)}})}get unitScale(){switch(this.model_layer.get("unit")){case"mm":case"cm":case"in":return this.app.PPM/10;case"px":default:return 1}}addTemplate(t,e){var r=this.templateMap[t];r&&Object(Z.b)("Template replaced (duplicated)",t,e,r),this.templateMap[t]=e,delete this.templatePrefixes}removeTemplate(t,e){var r=this.templateMap[t];r!==e?Object(Z.c)("Removing template failed (different)",t,e,r):delete this.templateMap[t],delete this.templatePrefixes}findTemplateFor(t){this.templatePrefixes||(this.templatePrefixes=Object.keys(this.templateMap).sort().reverse());var e=this.templatePrefixes.find(e=>t.startsWith(e));if(e)return this.templateMap[e]}addIndex(t,e){var r=this.indexMap[t];r&&Object(Z.b)("Index replaced (duplicated)",t,e,r),this.indexMap[t]=e}removeIndex(t,e){var r=this.indexMap[t];r!==e?Object(Z.c)("Removing index failed (different)",t,e,r):delete this.indexMap[t]}findById(t){return this.indexMap[t]}findOrCreate(t){var e=this.indexMap[t];if(!e){let r=this.findTemplateFor(t);if(r){e=ci(Object.assign(v.a(r.hierarchy),{id:t,templatePrefix:""}),this.app),this.model_layer.addComponent(e)}}return e}resize(){this.components.forEach(t=>{t.resize&&t.resize()}),this.invalidate()}_disposeAllResources(){this.selected=[],this._focused=null,this._ready=!1,this.eventEngine&&(this.assist_handlers&&this.assist_handlers.forEach(t=>{this.eventEngine.remove(t)}),this.eventEngine.dispose(),delete this.eventEngine),this.assist_layers&&this.assist_layers.forEach(t=>{t.dispose(),this.removeComponent(t)}),delete this.assist_layers,this.model_layer&&this.model_layer.dispose(),this.model_layer&&this.removeComponent(this.model_layer),delete this.model_layer,this.indexMap={},this.templateMap={}}rebuildContentModel(t){this._disposeAllResources(),this.eventEngine=new xe(this),(t=t||{}).type="model-layer";var e=t.variables;delete t.variables,this.model_layer=ci(t,this.app),this.model_layer.target=this.target_element,this.addComponent(this.model_layer),e&&this.buildVariables(e),this.assist_layers=(this.model.layers||[]).map(t=>{var e=ci(t,this.app);return e.target=this.target_element,this.addComponent(e),e}),this.assist_handlers=(this.model.handlers||[]).map(t=>{var e={};return this.eventEngine.add(e,Oe.get(t)),e}),this._ready=!0,this.traverse(t=>t.ready())}get root(){return this}get isReady(){return this._ready}get rootModel(){return this.model_layer}get stuck(){return!0}get data(){return Object.values(this.indexMap).reduce((t,e)=>{return t[e.model.id]=e.data,t},{})}set data(t){for(var e in t){var r=this.findOrCreate(e);r&&(r.data=t[e])}}get selected(){return(this._selected||[]).filter(t=>t.parent)}set selected(t){var e=this._selected;this._selected=t,this.trigger("selected",t,e)}get focused(){return this._focused}set focused(t){this._focused!==t&&(this._focused=t,this.invalidate())}get style(){return this._style}set style(t){this._style=t,this._compiled_style=function(t){return t}(t)}get hasTextProperty(){return!1}render(){this.components.forEach(t=>t.draw())}contains(t,e){return!0}capturePath(t,e){return this.model_layer.capturePath(t,e)}invalidate(){this.components.forEach(t=>t.invalidate())}get eventMap(){return{"(root)":{"(descendant)":{added:this.onadded,removed:this.onremoved,change:this.onchanged}}}}refreshMappings(){if(!this._refresh_mapping_debouncer){if(this.disposed)return;this._refresh_mapping_debouncer=v.b(function t(e){e.executeMappings(),e.components&&e.components.forEach(e=>t(e))},1e3)}this._refresh_mapping_debouncer(this.model_layer)}_addTraverse(t){t.components&&t.components.forEach(t=>this._addTraverse(t));var{id:e,templatePrefix:r}=t.model;e&&this.addIndex(e,t),r&&this.addTemplate(r,t);var n=v.d({},t.eventMap,t.model.eventMap);this.eventEngine.add(t,n)}_removeTraverse(t){t.components&&t.components.forEach(t=>this._removeTraverse(t));var{id:e,templatePrefix:r}=t.model;e&&this.removeIndex(e,t),r&&this.removeTemplate(r,t),this.eventEngine.remove(t)}onadded(t,e){this._addTraverse(e),this.refreshMappings(),this.invalidate()}onremoved(t,e){this._removeTraverse(e),this.invalidate()}onchanged(t,e,r){e.templatePrefix&&this.removeTemplate(e.templatePrefix,r.origin),t.templatePrefix&&this.addTemplate(t.templatePrefix,r.origin),e.id&&this.removeIndex(e.id,r.origin),t.id&&this.addIndex(t.id,r.origin),e.id==t.id&&e.class==t.class||this.refreshMappings()}}Object.assign(ar.prototype,{fit:function(t){var{width:e,height:r}=this.model_layer.model,n=this.target_element,i=this.model_layer;if(e&&r&&n&&n.offsetWidth&&n.offsetHeight)switch(t){case"center":!function(t,e,r){var n=t.unitScale,{width:i,height:s}=e.model;e.set("scale",{x:n,y:n}),e.set("translate",{x:Math.max((r.offsetWidth-i*n)/2,0),y:Math.max((r.offsetHeight-s*n)/2,0)})}(this,i,n);break;case"both":!function(t,e,r){var{width:n,height:i}=e.model,s=r.offsetWidth,a=r.offsetHeight;e.set("scale",{x:s/n,y:a/i}),e.set("translate",{x:0,y:0})}(0,i,n);break;case"width":!function(t,e,r){var n=r.offsetWidth/e.get("width");e.set("scale",{x:n,y:n}),e.set("translate",{x:0,y:0})}(0,i,n);break;case"height":!function(t,e,r){var n=r.offsetHeight/e.get("height");e.set("scale",{x:n,y:n}),e.set("translate",{x:0,y:0})}(0,i,n);break;case"ratio":!function(t,e,r){var{width:n,height:i}=e.model,s=r.offsetWidth,a=r.offsetHeight,o=s/n,l=a/i,h=Math.min(o,l);e.set("scale",{x:h,y:h}),e.set("translate",{x:(s-n*h)/2,y:(a-i*h)/2})}(0,i,n);break;case"none":default:me(this,i)}else me(this,i)}}),zt.memoize(ar.prototype,"unitScale",!1);class or extends zt{set rotationX(t){this.setState("rotationX",t)}get rotationX(){return this.getState("rotationX")}set rotationY(t){this.setState("rotationY",t)}get rotationY(){return this.getState("rotationY")}set rotationZ(t){this.setState("rotation",t)}get rotationZ(){return this.getState("rotation")}set zPos(t){this.setState("zPos",t)}get zPos(){return this.getState("zPos")}set depth(t){this.setState("depth",t)}get depth(){return this.getState("depth")}postrender(t){this.drawFill(t),this.drawStroke(t),super.postrender(t)}}const lr=5,hr=Math.sqrt(3),cr=2;function dr(t,e,r,n,i){var s,a,o,l,h=lr+i,c=r.x,d=r.y,u=n.x,p=n.y;if(Math.abs(c-u)>h&&Math.abs(d-p)>h){var f=(p-d)/(u-c),g=d-f*c;if(Math.abs(e-(f*t+g))>h)return!1}return c>u?(a=c,s=u):(a=u,s=c),d>p?(l=d,o=p):(l=p,o=d),!(a+lr<t)&&(!(s-lr>t)&&(!(l+lr<e)&&!(o-lr>e)))}function ur(t,e,r,n=2){for(let i=0;i<r.length-1;i++)if(dr(t,e,r[i],r[i+1],n))return!0;return!1}function pr(t,e,r,n){if("arrow"!=t.slice(-5))return r;var{x:i,y:s}=r,a=Math.atan2(n.y-r.y,n.x-r.x),o=1.5*e;return{x:r.x+Math.cos(a)*o,y:r.y+Math.sin(a)*o}}function fr(t,e,r){var{lineWidth:n=cr,strokeStyle:i="#000000",lineCap:s=!1,alpha:a=1,begin:o="none",end:l="none",beginSize:h="size5",endSize:c="size5"}=r;if(("none"!=o||"none"!=l)&&(n=Number(n)||cr,t.lineCap=s,t.lineWidth=n,t.strokeStyle=i,t.fillStyle=i,t.globalAlpha*=a,"none"!=o&&gr(t,e[0],e[1],n,o,mr(h,n)),"none"!=l)){let r=e.length;gr(t,e[r-1],e[r-2],n,l,mr(c,n))}}function gr(t,e,r,n,i,s){var{x:a,y:o}=e,l=Math.atan2(r.y-o,r.x-a);switch(t.beginPath(),t.translate(a,o),t.rotate(l),i){case"oval":t.ellipse(0,0,s.X,s.Y,0,0,2*Math.PI),t.fill();break;case"diamond":t.moveTo(-s.X,0),t.lineTo(0,-s.Y),t.lineTo(s.X,0),t.lineTo(0,s.Y),t.fill();break;case"arrow":t.moveTo(0,0),t.lineTo(hr*s.X,-s.Y),t.lineTo(hr*s.X,s.Y),t.fill();break;case"sharp-arrow":t.moveTo(0,0),t.lineTo(hr*s.X,-s.Y),t.lineTo(-s.X/1.5+hr*s.X,0),t.lineTo(hr*s.X,s.Y),t.fill();break;case"open-arrow":t.moveTo(hr*s.X+n,-s.Y),t.lineTo(n,0),t.lineTo(hr*s.X+n,s.Y),t.stroke()}t.rotate(-l),t.translate(-a,-o),t.closePath()}function mr(t,e){let r={};switch(e*=1.2,t){case"size1":r.X=e,r.Y=e;break;case"size2":r.X=1.5*e,r.Y=e;break;case"size3":r.X=2*e,r.Y=e;break;case"size4":r.X=e,r.Y=1.5*e;break;case"size5":r.X=1.5*e,r.Y=1.5*e;break;case"size6":r.X=2*e,r.Y=1.5*e;break;case"size7":r.X=e,r.Y=2*e;break;case"size8":r.X=1.5*e,r.Y=2*e;break;case"size9":r.X=2*e,r.Y=2*e;break;default:r.X=1.5*e,r.Y=1.5*e}return r}class yr extends zt{isLine(){return!0}get drawPath(){return this.path}render(t){var{begin:e="none",end:r="none",lineWidth:n}=this.model,i=this.drawPath;fr(t,i,this.model),t.beginPath();var s=pr(e,n,i[0],i[1]),a=pr(r,n,i[i.length-1],i[i.length-2]);t.moveTo(s.x,s.y);for(let e=1;e<i.length-1;e++)t.lineTo(i[e].x,i[e].y);t.lineTo(a.x,a.y),this.drawStroke(t)}contains(t,e){var{lineWidth:r}=this.model;return ur(t,e,this.drawPath,r)}get resizable(){return!1}get mutable(){return!0}get rotatable(){return!1}get path(){var{x1:t,y1:e,x2:r,y2:n}=this.model;return[{x:t,y:e},{x:r,y:n}]}set path(t){var e=t[0],r=t[1];this.set({x1:e.x,y1:e.y,x2:r.x,y2:r.y})}}yr.getTipNeckPos=pr,yr.containedInPath=ur,yr.drawEndTips=fr,zt.memoize(yr.prototype,"path",!1),zt.register("line",yr);class vr extends or{is3dish(){return!0}render(t){var{cx:e,cy:r,rx:n,ry:i,startAngle:s,endAngle:a,anticlockwise:o}=this.model;t.beginPath(),t.ellipse(e,r,Math.abs(n),Math.abs(i),0,s||0,a||2*Math.PI,o)}get path(){var{cx:t,cy:e,rx:r,ry:n}=this.model;return[{x:t-r,y:e-n},{x:t+r,y:e-n},{x:t+r,y:e+n},{x:t-r,y:e+n}]}set path(t){var e=t[0],r=t[2];this.set({cx:e.x+(r.x-e.x)/2,cy:e.y+(r.y-e.y)/2,rx:(r.x-e.x)/2,ry:(r.y-e.y)/2})}contains(t,e){var{cx:r,cy:n,rx:i,ry:s}=this.model,a=(t-r)/(2*i-.5),o=(e-n)/(2*s-.5);return a*a+o*o<.25}outline(t){return function(t,e){var{cx:r,cy:n,rx:i,ry:s}=t.model,a=2*Math.PI*e,o=r+i*Math.cos(a),l=n+s*Math.sin(a);return t.transcoordS2T(o,l)}(this,t)}}zt.memoize(vr.prototype,"path",!1),zt.register("ellipse",vr);const xr={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"round",name:"round",property:"round"}]};var _r={ondragmove:function(t,e,r){var{left:n,top:i,width:s,height:a}=r.model,o=(r.transcoordP2S(t.x,t.y).x-n)/(s/2)*100;o=br(o,s,a),r.set({round:o})}};function br(t,e,r){var n=e>r?r/e*100:100;return t>=n?t=n:t<=0&&(t=0),t}class wr extends(ae(or)){is3dish(){return!0}render(t){var{round:e=0}=this.model,{left:r,top:n,width:i,height:s}=this.bounds;t.translate(r,n),t.beginPath();var a=(e=br(e,i,s))/100*(i/2);t.moveTo(a,0),t.arcTo(i,0,i,s,a),t.arcTo(i,s,0,s,a),t.arcTo(0,s,0,0,a),t.arcTo(0,0,i,0,a),t.translate(-r,-n)}get controls(){var{left:t,top:e,width:r,round:n,height:i}=this.model;return[{x:t+r/2*((n=null==n?0:br(n,r,i))/100),y:e,handler:_r}]}get nature(){return xr}}zt.register("rect",wr);var Ar={ondragstart:function(t,e,r){r.mutatePath(null,function(r){r.splice(e+1,0,t)})},ondragmove:function(t,e,r){r.mutatePath(null,function(r){r[e+1]=t})},ondragend:function(t,e,r){}};class Er extends or{is3dish(){return!0}render(t){var{path:e=[]}=this.model;if(!(e.length<=1)){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let r=1;r<e.length;r++)t.lineTo(e[r].x,e[r].y);t.closePath()}}get mutable(){return!0}get pathExtendable(){return!0}get path(){return this.model.path}set path(t){this.set("path",t)}contains(t,e){var r=this.model.path,n=!1;return r.forEach((i,s)=>{let a=(s+r.length+1)%r.length,o=i.x,l=i.y,h=r[a].x,c=r[a].y;l>e!=c>e&&t<(h-o)*(e-l)/(c-l)+o&&(n=!n)}),n}get controls(){var t=this.path;return t.map((e,r)=>{let n=t[r+1>=t.length?0:r+1];return{x:(e.x+n.x)/2,y:(e.y+n.y)/2,handler:Ar}})}}zt.memoize(Er.prototype,"controls",!1),zt.register("polygon",Er);var kr={ondragstart:function(t,e,r){r.mutatePath(null,function(r){r.splice(e,0,t)})},ondragmove:function(t,e,r){r.mutatePath(null,function(r){r[e]=t})},ondragend:function(t,e,r){}};class Sr extends yr{get pathExtendable(){return!0}get path(){return this.model.path}set path(t){this.set("path",t)}get controls(){var t=this.path,e=[];for(let r=0;r<t.length-1;r++){let n=t[r],i=t[r+1];0==r&&e.push({x:n.x,y:n.y,handler:kr}),e.push({x:(n.x+i.x)/2,y:(n.y+i.y)/2,handler:kr}),r==t.length-2&&e.push({x:i.x,y:i.y,handler:kr})}return e}}zt.memoize(Sr.prototype,"controls",!1),zt.register("polyline",Sr);const Mr=[1,2,10,20,50,50,50,50,50,50];class Pr extends(ae(or)){render(t){const{lineWidth:e=1,fillStyle:r="lightgray",font:n="15px Arial",left:i,top:s,rotation:a,origin:o,margin:l,width:h,height:c,side:d="bottom",strokeStyle:u="#000000",scale:p=1}=this.model;t.translate(i,s),t.beginPath();const f=Math.round(e/2);t.rect(-f,-f,h+2*f,c+2*f),t.clip(),t.beginPath(),t.rect(0,0,h,c),r&&(t.fillStyle=r,t.fill()),t.lineWidth=e,t.strokeStyle=u,t.stroke(),t.beginPath(),t.font=n;var g="bottom"!==d,m=g?0:c,y=4*c/5,v=2*c/3,x=1*c/2,_=3*c/5;g&&(y=c-y,v=c-v,x=c-x,_=c-1.5*c/5);var b=p*this.app.PPM/this.root.unitScale,w=Math.ceil(o/b),A=this.app.PPM/b,E=A<=1.1?1:Mr[Math.round(A)]||100;1!=E&&(w+=(E-w%E)%E);var k=Math.ceil(w*b),S=o+h;for(t.fillStyle=u;k<S;){if(w%10==0){t.moveTo(k-o,x),t.lineTo(k-o,m);let e=(w/10).toString(),r=t.measureText(e);t.fillText(e,k-o-r.width-6,_)}else w%5==0?(t.moveTo(k-o,v),t.lineTo(k-o,m)):(t.moveTo(k-o,y),t.lineTo(k-o,m));w+=E,k=Math.ceil(w*b)}}}zt.register("ruler",Pr);const Tr={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"image-selector",label:"image-src",name:"src",property:{displayField:"id",displayFullUrl:!0,baseUrlAlias:"$base_url",defaultStorage:"scene-image",storageFilters:{type:Array,value:[{name:"category",value:"image"}]},useUpload:!0}}],"value-property":"src"},Cr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABIBAMAAAD7Se1QAAAAIVBMVEUAAABHcEwBAQEREREBAQEEBAQGBgYLCwsDAwMDAwMICAi6HF9tAAAAC3RSTlNNAEAERiMYCS41Eac10lYAAAEgSURBVHhe7dY9asQwEAXgh7DNertNiJy48pIitY3SB7bYdk0ukL1BDDmA9gZecoH4pmFQ3MQayUMguPBrNPD4wD9TCMvJmt3M/AtYwXOlXiWgqADVCUBD46MAnGhMBaCiUQmAm8VA/Eh/eWl9Fn5WcxD+OLuRrUYJDKLluwH2InACUgkoACSdADxQc50Bytadb9RkM0CT13TcvlCT1HFg8UTHvasuUVACCa3El6u2UdD8LFTlKhUFFgA+d3dj10aABkUN72N3jAADCrJq7PIIsPidcxBoTHIIAjMFmyCwmGYIAA1P9gFgfCANAOsDSccCDW+uLDB+kLGg94OkZoAGkwsDDAe2DOg5oPxAg03rBR88OHpBz4N8UVeHFSwma74BTW6Ge4rIRa4AAAAASUVORK5CYII=";class Ir extends(ae(or)){static get noimage(){return Ir.NOIMAGE||(Ir.NOIMAGE=new Image,Ir.NOIMAGE.src=Cr),Ir.NOIMAGE}dispose(){super.dispose(),this._offcanvas=null,this._image=null}render(t){var{left:e,top:r,width:n,height:i,isGray:s=!1,alpha:a=1,src:o}=this.model;if(this.prepareIf(!this._image&&o),t.beginPath(),t.globalAlpha*=a,this._image&&this._image.complete)if(s&&this._offcanvas)t.drawImage(this._offcanvas,e,r,n,i);else try{t.drawImage(this._image,e,r,n,i)}catch(s){t.drawImage(Ir.noimage,e,r,n,i)}else!this.app.isViewMode&&t.drawImage(Ir.noimage,e,r,n,i)}get nature(){return Tr}get hasTextProperty(){return!1}prepare(t,e){var{src:r}=this.model;if(r){this._image=new Image;try{"data"!==String(r).substring(0,4)?this._image.crossOrigin="use-credentials":this._image.crossOrigin=null,this._image.src="string"==typeof r?this.app.url(r):r}catch(t){return void e(t)}this._image.onload=(()=>{if(this.get("isGray")){let t=this._image.width,e=this._image.height;this._offcanvas=zt.createCanvas(t,e);let r=this._offcanvas.getContext("2d");r.drawImage(this._image,0,0);let n=function(t,e,r){try{var n=t.getImageData(0,0,e,r)}catch(t){return Object(Z.b)("Get Image Data Error: "+t.message),null}var i=n.data;for(let t=0;t<e*r*4;t+=4){let e=i[t],r=i[t+1],s=i[t+2],a=parseInt((e+r+s)/3);n.data[t]=a,n.data[t+1]=a,n.data[t+2]=a}return n}(r,t,e);r.putImageData(n,0,0)}t(this)}),this._image.onerror=(t=>{e(t)})}else t(this)}get src(){return this.get("src")}set src(t){this.set("src",t)}onchange(t,e){(t.hasOwnProperty("src")||t.hasOwnProperty("isGray"))&&(this._offcanvas=null,this._image=null,this.prepareIf(t.src))}ondropfile(t,e){for(let r=0;r<t.length;r++)if(t[r].type.startsWith("image/"))return void(this.src=e[r])}}zt.register("image-view",Ir);const Or={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"src",name:"src"},{type:"checkbox",label:"started",name:"started"},{type:"checkbox",label:"loop",name:"loop"}],"value-property":"src"},Rr="data:image/png;base64,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";class Br extends(ae(or)){static get image(){return Br.IMAGE||(Br.IMAGE=new Image,Br.IMAGE.src=Rr),Br.IMAGE}dispose(){super.dispose(),this.started=!1,delete this._audio}ready(){super.ready(),this._audio=new Audio,this._audio.addEventListener("canplay",()=>{console.log("audio canplay",this.started),this.started&&this._audio.play()});var{src:t="",loop:e=!1,started:r=!1}=this.state;this.onchangeSrc(t),this.onchangeLoop(e),this.onchangeStarted(r)}render(t){var{left:e,top:r,width:n,height:i,src:s}=this.model;t.beginPath(),t.drawImage(Br.image,e,r,n,i)}get nature(){return Or}get hasTextProperty(){return!1}get src(){return this.get("src")}set src(t){this.set("src",t)}get started(){return!!this.get("started")}set started(t){this.set("started",t)}start(){this._audio&&(this._audio.classList.add("active"),this._audio.play())}pause(){this._audio&&(this._audio.classList.remove("active"),this._audio.pause())}onchangeSrc(t){try{"data"!==String(t).substring(0,4)?this._audio.crossOrigin="use-credentials":this._audio.crossOrigin=null,this._audio.src="string"==typeof t?this.app.url(t):t}catch(t){return void console.error(t)}}onchangeStarted(t){const e=this._audio;t?4==e.readyState&&e.play():e.pause()}onchangeLoop(t){this._audio.loop=t}onchange(t,e){"src"in t&&this.onchangeSrc(t.src),"started"in t&&this.onchangeStarted(t.started),"loop"in t&&this.onchangeLoop(t.loop)}ondblclick(t){this.started=!this.started}ondropfile(t,e){for(let r=0;r<t.length;r++)if(t[r].type.startsWith("audio/"))return void(this.src=e[r])}}zt.register("audio",Br);class Lr extends(ae(zt)){is3dish(){return!0}}zt.register("text",Lr);const Dr={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"ref",name:"ref",property:"ref"},{type:"select",label:"fit",name:"fit",property:{options:["both","ratio"]}}],"value-property":"ref"};class Hr extends(ae(or)){get ref(){var t=this.getState("ref");return t&&"string"==typeof t?this.root.findById(t):null}set ref(t){this.setState("ref",t)}get refScale(){let t=this.ref.bounds,e=(this.ref.center,this.bounds),r=(this.center,e.width/t.width),n=e.height/t.height;switch(this.model.fit){case"both":return{x:r,y:n};case"ratio":default:return{x:Math.min(r,n),y:Math.min(r,n)}}}draw(t){this._drawing||(this._drawing=!0,super.draw(t),this._drawing=!1)}prerender(t){if(super.prerender(t),this.ref){let e=this.ref.center,r=this.center,n=this.refScale;t.translate(r.x,r.y),t.scale(n.x,n.y),t.translate(-e.x,-e.y)}}postrender(t){if(this.ref)return this.ref.postrender(t);super.postrender(t)}render(t){if(this.ref)return this.ref.render(t);var{round:e=0}=this.model,{left:r,top:n,width:i,height:s}=this.bounds;t.beginPath(),t.rect(r,n,i,s)}get nature(){return Dr}get hasTextProperty(){return!1}}zt.memoize(Hr.prototype,"ref",!1),zt.memoize(Hr.prototype,"refScale",!1),zt.register("local-ref",Hr);const Fr={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"scene-number",name:"ref",placeholder:"SCENE-1"},{type:"select",label:"fit",name:"fit",property:{options:["both","ratio"]}}],"value-property":"ref"};class Nr extends(ae(or)){dispose(){this._releaseRef(),super.dispose()}get nature(){return Fr}get hasTextProperty(){return!1}get refScale(){if(!this.ref)return;var t=this.ref.root;let e=t.bounds,r=(t.center,this.bounds);this.center;if(!e.width||!e.height)return;let n=r.width/e.width,i=r.height/e.height;switch(this.model.fit){case"both":return{x:n,y:i};case"ratio":default:return{x:Math.min(n,i),y:Math.min(n,i)}}}get ref(){if(this.__ref||this.__waiting)return this.__ref;var t=this.app.refProvider,e=this.getState("ref");if(t&&e){var r=this;r.__waiting=!0,t.get(e,!0).then(t=>{r.__ref=t,r.__ref.on("redraw",r.onredraw_ref,r),delete r.__waiting},t=>{delete r.__waiting})}return this.__ref}set ref(t){this.setState("ref",t)}draw(t){this._drawing||(this._drawing=!0,super.draw(t),this._drawing=!1)}prerender(t){if(super.prerender(t),this.ref){let e=this.ref.root.center,r=this.center,n=this.refScale;t.translate(r.x,r.y),n&&t.scale(n.x,n.y),t.translate(-e.x,-e.y)}}postrender(t){if(this.ref)return this.ref.root.postrender(t);super.postrender(t)}render(t){if(this.ref)return this.ref.root.render(t);var{round:e=0}=this.model,{left:r,top:n,width:i,height:s}=this.bounds;t.beginPath(),t.rect(r,n,i,s)}_releaseRef(){this.__ref&&this.__ref.release&&(this.__ref._container.off("redraw",this.onredraw_ref,this),this.__ref.release()),delete this.__ref}onredraw_ref(){this.invalidate()}onchange(t,e,r){(e.ref||t.ref)&&this._releaseRef()}}zt.memoize(Nr.prototype,"ref",!1),zt.memoize(Nr.prototype,"refScale",!1),zt.register("global-ref",Nr);const Yr={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"textarea",label:"front-side-template",name:"frontSideTemplate",property:{language:"html"}},{type:"textarea",label:"back-side-template",name:"backSideTemplate",property:{language:"html"}},{type:"textarea",label:"style",name:"style",property:{language:"css"}}]},jr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAY1BMVEVHcEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADIAbxiAAAAIHRSTlMA+gPshCwwWFzYCeLRm7QRG6rLeDZI9JOJJDtjb1HAf1sAT80AAAQQSURBVHhe7MCBAAAAAMKw/KkzOMG2BAAAAKeu3lUohIEggO7jQi5qHqpgwML5/6+0F0y02z31FlvMMLKt86QMQ1ined2Evih1hFFjLfRWjgzDOGZ6JSiM00B9EuHALtQxJLiQBmqSBCeSUEuEGzs1BDjSaHxWOKK5Eyz/4SoMV/hp4+vtcPkdwZD/udwevNg7t1xXYRiKmkB7C+ENlPLq8fxHeX+RGjWQ1D45ldcIulBIvCvYJGBEadyTzxAcfY57NBjpLScOO/bzugcTHe7IMwiSLMcdHZhocMcMgTLjjgZM7F1bCJZ2v27ARGzYDwIk2Z+JYGJ/iiwQLMv+JAEThjkmRG64Q0Q+gIiIiIiIiIiIyFy0KRFt0bOJZAWSUigmkQaJaXhENiRnYBEpkZySRSRGcmIWEaQnYhHRSI5mESmQnIJFZIqQmGhiEYEbEnPjGlEGjYTogW/WUkOXENENSqZfEXmDiIiIiIiIiIiIiIiIiIiImq5ETIpRpBpjJCMeKy6Ri0ZS9MQjkmkkJs1YRDokp2MRyZGclkUkQnIiEQltaX3Lzb6yiGTpl2y/avqSAxGgelCOKI+Kc2isL0TUSsZ4EREREREREREREREREREREfnIQzXrNWSRTeNxnlOwIgueIr6AAyE+CpiqMEUK71IDO4E+LluEKYKnKcMUifEsTZgiJZ5lDVNkwJPcqzBFoPF/HplfxL/w6b4EPGv1h18Weya1TL8iIiIeiIiIiIiIiEjkPefxV+5YA9PPHylB+u5aqgZ39H+jKOxrqtu+pkzvr9YbzoZ6w2OFkzcrA3yE4WZlSSyFk54VoA/wR43+FaD+r9w32QdWvgvjp2ty2xq8qHPHmtyPFxfrK3hw1ejERlAlfR/Ame2OTow05d4rOLLSlHtDVhI0uRO01JeZ405op6zgNNXT+bIRfpIgn+AkU4pOxBscohojdCHu4RRzjC5EYwVHqRONDkSnEvK/CB3QSU32IRW3ZPnj9iEVoGCNTLVrh8ia1x+6wq8xvB5mz8pxu7oPwIn9lcR0AiuX1+1KX+BXqdvXzWsAC0NsGjzZsS/2Bd6yRA5RgIHkXNhSD3whASZ8rrB9mItuEAizac0fDlHxDMEwpQfD1tW4y3Hjfy5s9nOHH3uwWA+EqEJBWCjoTL/S5toBB/7hu6zer74NgqSP39zJU+qQX3ix763mHTqvIVRUVprCljlElRkEjBqNYevH8veBJ2xhiyhE8YctmhDFH7ZoQhR/2KIJUfxhiyRE8YctmhDFH7ZoQhR/2OIJUfxhC9Ppf/t1jgJACERRsHGyYRZB0Ujvf0xD8w6kP7y6RZmgf/oTFTtbbzJVxZWo2Nlqw6TVy5GowNl6ssm7v50obamfSxQAAAAAAAsKLM15fb3vpQAAAABJRU5ErkJggg==";const zr='\n.flip {\n  backface-visibility:             hidden;\n      -moz-backface-visibility:    hidden;\n      -ms-backface-visibility:     hidden;\n      -o-backface-visibility:      hidden;\n      -webkit-backface-visibility: hidden;\n  border-radius: 7px;\n  height: auto;\n  font: normal 14px helvetica, arial, san serif;\n  position: absolute;\n  opacity:.9;\n  transform-origin:             50% 50% 0px;\n      -moz-transform-origin:    50% 50% 0px;\n      -ms-transform-origin:     50% 50% 0px;\n      -o-transform-origin:      50% 50% 0px;\n      -webkit-transform-origin: 50% 50% 0px;\n  transition: all 2s;\n      -moz-transition:    all 2s;\n      -ms-transition:     all 2s;\n      -o-transition:      all 2s;\n      -webkit-transition: all 2s;\n  min-width: 100px;min-height:50px;\n  background-color:#3e424e;\n  box-shadow: 2px 3px 2px 0px rgba(0,0,0,0.15);\n}\n\n#side-1 {\n  transform:             rotateY( 0deg );\n      -moz-transform:    rotateY( 0deg );\n      -ms-transform:     rotateY( 0deg );\n      -o-transform:      rotateY( 0deg );\n      -webkit-transform: rotateY( 0deg );\n}\n.flip:after{\n   content:"";\n   display:block;\n   position: absolute;\n   opacity:.9;\n   width: 0;\n   height: 0;\n}\n.flip.arrow-top:after{\n   left:45%;\n   top:-17px;\n   border-left:10px solid transparent;\n   border-bottom:18px solid #323b44;\n   border-right:10px solid transparent;\n}\n.flip.arrow-right:after{\n   left:100%;\n   top:48%;\n   border-top:10px solid transparent;\n   border-left:18px solid #323b44;\n   border-bottom:10px solid transparent;\n}\n.flip.arrow-bottom:after{\n   left:45%;\n   top:100%;\n   border-left:10px solid transparent;\n   border-top:18px solid #323b44;\n   border-right:10px solid transparent;\n}\n.flip.arrow-left:after{\n   right:100%;\n   top:48%;\n   border-top:10px solid transparent;\n   border-right:18px solid #323b44;\n   border-bottom:10px solid transparent;\n}\n\n#side-2 {\n  transform:             rotateY( 180deg );\n      -moz-transform:    rotateY( 180deg );\n      -ms-transform:     rotateY( 180deg );\n      -o-transform:      rotateY( 180deg );\n      -webkit-transform: rotateY( 180deg );\n}\n\n.flip-side-1 {\n  transform:             rotateY( 0deg ) !important;\n      -moz-transform:    rotateY( 0deg ) !important;\n      -ms-transform:     rotateY( 0deg ) !important;\n      -o-transform:      rotateY( 0deg ) !important;\n      -webkit-transform: rotateY( 0deg ) !important;\n}\n\n.flip-side-2 {\n  transform:             rotateY( 180deg ) !important;\n      -moz-transform:    rotateY( 180deg ) !important;\n      -ms-transform:     rotateY( 180deg ) !important;\n      -o-transform:      rotateY( 180deg ) !important;\n      -webkit-transform: rotateY( 180deg ) !important;\n}\n\n.info-window-btns{\n  position:absolute;\n  top:-7px;\n  right:5px;\n  overflow:hidden;\n}\n.info-window-content{\n  padding:10px;\n  color:#efefef;\n  font-size:13px;\n  line-height:1.4;\n}\n.info-window-btns button{\n  width:20px;height:20px;\n  float:right;\n  border:0;\n  border-radius:12px;\n  background-color:#2a7da1;\n  margin-right:3px;padding:2px 4px;\n  text-align:center;\n  cursor:pointer;\n  font-size:12px;\n  color:#fff\n}\n.info-window-btns button:hover{\n  background-color:#60bb23;\n}\n',Wr=20;function Gr(t,e){var r=t.split(/\s+/),n=r.indexOf(e);return-1!=n?r.splice(n,1):r.splice(-1,0,e),r.join(" ")}class Ur extends(ae(or)){static get image(){return Ur._image||(Ur._image=new Image,Ur._image.src=jr),Ur._image}static hide(t,e){if(e){var r=t.root.findById(e);r?r._removeInfoWindow(t):console.warn("InfoWindow Not Found.",e)}}static show(t,e,r){if(e){var n=t.root.findById(e);if(n){if(!n._findInfoWindowByComponent(t)){var{frontSideTemplate:i="",backSideTemplate:s=""}=n.model,a=[i,s].filter(t=>String(t).trim());if(0!=(a=a.map(t=>zt.template(function(t,e,r){return(e||r?['<div class="info-window-btns">',e?'<button class="closable">&#88</button>':"",r?'<button class="flipable">&#8652</button>':"","</div>"]:[]).concat(['<div class="info-window-content">',t,"</div>"]).join("")}(t,!r,2==a.length)))).length){var o=zr+n.get("style"),{left:l,top:h,width:c,height:d}=t.bounds,{x:u,y:p}=t.transcoordS2T(l,h);l=u,h=p;var f=document.createElement("span");f.style.position="absolute";var g=document.createElement("style");if(g.type="text/css",g.styleSheet?g.styleSheet.cssText=o:g.appendChild(document.createTextNode(o)),f.appendChild(g),a[0]){var m=document.createElement("div");m.id="side-1",m.className="flip",m.style.display="inline-block",m.innerHTML=a[0](t)}if(a[1]){var y=document.createElement("div");y.id="side-2",y.className="flip",y.style.display="inline-block",y.innerHTML=a[1](t)}lt.forEach(function(t){f.addEventListener(t,function(t){t.stopPropagation()})}),ht.forEach(function(t){f.addEventListener(t,function(t){t.stopPropagation()})});var v=t.root.model_layer.overlay;if(m&&f.appendChild(m),y&&f.appendChild(y),v.appendChild(f),n._addInfoWindow(t,f,g),m){let r=m.querySelector(".info-window-btns > .flipable");r&&r.addEventListener("click",function(t){t.preventDefault(),y.className=Gr(y.className,"flip-side-1"),m.className=Gr(m.className,"flip-side-2")},!1);let n=m.querySelector(".info-window-btns > .closable");n&&n.addEventListener("click",function(r){r.preventDefault(),Ur.hide(t,e)},!1)}if(y){let r=y.querySelector(".info-window-btns > .flipable");r&&r.addEventListener("click",function(t){t.preventDefault(),y.className=Gr(y.className,"flip-side-1"),m.className=Gr(m.className,"flip-side-2")},!1);let n=y.querySelector(".info-window-btns > .closable");n&&n.addEventListener("click",function(r){r.preventDefault(),Ur.hide(t,e)},!1)}var x=m.offsetWidth,_=m.offsetHeight,b=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t.rootModel.target.getBoundingClientRect()),w=[];m&&w.push(m),y&&w.push(y);var A={x:l+c/2,y:h},E=t.transcoordS2C(A.x+x/2,A.y);if(E.x+b.left<b.right){if(_+Wr<E.y)return f.style.marginLeft=A.x-x/2+"px",f.style.marginTop=A.y-_-Wr+"px",void w.forEach(t=>t.className+=" arrow-bottom");if(A={x:l+c/2,y:h+d},E=t.transcoordS2C(A.x+x/2,A.y+_+Wr),b.bottom>E.y+b.top)return f.style.marginLeft=A.x-x/2+"px",f.style.marginTop=A.y+Wr+"px",void w.forEach(t=>t.className+=" arrow-top")}if(A={x:l,y:h+d/2},(E=t.transcoordS2C(A.x-x-Wr,A.y+_)).x>b.left)return f.style.marginLeft=A.x-x-Wr+"px",f.style.marginTop=A.y-_/2+"px",void w.forEach(t=>t.className+=" arrow-right");A={x:l+c,y:h+d/2},f.style.marginLeft=A.x+Wr+"px",f.style.marginTop=A.y-_/2+"px",w.forEach(t=>t.className+=" arrow-left")}}}else console.warn("InfoWindow Not Found.",e)}else console.warn("InfoWindow not defined.")}dispose(){this.infoWindows.map(t=>t.component).forEach(t=>this._removeInfoWindow(t)),super.dispose()}get infoWindows(){return this._windows||(this._windows=[]),this._windows}_findInfoWindowByComponent(t){return this.infoWindows.find(e=>e.component===t)}_addInfoWindow(t,e,r){this._findInfoWindowByComponent(t)||this._windows.push({component:t,window:e,styleElement:r})}_removeInfoWindow(t){var e=this._findInfoWindowByComponent(t);if(!e)return;let r=e.window;r&&r.parentNode.removeChild(r);var n=this.infoWindows.lastIndexOf(e);this.infoWindows.splice(n,1)}render(t){var{left:e,top:r,width:n,height:i}=this.bounds;t.beginPath(),t.drawImage(Ur.image,e,r,n,i)}get hasTextProperty(){return!1}get nature(){return Yr}}zt.register("info-window",Ur);class Xr extends(de(ae(zt))){}class qr extends(de(ce)){render(t){}get layout(){return Gt.get(this.get("layout"))||se}}class Qr extends zt{render(t){var{path:e=[]}=this.model;if(!(e.length<=1)){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let r=1;r<e.length;r++)t.lineTo(e[r].x,e[r].y);t.closePath(),this.drawStroke(t)}}get path(){return this.model.path}set path(t){this.set("path",t)}contains(t,e){var r=this.model.path,n=!1;return r.forEach((i,s)=>{let a=(s+r.length+1)%r.length,o=i.x,l=i.y,h=r[a].x,c=r[a].y;l>e!=c>e&&t<(h-o)*(e-l)/(c-l)+o&&(n=!n)}),n}}zt.register("path",Qr);class Vr extends or{render(t){var{x1:e,y1:r,x2:n,y2:i,x3:s,y3:a}=this.model;t.beginPath(),t.moveTo(e,r),t.lineTo(n,i),t.lineTo(s,a),t.closePath()}contains(t,e){var{x1:r,y1:n,x2:i,y2:s,x3:a,y3:o}=this.model,l=[r,n,i,s,a,o],h=!1;for(let r=0;r<l.length;r+=2){let n=(r+2)%l.length,i=l[r],s=l[r+1],a=l[n],o=l[n+1];s>e!=o>e&&t<(a-i)*(e-s)/(o-s)+i&&(h=!h)}return h}get mutable(){return!0}get path(){var{x1:t,y1:e,x2:r,y2:n,x3:i,y3:s}=this.model;return[{x:t,y:e},{x:r,y:n},{x:i,y:s}]}set path(t){this.set({x1:t[0].x,y1:t[0].y,x2:t[1].x,y2:t[1].y,x3:t[2].x,y3:t[2].y})}}zt.memoize(Vr.prototype,"path",!1),zt.register("triangle",Vr);const Kr={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"ratio",name:"ratio",property:"ratio"}]};var Jr={ondragmove:function(t,e,r){r.controls;var{cx:n,rx:i}=r.model,s=(r.transcoordP2S(t.x,t.y).x-n)/i*100;s=s>=100||s<=-100?100:Math.abs(s),r.set({ratio:s})}};class Zr extends vr{render(t){var{ratio:e=50,cx:r,cy:n,rx:i,ry:s,startAngle:a,endAngle:o,anticlockwise:l}=this.model;t.beginPath(),t.ellipse(r,n,Math.abs(i),Math.abs(s),0,a||0,o||2*Math.PI,l),t.moveTo(r+i/100*e,n),t.ellipse(r,n,Math.abs(i/100*e),Math.abs(s/100*e),0,a||0,o||2*Math.PI,!0)}contains(t,e){var{cx:r,cy:n,rx:i,ry:s,ratio:a}=this.model,o=(t-r)/(2*i-.5),l=(e-n)/(2*s-.5),h=(t-r)/(i/100*a*2-.5),c=(e-n)/(s/100*a*2-.5),d=!1;return o*o+l*l<.25&&h*h+c*c>.25&&(d=!d),d}get controls(){var{cx:t,cy:e,rx:r,ratio:n}=this.model;return[{x:t+r/100*n,y:e,handler:Jr}]}get nature(){return Kr}}zt.memoize(Zr.prototype,"controls",!1),zt.register("donut",Zr);const $r={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"ratio",name:"ratio",property:"ratio"},{type:"number",label:"wing",name:"wing",property:"wing"}]};var tn={ondragmove:function(t,e,r){r.controls;var{cy:n,ry:i}=r.model,s=(r.transcoordP2S(t.x,t.y).y-n)/i*100+100;s>=100?s=100:s<=0&&(s=0),r.set({ratio:s})}};class en extends vr{render(t){var{ratio:e=30,wing:r=5,cx:n,cy:i,rx:s,ry:a,startAngle:o,endAngle:l,anticlockwise:h}=this.model;if(r<3)return;const c=1.5707963267948966;var d=2*Math.PI/r,u=s-e/100*s,p=a-e/100*a;t.save(),t.beginPath(),t.translate(n,i),t.moveTo(s*Math.cos(-c),a*Math.sin(-c)),t.lineTo((s-u)*(Math.cos(d-c)+Math.cos(0-c))/2,(a-p)*(Math.sin(d-c)+Math.sin(0-c))/2);for(var f=1;f<r;f++)t.lineTo(s*Math.cos(d*f-c),a*Math.sin(d*f-c)),t.lineTo((s-u)*(Math.cos(d*(f+1)-c)+Math.cos(d*f-c))/2,(a-p)*(Math.sin(d*(f+1)-c)+Math.sin(d*f-c))/2);t.closePath(),t.restore()}get controls(){var{cx:t,cy:e,ry:r,ratio:n}=this.model;return[{x:t,y:e-r+r*(n/100),handler:tn}]}get nature(){return $r}}zt.memoize(en.prototype,"controls",!1),zt.register("star",en);const rn={mutable:!1,resizable:!0,rotatable:!1,properties:[]};class nn extends(ae(or)){render(t){var{left:e,top:r,width:n,height:i}=this.bounds;t.beginPath(),t.rect(e,r,n,i)}get text(){return this.get("id")}set text(t){}get rotatable(){return!1}get nature(){return rn}}zt.register("variable",nn);var sn=t=>{return class extends t{animOnValueChange(t){if(t!=this._lastValue){var e=t-(this._lastValue||0);this._lastValue=t,this._anim_alpha=-e,this.animate({step:t=>{this._anim_alpha=e*(t-1),this.invalidate()},duration:1e3,delta:"circ",options:{x:1},ease:"out"}).start()}}dispose(){super.dispose(),delete this._value_substitutor}onchange(t,e){t.hasOwnProperty("value")&&delete this._value_substitutor}get animAlpha(){return this._anim_alpha||0}get animValue(){return(this._lastValue||0)+(this._anim_alpha||0)}defaultValueSubstitutor(){return this.getState("value")}get valueSubstitutor(){return this._value_substitutor||(this._value_substitutor=vt(this.getState("value"),this)||this.defaultValueSubstitutor),this._value_substitutor}get value(){return Number(this.valueSubstitutor())||0}set value(t){delete this._value_substitutor,this.setState("value",Number(Object(v.e)(t)))}}},an=t=>{return class extends t{_convertDataFormat(t,e){var r;switch(e){case"json":r=JSON.parse(t);break;default:r=t}return r}isDataSource(){return!0}}};class on extends ce{constructor(t,e){super(t,e),t.translate=t.translate||{x:0,y:0},this._draw_reserved=!1,this.__draw__=(()=>{this._draw_reserved=!1,this.trigger("redraw"),this.reflow(),this.draw()}),this.throttle_render=(()=>{this._draw_reserved||requestAnimationFrame(this.__draw__),this._draw_reserved=!0})}fitSize(t){if(!this.target)return;let e=getComputedStyle(this.target),r=e?parseFloat(e.getPropertyValue("width")):this.target.offsetWidth,n=e?parseFloat(e.getPropertyValue("height")):this.target.offsetHeight;t.setAttribute("width",r*ot),t.setAttribute("height",n*ot),t.style.width=r+"px",t.style.height=n+"px"}resize(){this.fitSize(this.element)}isLayer(){return!0}createElement(){var t=zt.createCanvas(1,1);return t.style.position="absolute",t}get target(){return this._target}set target(t){this._target&&this.element&&this._target.removeChild(this.element),this._target=t,t&&(this.element||(this.element=this.createElement()),this.resize(),t.appendChild(this.element))}get canvas(){return this.element}dispose(){super.dispose(),this.target=null,this.element=null}get selected(){return this.root.selected}set selected(t){this.root.selected=t}get focused(){return this.root.focused}set focused(t){this.root.focused=t}getContext(){return this._context2D||(this._context2D=this.canvas&&this.canvas.getContext("2d")),this._context2D}draw(t){this.canvas&&(t=t||this.getContext())&&super.draw(t)}prerender(t){var{translate:e,scale:r={x:1,y:1},rotation:n}=this.model;t.clearRect(0,0,t.canvas.width,t.canvas.height),e&&t.translate(e.x*ot,e.y*ot),t.scale(r.x*ot,r.y*ot),n&&t.rotate(n)}get rotatePoint(){return{x:0,y:0}}contains(t,e){return!1}invalidate(){this.throttle_render()}move(t){var e=this.get("translate")||{x:0,y:0};this.set({translate:{x:e.x+t.x,y:e.y+t.y}})}}function ln(t){t.hasOwnProperty("_backupStrokeStyle")||(t._backupStrokeStyle=t.model.strokeStyle,t.set("strokeStyle","#f26522"),t.hasOwnProperty("_backupLineWidth")||(t._backupLineWidth=t.model.lineWidth,t.set("lineWidth",t.model.lineWidth+5)))}function hn(t){t.hasOwnProperty("_backupStrokeStyle")&&(t.set("strokeStyle",t._backupStrokeStyle),delete t._backupStrokeStyle,t.hasOwnProperty("_backupLineWidth")&&(t.set("lineWidth",t._backupLineWidth),delete t._backupLineWidth))}var cn=r(12);const dn="data:image/png;base64,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",un={x:1,y:1},pn={x:0,y:0};class fn extends on{constructor(t,e){super(t,e)}dispose(){super.dispose(),delete this._canvas,delete this._overlay}contains(t,e){return!0}isRootModel(){return!0}get stuck(){return!0}get overlay(){if(!this._overlay){var t=document.createElement("div");t.style.position="absolute",t.style["user-select"]="none",t.style["transform-origin"]="top left",this.element&&this.element.appendChild(t),this._overlay=t,this._repositionOverlay()}return this._overlay}createElement(){var t=document.createElement("div");return t.style.position="absolute",t.style["user-select"]="none",t.style.overflow="hidden",this._canvas=zt.createCanvas(1,1),this._canvas.style.position="absolute",t.appendChild(this._canvas),this._overlay&&t.appendChild(this._overlay),t}resize(){this.fitSize(this.element),this.fitSize(this.canvas)}get canvas(){return this._canvas}get MPP(){var{scale:t={x:1,y:1},unit:e}=this.model;switch(e){case"mm":case"cm":return 1/this.app.PPM/t.x;case"in":return 1/this.app.PPI/t.x;case"px":default:return 1/t.x}}capturePath(t,e){var r=this.layout.capturables(this);for(let n=r.length-1;n>=0;n--){let i=r[n];if(!i.isContainer())continue;let s=i.capturePath(t,e);if(s)return s}return!1}get eventMap(){return{"(self)":{"(all)":{change:this._onchanged_all,mouseenter:this._onmouseenter_all,mouseleave:this._onmouseleave_all,click:this._onclick}}}}postrender(t){if(super.postrender(t),!cn.a.valid){this._watermark||(this._watermark=new Image,this._watermark.src=dn);let e=this._watermark;t.globalAlpha=.5,t.drawImage(e,this.model.width-e.width-30,this.model.height-e.height-30)}}_repositionOverlay(){var t=this._overlay;if(t){var{translate:e=pn,scale:r=un,rotation:n=0}=this.model,{left:i,top:s,width:a,height:o}=this.bounds;t.style.left=i+"px",t.style.top=s+"px";var l=`rotate(${n}rad) scale(${r.x}, ${r.y}) perspective(1px)`;t.style["margin-left"]=e.x+"px",t.style["margin-top"]=e.y+"px",["-webkit-","-moz-","-ms-","-o-",""].forEach(e=>{t.style[e+"transform"]=l})}}onchange(t){var e=this._model;delete e.id,delete e.text,delete e.class,this._repositionOverlay()}_onchanged_all(t,e,r){this.invalidate()}_onmouseenter_all(t,e){if(t.stopPropagation(),this.app&&!this.app.isEditMode&&e){var r=e.origin;if(!(r instanceof fn)&&r.model.event&&r.model.event.hover&&!r.hidden){var n=r.model.event.hover;n&&this._doEventAction(n,r,!0,!0)}}}_onmouseleave_all(t,e){if(t.stopPropagation(),this.app&&!this.app.isEditMode&&e){var r=e.origin,n=r.model.event&&r.model.event.hover;n&&this._doEventAction(n,r,!1,!0)}}_onclick(t,e){if(t.stopPropagation(),!this.app.isEditMode&&e){var r=e.origin,n=r.model.event&&r.model.event.tap;n&&this._doEventAction(n,r,!0,!1)}}_doEventAction(t,e,r,n){t.action?this._doEventAction_1_1(t,e,r):this._doEventAction_1_0(t,e,r,n)}_doEventAction_1_0(t,e,r,n){var{infoWindow:i,emphasize:s,target:a,action:o,value:l}=t;if(s&&(r?ln(e):n&&hn(e)),i&&!e.hidden&&(r?Ur.show(e,i):n&&Ur.hide(e,i)),a)if(/^\$/.test(a)){if(!("value"in t))return;r?(n&&(e._lastValue=this.root.variable(a.substring(1))),this.root.variable(a.substring(1),e.substitute(l))):(this.root.variable(a,e._lastValue),delete e._lastValue)}else"popup"==a?ir(e,l):this.trigger(a,e.substitute(l))}_doEventAction_1_1(t,e,r){var{action:n,target:i,value:s,emphasize:a=!1,restore:o=!1}=t;if(a&&(r?ln(e):o&&hn(e)),n&&i)switch(n){case"data-toggle":(r||o)&&this.root.findAll(i).forEach(t=>{t.data=!t.data});break;case"data-tristate":(r||o)&&this.root.findAll(i).forEach(t=>{let e=Math.round(Math.max(Number(t.data)||0,0));t.data=(e+(r?1:2))%3});break;case"data-set":r&&this.root.findAll(i).forEach(t=>{t.data=s});break;case"infoWindow":r?Ur.show(e,i,!0):o&&Ur.hide(e,i);break;case"popup":ir(e,i);break;default:this.trigger(n,i,e.substitute(s))}}}fn.Popup=s,zt.register("model-layer",fn);const gn=20,mn=0,yn=20,vn=0,xn=20,_n=20,bn=90*Math.PI/180,wn="m",An=0,En="9px Verdana",kn=20,Sn="#f4f4f4",Mn="#999";function Pn(t,e,r){return{left:-t.x,top:-t.y,width:gn,height:kn}}function Tn(t,e,r,n){return{left:gn-t.x,top:mn-t.y,origin:yn-t.x,width:e-gn,height:kn}}function Cn(t,e,r,n){var i={x:-t.x+vn+kn/2,y:-t.y+xn+(r-xn)/2},s=zt.transcoordRR(-t.x+vn,-t.y+xn,i,bn);return{left:s.x-(r-xn),top:s.y,origin:_n-t.y,width:r-xn,height:kn}}function In(t){var e=t.get("translate");return{left:-e.x,top:-e.y,width:t.canvas.width/ot,height:t.canvas.height/ot}}zt.register("guide-layer",class extends on{constructor(t,e){super(t,e),this.appScale={x:1,y:1},"disabled"!==t.ruler&&(this.hruler=new Pr({left:gn,top:mn,origin:yn,margin:An,height:kn,unit:wn,rotation:0,font:En,fillStyle:Sn,strokeStyle:Mn,capturable:!1}),this.vruler=new Pr({left:0,top:0,origin:_n,margin:An,height:kn,unit:wn,rotation:bn,font:En,side:"top",fillStyle:Sn,strokeStyle:Mn,capturable:!1}),this.origin_rect=new wr({left:-yn,top:-_n,width:yn,height:_n,fillStyle:Sn,strokeStyle:Mn,lineWidth:1}),this.addComponent(this.hruler),this.addComponent(this.vruler),this.addComponent(this.origin_rect)),this.invalidate()}get capturable(){return!1}added(t){if(this.hruler){var e=this.rootModel,r=Object.assign({},e.get("translate"));r.x<gn&&(r.x+=gn),r.y<xn&&(r.y+=xn);var n=e.get("scale")||{x:1,y:1};this.appScale=n,this.hruler.set("scale",n.x),this.vruler.set("scale",n.y),e.set("translate",r),this.set("translate",r),this.screen_coord=In(this);var{width:i,height:s}=this.screen_coord;this.hruler.set(Tn(r,i,0,this.hruler)),this.vruler.set(Cn(r,0,s,this.vruler)),this.origin_rect.set(Pn(r))}else this.screen_coord=In(this)}resize(){super.resize(),this.screen_coord=In(this);var{width:t,height:e}=this.screen_coord;this.hruler&&(this.hruler.set(Tn(this.model.translate,t,0,this.hruler)),this.vruler.set(Cn(this.model.translate,0,e,this.vruler)),this.origin_rect.set(Pn(this.model.translate)))}render(t){if(this.guide){t.save();var{x:e,y:r}=this.guide,{top:n,left:i,width:s,height:a}=this.screen_coord;t.beginPath(),t.moveTo(e,n),t.lineTo(e,n+a),t.moveTo(i,r),t.lineTo(i+s,r),t.lineWidth=1,t.strokeStyle="tomato",t.setLineDash([2,3]),t.font="10px tahoma",t.fillStyle="#333";var o=this.transcoordS2C(e,r,this.rootModel);t.textBaseline=o.y>200?"bottom":"top",t.textAlign=o.x>200?"right":"left";var l=o.y>200?-5:5,h=o.x>200?-5:5,c=Math.round(e/this.appScale.x),d=Math.round(r/this.appScale.y);t.fillText(` ${c}, ${d} `,e+h,r+l),t.stroke(),t.restore()}}get guide(){return this._guide}set guide(t){this._guide=t,this.invalidate()}contains(t,e){return!0}get eventMap(){return{"(root)":{"(descendant)":{mousemove:this.onmousemove_child,mouseout:this.onmouseout_child,dragmove:this.onmousemove_child},"model-layer":{change:this.onchange_root_model}},"(self)":{"(descendant)":{mousedown:this.onmousedown_origin}}}}onmousedown_origin(t,e){this.rootModel.set("translate",{x:yn,y:_n})}onchange_root_model(t,e,r){if(t.scale&&(this.appScale=t.scale,this.hruler&&(this.hruler.set("scale",t.scale.x),this.vruler.set("scale",t.scale.y))),t.translate&&this.set({translate:{x:t.translate.x,y:t.translate.y}}),t.scale||t.translate){if(this.screen_coord=In(this),this.hruler){var{translate:n}=this.model,{width:i,height:s}=this.screen_coord;this.hruler.set(Tn(n,i,0,this.hruler)),this.vruler.set(Cn(n,0,s,this.vruler)),this.origin_rect.set(Pn(n))}this._guide=null}this.invalidate()}onmouseout_child(t){this._guide=null,this.invalidate()}onmousemove_child(t,e){t.target&&"CANVAS"!==t.target.tagName?this.guide=null:this.guide=this.transcoordC2S(t.offsetX,t.offsetY)}});function On(t,e,r,n){var i=t.selected,s=n?i.slice(0):[];n&&s.length>0?e=s[0].parent:e.isContainer()||(e=e.parent);var a=e.layout.capturables(e),o=!!e.layout.joinType;if(n&&r.selected.forEach(t=>{s.splice(s.indexOf(t),1)}),r.selected=[],a.forEach(t=>{t.capturable&&function(t,e,r){var n,i,s,a,{sx:o,sy:l,ex:h,ey:c}=e;if(o>h?(n=h,i=o):(n=o,i=h),l>c?(s=c,a=l):(s=l,a=c),r){var d=t.bounds,u=t.transcoordS2TR(d.left,d.top),p=t.transcoordS2TR(d.left+d.width,d.top+d.height),f=u.x,g=p.x,m=u.y,y=p.y,v=Math.min(n,f,i,g),x=Math.max(n,f,i,g),_=Math.min(s,m,a,y),b=Math.max(s,m,a,y);return!(x-v>Math.abs(i-n)+Math.abs(g-f)||b-_>Math.abs(a-s)+Math.abs(y-m))}var w=t.path;if(!w)return Object(Z.b)("컴포넌트에 get path가 잘못 구현되어있음.",t),!1;for(let e=0;e<w.length;e++){let r=t.transcoordS2TR(w[e].x,w[e].y);if(n>r.x||i<r.x||s>r.y||a<r.y)return!1}return!0}(t,r,o)&&-1==s.indexOf(t)&&r.selected.push(t)}),s=s.concat(r.selected),i.length!==s.length)t.selected=s;else for(let e=0;e<s.length;e++)if(i[e]!=s[e]){t.selected=s;break}}function Rn(t,e,r,n,i){i||On(t,e,r,n)}zt.register("shift-layer",class extends on{added(t){var e=this.rootModel.get("translate");this.set("translate",e)}render(t){}contains(t,e){return!(this.app.mode!=at)}get eventMap(){return{"(root)":{"(self)":{keydown:this.onkeydown,keyup:this.onkeyup}}}}onkeydown(t){32==t.keyCode&&void 0===this.before_mode&&(this.before_mode=this.app.mode,this.app.mode=at)}onkeyup(t){32==t.keyCode&&(null!=this.before_mode&&(this.app.mode=this.before_mode),delete this.before_mode)}ondragstart(t){this.last_position=this.transcoordC2S(t.offsetX,t.offsetY)}ondragmove(t){var{x:e,y:r}=this.transcoordC2S(t.offsetX,t.offsetY);this.rootModel.move({x:e-this.last_position.x,y:r-this.last_position.y}),this.last_position=this.transcoordC2S(t.offsetX,t.offsetY)}});zt.register("selection-layer",class extends on{added(t){var e=this.rootModel,r=e.get("translate"),n=e.get("scale");this.set("translate",r),this.set("scale",n)}contains(t,e){return!1}render(t){var e=this.selbox;if(e){let{sx:r,sy:n,ex:i,ey:s}=e,a=this.get("scale")||{x:1,y:1};t.beginPath(),t.rect(r,n,i-r,s-n),t.setLineDash([2/a.x,4/a.y]),t.lineWidth=1/a.x,t.strokeStyle="black",t.stroke()}}get eventMap(){return{"(root)":{"(self)":{keydown:this.onkeydown}},"model-layer":{"(self)":{change:this.onchange_root_model},"(all)":{dragstart:this.ondragstart_selbox,dragmove:this.ondragmove_selbox,dragend:this.ondragend_selbox,mousedown:this.onmousedown_comp,mouseup:this.onmouseup_comp}}}}onkeydown(t,e){var{origin:r,deliverer:n}=e,i=n.selected;if(1!=i.length)return!1;var s=i[0],a=s.parent;if(!a||a===n)return!1;if("Tab"==t.code){if("Tab"!=t.code)return!1;var o=a.layout.capturables(a),l=o.indexOf(s);if(-1==l){if(!a.indexOf(s))return Object(Z.c)("Container not contains [",s,"] as a component"),!1;l=0}var h=o.length;t.shiftKey?l--:l++,s=o[(l+h)%h]}else{if(!a.layout.keyNavigate)return!1;s=a.layout.keyNavigate(a,s,t)||s}n.selected=[s],t.preventDefault()}onchange_root_model(t,e,r){t.translate&&this.set("translate",t.translate),t.scale&&this.set("scale",t.scale)}_pendingDecision(t){this.downpoint={x:t.offsetX,y:t.offsetY}}_selectGroupItem(t,e){var r=this.selected.indexOf(t);let n=t.parent;for(;n.parent.isGroup();)n=n.parent;let i=[],s=!1,a=!1;if(this.selected.forEach(t=>{let e=t.parent;if(t!==n){for(;e.parent&&e.parent.isGroup();)e=e.parent;e===n&&(i.push(t),s=!0)}else a=!0}),s)if(e.shiftKey){if(-1!=r)return void this._pendingDecision(e);i.push(t)}else{if(-1!=r)return void this._pendingDecision(e);i=[t]}else{if(a)return void this._pendingDecision(e);if(e.shiftKey)if(this.selected.length>0){if(-1!=this.selected.indexOf(n)||this.selected[0].parent!==n.parent)return;i=[...this.selected,n]}else i=[n];else i=[n]}this.selected=i}onmousedown_comp(t,e){var{origin:r}=e;if(this.downpoint=null,t.shiftKey){if(r.parent.isGroup())return void this._selectGroupItem(r,t);if(-1!=this.selected.indexOf(r))return void this._pendingDecision(t);{let e=this.selected.filter(t=>!t.isRootModel()&&!!t.parent),n=e.length>0&&e[0].parent;if(n&&n!==r.parent)return void(r.parent.isGroup()&&this._pendingDecision(t));e.push(r),this.selected=e}}else{if(r.parent.isGroup())return void this._selectGroupItem(r,t);if(-1!=this.selected.indexOf(r))return;this.selected=[r]}}onmouseup_comp(t,e){if(!this.downpoint)return;if(this.downpoint.x!==t.offsetX||this.downpoint.y!==t.offsetY)return;var{origin:r}=e;let n=this.selected.indexOf(r);if(-1==n&&r.parent.isGroup()&&(n=this.selected.indexOf(r.parent)),-1!==n&&t.shiftKey){let t=this.selected.slice();return n>-1&&t.splice(n,1),void(this.selected=t)}r.parent.isGroup()&&(this.selected=[r])}ondragstart_selbox(t,e){var{origin:r}=e;if(r.stuck){var{x:n,y:i}=this.transcoordC2S(t.offsetX,t.offsetY);this.selbox={sx:n,sy:i,selected:[]}}}ondragmove_selbox(t,e){var{origin:r}=e;if(r.stuck){var{x:n,y:i}=this.transcoordC2S(t.offsetX,t.offsetY),{deliverer:s}=e;this.selbox&&(this.selbox.ex=n,this.selbox.ey=i,Rn(this,r,this.selbox,t.shiftKey),this.invalidate())}}ondragend_selbox(t,e){var{origin:r}=e;r.stuck&&(this.last_pos=null,this.selbox=null,Rn(this,null,null,!1,!0),this.invalidate())}});class Bn{constructor(t){this.layer=t}draw(t,e,r){var n=e.bounds;0!=n.width&&0!=n.height&&(t.beginPath(),t.rect(n.left,n.top,n.width,n.height),t.clip(),t.beginPath(),t.strokeStyle="#f26522",t.lineWidth=4,t.shadowBlur=10,t.shadowColor="black",t.shadowOffsetX=0,t.shadowOffsetY=0,t.rect(n.left,n.top,n.width,n.height),t.stroke(),t.closePath())}}class Ln{constructor(t){this.layer=t}draw(t,e,r){var n=e.bounds;t.beginPath(),t.rect(n.left,n.top,n.width,n.height),t.setLineDash([3/r.x,4/r.y]),t.lineWidth=1/r.x,t.strokeStyle="black",t.stroke(),t.setLineDash([]),t.closePath()}}const Dn=4;class Hn{constructor(t){this.layer=t}reset(){this.active=null}get selected(){return this.layer.selected}contains(t,e,r,n){let i=r.controls;return!!i&&(i.every((i,s)=>(Math.abs(t-i.x)<=Dn/n.x&&Math.abs(e-i.y)<=Dn/n.y&&(this.active={component:r,index:s,handler:i.handler}),!this.active)),!!this.active)}draw(t,e,r){var n=e.controls;n&&n.forEach((e,n)=>{t.beginPath(),t.lineWidth=1/r.x,t.ellipse(e.x,e.y,Dn/r.x,Dn/r.y,0,0,2*Math.PI,!0),t.fillStyle="#ff5d72",t.fill(),t.strokeStyle="#fff",t.stroke()})}onevent(t,e){var{handler:r,component:n,index:i}=this.active,s=n.transcoordC2S(e.offsetX,e.offsetY);s=n.transcoordS2P(s.x,s.y),r&&"function"==typeof r[t]&&r[t](s,i,n)}onmousedown(t){this.onevent("onmousedown",t)}ondragstart(t){var e=this.active;e.changes=Be.before([e.component]),this.onevent("ondragstart",t)}ondragmove(t){this.onevent("ondragmove",t)}ondragend(t){this.onevent("ondragend",t);var{component:e,changes:r}=this.active;Be.after(r,e.app.commander),e.parent&&e.parent.calculateBounds&&e.parent.calculateBounds()}}function Fn(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}const Nn=15*Math.PI/180,Yn=4;class jn{constructor(t){this.layer=t}reset(){this.active=null}get selected(){return this.layer.selected}contains(t,e,r,n){return!!r.mutable&&(r.path.every((i,s)=>(Math.abs(t-i.x)<=Yn/n.x&&Math.abs(e-i.y)<=Yn/n.y&&(this.active={component:r,index:s}),!this.active)),!!this.active)}draw(t,e,r){if(e.mutable&&!e.stuck){var n=e.path,i=this.active;n.forEach((n,s)=>{t.beginPath(),t.ellipse(n.x,n.y,Yn/r.x,Yn/r.y,0,0,2*Math.PI,!0),t.lineWidth=1/r.x,t.strokeStyle="#656565",t.fillStyle="#fff",i&&i.component===e&&i.index===s&&(t.strokeStyle="#fa7703",i.toFill&&(t.fillStyle="#ffb80c")),t.fill(),t.stroke()})}}ondblclick(t){var e=this.active.component;if(e.pathExtendable){var r=e.path.slice();r.length<4||(r.splice(this.active.index,1),e.path=r)}}onmousedown(t){this.active.toFill=!0}ondragstart(t){var e=this.active;e.changes=Be.before([e.component])}ondragmove(t){var e,r,{component:n,index:i}=this.active,s=n.transcoordC2S(t.offsetX,t.offsetY);if(s=n.transcoordS2P(s.x,s.y),t.shiftKey){var a=n.path.length,o=n.isLine()&&0==i?n.path[1]:n.path[(i-1+a)%a];o=n.transcoordS2P(o.x,o.y);var l,h=0;if(a>2)n.isLine()?0==i?l=n.path[2]:1!=i&&(l=n.path[i-2]):l=n.path[(i-2+a)%a],l&&(h=Fn(l=n.transcoordS2P(l.x,l.y),o));var c=Math.round((Fn(o,s)-h)/Nn)*Nn+h;s=function(t,e,r){return{x:Math.cos(e)*r+t.x,y:Math.sin(e)*r+t.y}}(o,c,(e=o,r=s,Math.sqrt((r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y))))}n.mutatePath(null,function(t){t[i]=s})}ondragend(t){var{component:e,changes:r}=this.active;Be.after(r,e.app.commander),e.parent&&e.parent.calculateBounds&&e.parent.calculateBounds()}}const zn=4,Wn=8,Gn=0,Un=1,Xn=2,qn=3,Qn=4,Vn=5,Kn=6,Jn=7;function Zn(t,e,r){var n,i,{left:s,top:a,width:o,height:l}=t.bounds;switch(e){case Gn:n=s,i=a;break;case Un:n=s+o/2,i=a;break;case Xn:n=s+o,i=a;break;case qn:n=s+o,i=a+l/2;break;case Qn:n=s+o,i=a+l;break;case Vn:n=s+o/2,i=a+l;break;case Kn:n=s,i=a+l;break;case Jn:n=s,i=a+l/2}var h=n,c=i,d=t.transcoordT2S(r.x,r.y);return{dx:d.x-h,dy:d.y-c}}function $n(t,e,r,n,i,s){var{left:a,top:o,width:l,height:h}=t.bounds,c={left:a,top:o,width:l,height:h};switch(e){case Gn:a+=n,o+=i,l-=n,h-=i;break;case Un:o+=i,h-=i;break;case Xn:o+=i,l+=n,h-=i;break;case qn:l+=n;break;case Qn:l+=n,h+=i;break;case Vn:h+=i;break;case Kn:a+=n,l-=n,h+=i;break;case Jn:a+=n,l-=n}if(t.mutateBounds(function(e){return Math.abs(l)<=.001&&(l=.001),Math.abs(h)<=.001&&(h=.001),t.adjustResize({left:a,top:o,width:l,height:h},c,r)},this),t.isContainer()&&t.layout.ABSOLUTE&&!t.isGroup()){var d=c.left-a,u=c.top-o;s?t.components.forEach(t=>{t.delta("tx",0),t.delta("ty",0),t.move({x:d,y:u})}):t.components.forEach(t=>{t.delta("tx",d),t.delta("ty",u)})}else{var p=s&&t.parent;p&&p.isGroup()&&p.calculateBounds()}}function ti(t){var{left:e,top:r,width:n,height:i}=t,s=e+n/2,a=r+i/2,o=e+n,l=r+i;return[{x:e,y:r},{x:s,y:r},{x:o,y:r},{x:o,y:a},{x:o,y:l},{x:s,y:l},{x:e,y:l},{x:e,y:a}]}class ei{constructor(t){this.layer=t}reset(){this.active=null}get selected(){return this.layer.selected}contains(t,e,r,n){return!!r.resizable&&(ti(r.bounds).every((i,s)=>(Math.abs(t-i.x)<=zn/n.x&&Math.abs(e-i.y)<=zn/n.y&&(this.active={component:r,index:s}),!this.active)),!!this.active)}draw(t,e,r){if(!e.isLine()){var n=e.bounds;if(t.beginPath(),t.rect(n.left,n.top,n.width,n.height),t.setLineDash([3/r.x,4/r.y]),t.lineWidth=1/r.x,t.strokeStyle="black",t.stroke(),t.setLineDash([]),e.resizable){var i=this.active;ti(n).forEach((n,s)=>{t.beginPath(),t.rect(n.x-zn/r.x,n.y-zn/r.y,Wn/r.x,Wn/r.y),t.setLineDash([0,0]),t.strokeStyle="#656565",t.stroke(),t.fillStyle="#fff",i&&i.component===e&&i.index===s&&(t.strokeStyle="#fa7703",i.focus&&(t.fillStyle="#ffb80c")),t.fill(),t.stroke()})}}}onmousedown(t){this.active.focus=!0}ondragstart(t){var{component:e}=this.active;this.active.bounds=e.bounds,this.active.boundsList=this.layer.selected.filter(t=>t.resizable).map(t=>t.bounds)}ondragmove(t){var{component:e,index:r,boundsList:n,bounds:i}=this.active,s=this.layer.transcoordC2S(t.offsetX,t.offsetY);e.bounds=i;var a=Zn(e,r,s);this.layer.selected.filter(t=>t.resizable).forEach((e,i)=>{e.bounds=n[i],$n(e,r,t.shiftKey,a.dx,a.dy,!1)})}ondragend(t){var{component:e,index:r,boundsList:n,bounds:i}=this.active,s=this.layer.transcoordC2S(t.offsetX,t.offsetY);e.bounds=i;var a=Zn(e,r,s);this.layer.selected.filter(t=>t.resizable).forEach((e,i)=>{e.bounds=n[i],$n(e,r,t.shiftKey,a.dx,a.dy,!0)}),this.active.component.app.commander.execute(null,!1)}}const ri=4,ni=20,ii=2*Math.PI,si=Math.PI/2;function ai(t,e){var r=t.bounds;return{x:r.left+r.width/2,y:r.top-ni/e.y}}class oi{constructor(t){this.layer=t}reset(){this.active=null}get selected(){return this.layer.selected}contains(t,e,r,n){if(!r.rotatable)return!1;var i=ai(r,n);return Math.abs(t-i.x)<=ri/n.x&&Math.abs(e-i.y)<=ri/n.y&&(this.active={component:r},!0)}draw(t,e,r){if(e.rotatable){t.beginPath();var n=ai(e,r);t.lineWidth=1.5/r.x,t.moveTo(n.x,n.y+ni/r.y),t.lineTo(n.x,n.y),t.strokeStyle="#656565",t.stroke(),t.beginPath(),t.ellipse(n.x,n.y,ri/r.x,ri/r.y,0,0,ii,!0),t.stroke(),t.fillStyle="#fff",t.fill();var i=this.active;i&&i.component===e&&(t.strokeStyle="#fa7703",t.stroke(),i.toFill&&(t.fillStyle="#ffb80c",t.fill()))}}onmousedown(t){this.active.toFill=!0}ondragstart(t){var e=this.active;e.component;e.start_rotation=e.component.get("rotation"),e.rotations=this.layer.selected.filter(t=>t.rotatable).map(t=>t.get("rotation"))}ondragmove(t){var{component:e}=this.active,r=e.transcoordC2S(t.offsetX,t.offsetY);r=e.transcoordS2P(r.x,r.y);var n=e.rotatePoint,i=e.get("rotation")||0,s=Math.atan((n.y-r.y)/(n.x-r.x)),a=(s=n.x>=r.x?s-si:si+s)-i;this.layer.selected.filter(t=>t.rotatable).forEach((e,r)=>{let n=((e.get("rotation")||0)+a)%ii;e.set("rotation",e.adjustRotation(n,t.shiftKey))})}ondragend(t){var{component:e,rotations:r}=this.active;e.app.commander.execute(null,!1)}}zt.register("modeling-layer",class extends on{constructor(t,e){super(t,e);var r=new jn(this),n=new Hn(this),i=new ei(this),s=new oi(this);this._modelers=[r,n,i,s],this._control_mode_modelers=[n,r,i,s],this.focusOutline=new Bn(this),this.groupOutline=new Ln(this),this._reversed_modelers=this._modelers.slice().reverse(),this._control_mode_reverse_modelers=this._control_mode_modelers.slice().reverse()}get modelers(){return this._control_mode?this._control_mode_modelers:this._modelers}get reversedModelers(){return this._control_mode?this._control_mode_reverse_modelers:this._reversed_modelers}added(t){var e=this.rootModel,r=e.get("translate"),n=e.get("scale");this.set("translate",r),this.set("scale",n)}contains(t,e){if(this._state_dragging)return!0;this.modelers.forEach(t=>t.reset());var r=this.selected.filter(t=>!!t.parent),n=this.get("scale")||{x:1,y:1};for(let i=0;i<r.length;i++){let s=r[i],a=s.transcoordT2S(t,e);for(let t=0;t<this.modelers.length;t++){let e=this.modelers[t];if(e.contains(a.x,a.y,s,n))return this.currentModeler=e,!0}}return!1}_componentDrawer(t,e,r,n){let i=[],s=e.parent;if(e.isRootModel())return t.save(),n(t,e,r),void t.restore();for(;s&&!s.isRootModel();)i.push(s),s=s.parent;t.save(),i.reverse().forEach(function(e){let r=e.rotatePoint;t.translate(r.x,r.y);let n=e.get("scale");n&&t.scale(n.x,n.y),t.rotate(e.get("rotation")),t.translate(-r.x,-r.y);let i=e.bounds;t.translate(i.left,i.top)});let a=e.rotatePoint;t.translate(a.x,a.y);let o=e.get("scale");o&&t.scale(o.x,o.y),t.rotate(e.get("rotation")),t.translate(-a.x,-a.y),n(t,e,r),t.restore()}prerender(t){var{translate:e,scale:r={x:1,y:1},rotation:n}=this.model;t.save(),t.beginPath(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.rect(0,0,t.canvas.width,t.canvas.height),t.fillStyle="black",t.globalAlpha=.5,t.fill(),t.restore(),e&&t.translate(e.x*ot,e.y*ot),t.scale(r.x*ot,r.y*ot),n&&t.rotate(n),t.clearRect(0,0,this.rootModel.get("width"),this.rootModel.get("height"))}render(t){t.beginPath();var e=this.get("scale")||{x:1,y:1},r=this.selected.filter(t=>!!t.parent);if(this.focused&&this._componentDrawer(t,this.focused,e,(t,e,r)=>{this.focusOutline.draw(t,e,r)}),r.length>0&&r[0].parent.isGroup()){let n=r[0].parent;for(;n.parent.isGroup();)n=n.parent;this._componentDrawer(t,n,e,(t,e,r)=>{this.groupOutline.draw(t,e,r)})}r.forEach(r=>{this._componentDrawer(t,r,e,(t,e,r)=>{this.reversedModelers.forEach(n=>n.draw(t,e,r))})})}get eventMap(){return{"model-layer":{"(all)":{change:this.onchange_model,wheel:this.onwheel_scale,drop:this.ondrop}},"(root)":{"(self)":{selected:this.onselected,keydown:this.onkeydown,keyup:this.onkeyup}}}}onkeydown(t){"Alt"==t.key&&(this._control_mode=!0,this.invalidate())}onkeyup(t){"Alt"==t.key&&(this._control_mode=!1,this.invalidate())}onselected(t,e){this.invalidate()}onchange_model(t,e,r){var{origin:n,deliverer:i}=r;n===i&&(t.translate&&this.set("translate",t.translate),void 0!==t.rotation&&this.set("rotation",t.rotation),t.scale&&this.set("scale",t.scale)),this.invalidate()}ondblclick(t){"function"==typeof this.currentModeler.ondblclick&&this.currentModeler.ondblclick(t),this.invalidate()}onmousedown(t){this.currentModeler.onmousedown(t),this.invalidate()}onmouseup(t){"function"==typeof this.currentModeler.onmouseup&&this.currentModeler.onmouseup(t),this.invalidate()}onmouseenter(t,e){this.invalidate()}onmouseleave(t,e){this.invalidate()}ondragstart(t){this.currentModeler.ondragstart(t),this._state_dragging=!0}ondragmove(t){this.currentModeler.ondragmove(t),this.invalidate()}ondragend(t){this._state_dragging=!1,this.currentModeler.ondragend(t),this.invalidate()}ondrop(t,e){var{origin:r}=e,n=t.dataTransfer.files;if(n.length<1)return;let i=this.rootModel.transcoordC2S(t.offsetX,t.offsetY),s=this.rootModel;Promise.all(Array.from(n).map(t=>new Promise((e,r)=>{let n=new FileReader;n.addEventListener("loadend",t=>{e(n.result)}),["error","abort"].forEach(t=>n.addEventListener(t,t=>{r(t)})),n.readAsDataURL(t)}))).then(e=>{if(t.altKey)return Be.around(this.app.commander,()=>{r.ondropfile(n,e)}),void(this.selected=[r]);let a=[],o=e.map((t,e)=>{let r;return n[e].type.startsWith("image/")?(r=ci({type:"image-view",top:0,left:0,width:200,height:200,src:t},s.app),a.push(new Promise((e,n)=>{let i=new Image;i.src=t,i.onload=(()=>{r.set({width:i.width,height:i.height}),e()}),i.onerror=(t=>{n(t)})}))):n[e].type.startsWith("audio/")&&(r=ci({type:"audio",top:0,left:0,width:100,height:100,src:t},s.app)),r&&(r.center=i,i.x+=50,i.y+=50),r}).filter(t=>t).map(t=>({component:t,to_container:s}));o.length>0&&Promise.all(a).then(()=>{this.app.commander.execute(new Ye({changes:o})),this.selected=o.map(t=>t.component)},t=>{console.error(t)})},t=>{console.error(t)})}onwheel_scale(t,e){if(0!=t.deltaY||0!=t.deltaX){var r=e.deliverer;if(t.shiftKey){if(-1!=navigator.userAgent.indexOf("Win"))var n=t.deltaY<0?1:-1;else n=t.deltaX<0?1:-1;Be.around(this.app.commander,()=>{r.selected.forEach(t=>{let e=t.get("fontSize")||ct.FONT_SIZE;e<1&&(e=1),e+=n,t.set("fontSize",e)})})}else{n=t.deltaY<0?1:-1;let e=r.get("scale")||{x:1,y:1},i=r.get("translate"),s=t.offsetX,a=t.offsetY,o=r.transcoordC2S(s,a),l=.1*n,h={x:e.x+l,y:e.y+l};if(n<0&&e.x<.2||n>0&&e.x>10)return;r.set("scale",h);let c=r.transcoordC2S(s,a);r.set("translate",{x:i.x+(c.x-o.x)*h.x,y:i.y+(c.y-o.y)*h.y})}}}});const li=225*Math.PI/180,hi=135*Math.PI/180;function ci(t,e){var r=zt.register(t.type);if(!r)return Object(Z.c)("Class not found",t.type),null;var n=new r(t,e);return t.components&&n.isContainer()&&(t.components.forEach(t=>{var r=ci(t,e);r&&n.addComponent(r)}),delete t.components),n.created(),n}zt.register("tag-layer",class extends on{constructor(t,e){super(t,e),this._anim_alpha=1}_drawArrow(t,e,r,n=10){var i=r.x-e.x,s=r.y-e.y,a=Math.atan2(s,i),o=r.x+n*Math.cos(a+li),l=r.y+n*Math.sin(a+li),h=r.x+n*Math.cos(a+hi),c=r.y+n*Math.sin(a+hi);t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(r.x,r.y),t.moveTo(r.x,r.y),t.lineTo(o,l),t.moveTo(r.x,r.y),t.lineTo(h,c),t.stroke()}animOnTargetChange(t){t!==this._lastTargets&&(this._lastTargets=t,this._anim_alpha=1,this.animate({step:t=>{this._anim_alpha=1-t*t,this.invalidate()},duration:5e3,delta:"linear",options:{x:1},ease:"out"}).start())}render(t){var e=this.targets&&this.targets.filter(t=>t.rootModel);if(!e||0==e.length)return this._animate&&this._animate.stop(),void delete this._animate;var r=!1;e.forEach(e=>{let n=e.get("id");if(t.globalAlpha*=this._anim_alpha,n){let i="#"+n,{left:s,top:a}=e.bounds,{x:o,y:l}=e.transcoordS2C(s,a,e.rootModel);o=Math.max(o,0),l=Math.max(l-18,0),t.font="12px Arial";let h=t.measureText(i);t.fillStyle="#FF0000",t.fillRect(o,l,h.width+6,16),t.fillStyle="white",t.fillText(i,o+3,l+13),r=!0}t.lineWidth=2,t.strokeStyle="orange",e.mappings&&e.mappings.forEach(n=>{let i=this.root.findAll(n.target,e);i&&i.forEach(r=>{let n=e.center,i=r.center;n=e.transcoordS2C(n.x,n.y,e.rootModel),i=r.transcoordS2C(i.x,i.y,r.rootModel),this._drawArrow(t,n,i)}),r=!0})}),r&&this.animOnTargetChange(this.targets)}get targets(){return this._targets}set targets(t){this._targets=t&&t.filter(t=>!t.isLayer()),this.invalidate()}_ontag(t){this.targets&&-1!==this.targets.lastIndexOf(t)||(this.targets=(this.targets||[]).concat(t))}_offtag(t){if(this.targets){var e=this.targets.slice();e.splice(this.targets.lastIndexOf(t),1),this.targets=e}}_resettag(){this.targets=[]}ontagreset(t,e){this._resettag()}ontag(t,e){this._ontag(e.origin)}offtag(t,e){this._offtag(e.origin)}onmouseenter(t,e){this._resettag(),this._ontag(e.origin)}onmouseleave(t,e){this._resettag()}get eventMap(){return{"model-layer":{"(descendant)":{tag:this.ontag,tagreset:this.ontagreset,mouseenter:this.onmouseenter,mouseleave:this.onmouseleave}}}}});var di=13.3,ui={screen:function(t){return void 0!==t&&(di=t),di}};const pi="$base_url";const fi=Math.PI/12;class gi{constructor(t,e){this._mode=t,this.screen=ui.screen(),this._baseUrl="undefined"!=typeof window?window.location.origin:null,this._refProvider=e,this.isEditMode&&(this._rotateStep=fi,this._rotateStepForced=!1)}dispose(){}_calcScreen(){var t={width:screen.width,height:screen.height};this._PPI=function(t,e,r,n){t>0||(t=1),e>0||(e=1),n||(n="d");var i=("d"==n?Math.sqrt(t*t+e*e):"w"==n?t:e)/r;return i>0?Math.round(i):0}(t.width,t.height,this.screen),this._PPM=this._PPI/25.4}get refProvider(){return this._refProvider}set commander(t){this._commander=t}get commander(){return this._commander}get screen(){return this._screen}set screen(t){this._screen=t,this._calcScreen()}get DPPX(){return ot}get PPI(){return this._PPI}get PPM(){return this._PPM}get mode(){return this._mode}set mode(t){var e=this._mode;e!==t&&(this._mode=t,this.trigger("mode",t,e))}get isViewMode(){return this._mode==it}get isEditMode(){return this._mode==st}get baseUrl(){return this._baseUrl}set baseUrl(t){this._baseUrl=t,null!=t&&(cn.a.baseUrl=t.replace(/^(?:http(s?)\:\/\/)?/,"").replace("/rest",""))}url(t){return t.replace(pi,this.baseUrl)}get rotateStep(){return this._rotateStep}set rotateStep(t){this._rotateStep=Number(t)||fi}get rotateStepForced(){return this._rotateStepForced}set rotateStepForced(t){this._rotateStepForced=!!t}}G(gi.prototype,W.withEvent);const mi="left",yi="right",vi="center",xi="top",_i="bottom",bi="middle",wi=[mi,yi,vi,xi,bi,_i];function Ai(t){if(-1!=wi.indexOf(t)){var e=this.selected.filter(t=>!t.stuck);if(!(e.length<=1)){var r=this.app.commander;Be.around(r,function(){!function(t,e){var r=JSON.parse(JSON.stringify(e[0].bounds)),n=r.left+r.width,i=r.top+r.height;for(let t=0;t<e.length;t++){let s=e[t].bounds;r.left=s.left>r.left?r.left:s.left,r.top=s.top>r.top?r.top:s.top,n=s.left+s.width>n?s.left+s.width:n,i=s.top+s.height>i?s.top+s.height:i}switch(r.width=n-r.left,r.height=i-r.top,t){case mi:for(let t=0;t<e.length;t++){let n=e[t].bounds;e[t].bounds={left:r.left,top:n.top,width:n.width,height:n.height}}break;case vi:for(let t=0;t<e.length;t++){let n=e[t].bounds;e[t].bounds={left:r.left+r.width/2-n.width/2,top:n.top,width:n.width,height:n.height}}break;case yi:for(let t=0;t<e.length;t++){let r=e[t].bounds;e[t].bounds={left:n-r.width,top:r.top,width:r.width,height:r.height}}break;case xi:for(let t=0;t<e.length;t++){let n=e[t].bounds;e[t].bounds={left:n.left,top:r.top,width:n.width,height:n.height}}break;case bi:for(let t=0;t<e.length;t++){let n=e[t].bounds;e[t].bounds={left:n.left,top:r.top+r.height/2-n.height/2,width:n.width,height:n.height}}break;case _i:for(let t=0;t<e.length;t++){let r=e[t].bounds;e[t].bounds={left:r.left,top:i-r.height,width:r.width,height:r.height}}break;default:;}}(t,e)})}}}const Ei="VERTICAL",ki=[Ei,"HORIZONTAL"];function Si(t){if(-1!=ki.indexOf(t)){var e=this.selected;if(!(e.length<=1)){var r=this.app.commander;Be.around(r,function(){!function(t,e){var r=e.filter(t=>!t.stuck).slice(0);r.sort(function(e,r){let n=e.center,i=r.center;return t===Ei?n.y-i.y:n.x-i.x});var n=r.reduce((e,r)=>e+(t===Ei?r.bounds.height:r.bounds.width),0),i=r[0].bounds,s=r[r.length-1].bounds,a=((t===Ei?s.top+s.height-i.top:s.left+s.width-i.left)-n)/(r.length-1),o=t===Ei?i.top+i.height:i.left+i.width;for(let e=1;e<r.length-1;e++){let n=r[e],i=n.bounds;o+=a,t===Ei?(i.top=o,o+=i.height):(i.left=o,o+=i.width),n.bounds=i}}(t,e)})}}}function Mi(t,e,r){t instanceof Array||(t=[t]),r||(r=this.model_layer);var n=[];this.selected=t.map(t=>{try{return ci(t,r.app)}catch(t){return console.warn(t),!1}}).filter(t=>!!t).map(t=>{let{left:i,top:s,width:a,height:o,x:l,y:h,cx:c,cy:d}=e;return isNaN(i)||isNaN(s)||isNaN(a)||isNaN(o)||(t.bounds={left:i,top:s,width:a,height:o}),isNaN(l)||isNaN(h)||t.move({x:l,y:h}),isNaN(c)||isNaN(d)||(t.center={x:c,y:d}),n.push({component:t,to_container:r}),t}),this.app.commander.execute(new Ye({changes:n}))}function Pi(){var t=this.selected;this.selected=[];for(var e=null,r=t.filter(t=>!t.isRootModel()&&(t.parent.focusible||t.parent.isGroup())).map(t=>(e||(e=t.parent),{component:t,to_container:null}));e&&e.isGroup();){let t=[];if(e.components.filter(t=>!r.find(e=>e.component===t)).forEach(e=>t.push(e)),t.length>1)break;let n=e.parent;t.forEach(t=>r.push({component:t,to_container:n})),r.push({component:e,to_container:null}),e=n}r.length>0&&this.app.commander.execute(new Ye({changes:r})),e&&e.calculateBounds&&e.calculateBounds()}var Ti=0;function Ci(){var t=this.selected.filter(t=>!t.isRootModel()).map(t=>t.hierarchy);if(0!=t.length)return Ti=0,JSON.stringify(t,null,2)}var Ii=function(){return{escape:function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:e,mimeType:function(t){var r=e(t).toLowerCase();return(n="application/font-woff",{woff:n,woff2:n,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[r]||"";var n},dataAsUrl:function(t,e){return"data:"+e+";base64,"+t},isDataUrl:function(t){return-1!==t.search(/^(data:)/)},canvasToBlob:function(t){return t.toBlob?new Promise(function(e){t.toBlob(e)}):function(t){return new Promise(function(e){for(var r=window.atob(t.toDataURL().split(",")[1]),n=r.length,i=new Uint8Array(n),s=0;s<n;s++)i[s]=r.charCodeAt(s);e(new Blob([i],{type:"image/png"}))})}(t)},resolveUrl:function(t,e){var r=document.implementation.createHTMLDocument(),n=r.createElement("base");r.head.appendChild(n);var i=r.createElement("a");return r.body.appendChild(i),n.href=e,i.href=t,i.href},getAndEncode:function(t){var e=3e4;Yi.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());return new Promise(function(r){var n,i=new XMLHttpRequest;if(i.onreadystatechange=function(){if(4!==i.readyState)return;if(200!==i.status)return void(n?r(n):a("cannot fetch resource: "+t+", status: "+i.status));var e=new FileReader;e.onloadend=function(){var t=e.result.split(/,/)[1];r(t)},e.readAsDataURL(i.response)},i.ontimeout=function(){n?r(n):a("timeout of "+e+"ms occured while fetching resource: "+t)},i.responseType="blob",i.timeout=e,i.open("GET",t,!0),i.send(),Yi.impl.options.imagePlaceholder){var s=Yi.impl.options.imagePlaceholder.split(/,/);s&&s[1]&&(n=s[1])}function a(t){console.error(t),r("")}})},uid:(t=0,function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+t++}),delay:function(t){return function(e){return new Promise(function(r){setTimeout(function(){r(e)},t)})}},asArray:function(t){for(var e=[],r=t.length,n=0;n<r;n++)e.push(t[n]);return e},escapeXhtml:function(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(t){return new Promise(function(e,r){var n=new Image;n.onload=function(){e(n)},n.onerror=r,n.src=t})},width:function(t){var e=r(t,"border-left-width"),n=r(t,"border-right-width");return t.scrollWidth+e+n},height:function(t){var e=r(t,"border-top-width"),n=r(t,"border-bottom-width");return t.scrollHeight+e+n}};var t;function e(t){var e=/\.([^\.\/]*?)$/g.exec(t);return e?e[1]:""}function r(t,e){var r=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(r.replace("px",""))}}(),Oi=function(){var t=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(t,i,s){return e(t)?Promise.resolve(t).then(r).then(function(e){var r=Promise.resolve(t);return e.forEach(function(t){r=r.then(function(e){return n(e,t,i,s)})}),r}):Promise.resolve(t)},shouldProcess:e,impl:{readUrls:r,inline:n}};function e(e){return-1!==e.search(t)}function r(e){for(var r,n=[];null!==(r=t.exec(e));)n.push(r[1]);return n.filter(function(t){return!Ii.isDataUrl(t)})}function n(t,e,r,n){return Promise.resolve(e).then(function(t){return r?Ii.resolveUrl(t,r):t}).then(n||Ii.getAndEncode).then(function(t){return Ii.dataAsUrl(t,Ii.mimeType(e))}).then(function(r){return t.replace(function(t){return new RegExp("(url\\(['\"]?)("+Ii.escape(t)+")(['\"]?\\))","g")}(e),"$1"+r+"$3")})}}(),Ri=function(){return{resolveAll:function(){return t(document).then(function(t){return Promise.all(t.map(function(t){return t.resolve()}))}).then(function(t){return t.join("\n")})},impl:{readAll:t}};function t(){return Promise.resolve(Ii.asArray(document.styleSheets)).then(function(t){var e=[];return t.forEach(function(t){try{Ii.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}}),e}).then(function(t){return t.filter(function(t){return t.type===CSSRule.FONT_FACE_RULE}).filter(function(t){return Oi.shouldProcess(t.style.getPropertyValue("src"))})}).then(function(e){return e.map(t)});function t(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return Oi.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}}}(),Bi=function(){return{inlineAll:function e(r){if(!(r instanceof Element))return Promise.resolve(r);return function(t){var e=t.style.getPropertyValue("background");return e?Oi.inlineAll(e).then(function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))}).then(function(){return t}):Promise.resolve(t)}(r).then(function(){return r instanceof HTMLImageElement?t(r).inline():Promise.all(Ii.asArray(r.childNodes).map(function(t){return e(t)}))})},impl:{newImage:t}};function t(t){return{inline:function(e){return Ii.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||Ii.getAndEncode).then(function(e){return Ii.dataAsUrl(e,Ii.mimeType(t.src))}).then(function(e){return new Promise(function(r,n){t.onload=r,t.onerror=n,t.src=e})})}}}}(),Li={imagePlaceholder:void 0,cacheBust:!1};function Di(t,e){return function(t){void 0===t.imagePlaceholder?Yi.impl.options.imagePlaceholder=Li.imagePlaceholder:Yi.impl.options.imagePlaceholder=t.imagePlaceholder;void 0===t.cacheBust?Yi.impl.options.cacheBust=Li.cacheBust:Yi.impl.options.cacheBust=t.cacheBust}(e=e||{}),Promise.resolve(t).then(function(t){return function(t,e,r){if(!r&&e&&!e(t))return Promise.resolve();return Promise.resolve(t).then(function(t){if(t instanceof HTMLCanvasElement)try{return Ii.makeImage(t.toDataURL())}catch(t){Object(Z.c)(t)}return t.cloneNode(!1)}).then(function(r){return function(t,e,r){var n=t.childNodes;return 0===n.length?Promise.resolve(e):function(t,e,r){var n=Promise.resolve();return e.forEach(function(e){n=n.then(function(){return Fi(e,r)}).then(function(e){e&&t.appendChild(e)})}),n}(e,Ii.asArray(n),r).then(function(){return e})}(t,r,e)}).then(function(e){return function(t,e){return e instanceof Element?Promise.resolve().then(function(){var r,n;r=window.getComputedStyle(t),n=e.style,r.cssText?n.cssText=r.cssText:function(t,e){Ii.asArray(t).forEach(function(r){e.setProperty(r,t.getPropertyValue(r),t.getPropertyPriority(r))})}(r,n)}).then(function(){[":before",":after"].forEach(function(r){!function(r){var n=window.getComputedStyle(t,r),i=n.getPropertyValue("content");if(""!==i&&"none"!==i){var s=Ii.uid();e.className=e.className+" "+s;var a=document.createElement("style");a.appendChild(function(t,e,r){var n="."+t+":"+e,i=r.cssText?function(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}(r):function(t){return Ii.asArray(t).map(function(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}).join("; ")+";"}(r);return document.createTextNode(n+"{"+i+"}")}(s,r,n)),e.appendChild(a)}}(r)})}).then(function(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}).then(function(){e instanceof SVGElement&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e instanceof SVGRectElement&&["width","height"].forEach(function(t){var r=e.getAttribute(t);r&&e.style.setProperty(t,r)}))}).then(function(){return e}):e}(t,e)})}(t,e.filter,!0)}).then(Ni).then(function(t){var{bgcolor:r,width:n,height:i,style:s,sx:a=1,sy:o=1}=e,l=t.style;r&&(l.backgroundColor=r);n&&(l.width=n+"px");i&&(l.height=i+"px");l["margin-left"]="0px",l["margin-top"]="0px",["-webkit-","-moz-","-ms-","-o-",""].forEach(t=>{l[t+"transform"]=`rotate(0rad) translate(0px, 0px) scale(${a}, ${o}) perspective(1px)`}),s&&Object.keys(s).forEach(function(t){l[t]=s[t]});return t}).then(function(r){return function(t,e,r){return Promise.resolve(t).then(function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)}).then(Ii.escapeXhtml).then(function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"}).then(function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+r+'">'+t+"</svg>"}).then(function(t){return"data:image/svg+xml;charset=utf-8,"+t})}(r,e.width||Ii.width(t),e.height||Ii.height(t))})}function Hi(t,e){return Di(t,e).then(Ii.makeImage).then(Ii.delay(100)).then(function(r){var n=function(t){var r=document.createElement("canvas"),{width:n,height:i}=e;if(r.width=e.width||Ii.width(t),r.height=e.height||Ii.height(t),e.bgcolor){var s=r.getContext("2d");s.fillStyle=e.bgcolor,s.fillRect(0,0,r.width,r.height)}return r}(t);return n.getContext("2d").drawImage(r,0,0),n})}function Fi(t,e,r){if(!r&&e&&!e(t))return Promise.resolve();return Promise.resolve(t).then(n).then(function(r){return i(t,r,e)}).then(function(e){return s(t,e)});function n(t){if(t instanceof HTMLCanvasElement){try{return Ii.makeImage(t.toDataURL())}catch(t){Object(Z["c"])(t)}}return t.cloneNode(false)}function i(t,e,r){var n=t.childNodes;return 0===n.length?Promise.resolve(e):function(t,e,r){var n=Promise.resolve();return e.forEach(function(e){n=n.then(function(){return Fi(e,r)}).then(function(e){e&&t.appendChild(e)})}),n}(e,Ii.asArray(n),r).then(function(){return e});function i(t,e,r){var n=Promise.resolve();return e.forEach(function(e){n=n.then(function(){return Fi(e,r)}).then(function(e){e&&t.appendChild(e)})}),n}}function s(t,e){return e instanceof Element?Promise.resolve().then(function(){!function(t,e){t.cssText?e.cssText=t.cssText:function(t,e){Ii.asArray(t).forEach(function(r){e.setProperty(r,t.getPropertyValue(r),t.getPropertyPriority(r))})}(t,e)}(window.getComputedStyle(t),e.style)}).then(function(){[":before",":after"].forEach(function(r){!function(r){var n=window.getComputedStyle(t,r),i=n.getPropertyValue("content");if(""===i||"none"===i)return;var s=Ii.uid();e.className=e.className+" "+s;var a=document.createElement("style");a.appendChild(function(t,e,r){var n="."+t+":"+e,i=r.cssText?function(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}(r):function(t){return Ii.asArray(t).map(function(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}).join("; ")+";"}(r);return document.createTextNode(n+"{"+i+"}")}(s,r,n)),e.appendChild(a)}(r)})}).then(function(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value);t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}).then(function(){if(!(e instanceof SVGElement))return;if(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),!(e instanceof SVGRectElement))return;["width","height"].forEach(function(t){var r=e.getAttribute(t);r&&e.style.setProperty(t,r)})}).then(function(){return e}):e;function r(){function r(t,e){if(t.cssText)e.cssText=t.cssText;else r(t,e);function r(t,e){Ii.asArray(t).forEach(function(r){e.setProperty(r,t.getPropertyValue(r),t.getPropertyPriority(r))})}}r(window.getComputedStyle(t),e.style)}function n(){function r(r){var n=window.getComputedStyle(t,r),i=n.getPropertyValue("content");if(i===""||i==="none")return;var s=Ii.uid();e.className=e.className+" "+s;var a=document.createElement("style");function o(t,e,r){var n="."+t+":"+e,i=r.cssText?s(r):a(r);return document.createTextNode(n+"{"+i+"}");function s(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}function a(t){return Ii.asArray(t).map(e).join("; ")+";";function e(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}}}a.appendChild(o(s,r,n)),e.appendChild(a)}[":before",":after"].forEach(function(t){r(t)})}function i(){if(t instanceof HTMLTextAreaElement)e.innerHTML=t.value;if(t instanceof HTMLInputElement)e.setAttribute("value",t.value)}function s(){if(!(e instanceof SVGElement))return;if(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),!(e instanceof SVGRectElement))return;["width","height"].forEach(function(t){var r=e.getAttribute(t);if(!r)return;e.style.setProperty(t,r)})}}}function Ni(t){return Bi.inlineAll(t).then(function(){return t})}var Yi={toSvg:Di,toPng:function(t,e){return Hi(t,e||{}).then(function(t){return t.toDataURL()})},toJpeg:function(t,e){return Hi(t,e=e||{}).then(function(t){return t.toDataURL("image/jpeg",e.quality||1)})},toBlob:function(t,e){return Hi(t,e||{}).then(Ii.canvasToBlob)},toPixelData:function(t,e){return Hi(t,e||{}).then(function(e){return e.getContext("2d").getImageData(0,0,Ii.width(t),Ii.height(t)).data})},impl:{fontFaces:Ri,images:Bi,util:Ii,inliner:Oi,options:{}}},ji=Yi;function zi(){var t=this.selected;if(0!=t.length){var e=t.map(t=>t.bounds),r=zt.union(e),n=r.left+r.width/2;t.map(t=>{t.symmetryX(n)})}}function Wi(){var t=this.selected;if(0!=t.length){var e=t.map(t=>t.bounds),r=zt.union(e),n=r.top+r.height/2;t.map(t=>{t.symmetryY(n)})}}class Gi{constructor(t,e){!(t=Number(t))||t<=0?(Object(Z.b)("TimeCapsule maxsize should be greater than 0.",t),this.maxsize=10):this.maxsize=t,this.reset(),e&&this.snapshot(e)}dispose(){this.reset()}snapshot(t){this.q.splice(this.pos+1,this.q.length-this.pos+1,t),this.q.length>this.maxsize&&this.q.splice(0,this.q.length-this.maxsize),this.pos=this.q.length-1}forward(){if(this.snapshot_taker&&this.snapshot_taker.take(),this.forwardable)return this.q[++this.pos];Object(Z.c)("Not forwardable.")}backward(){if(this.snapshot_taker&&this.snapshot_taker.take(),this.backwardable)return this.q[--this.pos];Object(Z.c)("Not backwardable.")}get current(){if(-1!==this.pos)return this.q[this.pos];Object(Z.c)("Non state has been recorded.")}get length(){return this.q.length}get forwardable(){return this.pos<this.q.length-1}get backwardable(){return this.pos>0}get snapshot_taker(){return this._snapshot_taker}set snapshot_taker(t){this._snapshot_taker=t}reset(){this.q=[],this.pos=-1}}var Ui=Object(v.b)(t=>{t.brake||t.take()},1e3,{leading:!0,trailing:!1});function Xi(t){!t.brake&&t.dirty&&Ui(t)}class qi{constructor(t,e){this.brake=!1,this.dirty=!1,this.state_holder=t,this.timecapsule=e,this.timecapsule.snapshot_taker=this}dispose(){delete this.state_holder,delete this.timecapsule}touch(){this.dirty=!0,Xi(this)}take(t){(this.dirty||t)&&(this.timecapsule.snapshot(this.state_holder.state),this.dirty=!1)}get brake(){return this._brake}set brake(t){this._brake=!!t,Xi(this)}}function Qi(t,e){var r=e.model_layer.get("scale"),n=e.model_layer.get("translate");if(t){let i=JSON.parse(t);i.scale=r,i.translate=n,e.rebuildContentModel(i)}}class Vi{constructor(t){this.container=t,this.timecapsule=new Gi(20);var e=this;this.snapshot_taker=new qi({get state(){let t=e.container.model_layer.hierarchy;return JSON.stringify(t)}},this.timecapsule),this.snapshot_taker.take(!0)}dispose(){this.reset(),this.timecapsule&&this.timecapsule.dispose(),this.snapshot_taker&&this.snapshot_taker.dispose(),delete this.container,delete this.timecapsule,delete this.snapshot_taker}execute(t,e){!1!==e&&t&&t.execute(),this.snapshot_taker.touch(),this.trigger("execute",t,!0,!1)}undo(){this.timecapsule.backwardable&&(Qi(this.timecapsule.backward(),this.container),this.trigger("undo",this.undoable(),this.redoable()))}redo(){this.timecapsule.forwardable&&(Qi(this.timecapsule.forward(),this.container),this.trigger("redo",this.undoable(),this.redoable()))}undoable(){return this.timecapsule.backwardable}redoable(){return this.timecapsule.forwardable}reset(){this.timecapsule&&this.timecapsule.reset(),this.trigger("command-reset")}}G(Vi.prototype,W.withEvent);var Ki=new WeakSet;var Ji=class{static get residents(){return Ki}constructor(t){this._container=t,this.app=t.app,this._commander=new Vi(this._container),this.app.commander=this._commander,Ki.add(this)}add(){return Mi.apply(this._container,arguments)}duplicate(){return function(){var t=[];if(this.selected=this.selected.filter(t=>!t.isRootModel()).map(e=>{let r=De(e);return r.move({x:20,y:20}),t.push({component:r,to_container:e.parent}),r}),0!=t.length){var e=new Ye({changes:t});this.app.commander.execute(e)}}.apply(this._container,arguments)}remove(){return Pi.apply(this._container,arguments)}animate(){return tt.apply(this,arguments)}fullscreen(){return function(t){var e=this.target_element,r=t||"ratio",n=this;function i(t){n.fit(r),document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"].forEach(t=>document.removeEventListener(t,i))}["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"].forEach(t=>document.addEventListener(t,i)),e.requestFullScreen?e.requestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}.apply(this._container,arguments)}variable(t,e){return this._container.variable.apply(this._container,arguments)}get target(){return this._container.target_element}set target(t){var e;if("string"==typeof t){if(!(e=document.getElementById(t)))throw`target element '${t}' is not exist`;if(e.firstChild)throw`target element '${t}' already has children`}else e=t;e&&e.style&&(e.style.cursor="default"),this._container.target_element=e,this._container.invalidate()}get scale(){return this.root.get("scale")}set scale(t){this.root.set("scale",t)}get translate(){return this.root.get("translate")}set translate(t){this.root.set("translate",t)}get unit(){return this.root.get("unit")||"px"}get PPM(){return this.app.PPM}get PPI(){return this.app.PPI}get DPPX(){return this.app.DPPX}get unitScale(){return this._container.unitScale}get screen(){return this.app.screen}set screen(t){this.app.screen=t,this._container.resize()}resize(){this._container.resize()}dispose(){this._commander&&this._commander.dispose(),this._container&&this._container.dispose()}get selected(){return this._container.selected.slice()}set selected(t){this._container.selected=t}select(t,...e){return this._container.selected=this.root.findAll(t,...e),this.selected}get commander(){return this._commander}undo(){this.commander.undo()}redo(){this.commander.redo()}cut(){return function(){Ti=0;var t=Ci.call(this);return Pi.call(this),t}.apply(this._container,arguments)}copy(){return Ci.apply(this._container,arguments)}paste(){return function(t){if(t)try{JSON.parse(t),Ti++,Mi.call(this,JSON.parse(t),{x:15*Ti,y:15*Ti})}catch(e){Object(Z.b)(e,t)}}.apply(this._container,arguments)}undoableChange(){return function(t){Be.around(this.app.commander,t)}.apply(this._container,arguments)}change(){return function(t,e,r){var n=this.findAll(t,r);return n.forEach(t=>{t.set(e)}),n}.apply(this.root,arguments)}get model(){return this.root.hierarchy}set model(t){this._container.rebuildContentModel(t)}get root(){return this._container.model_layer}findAll(){return this.root.findAll.apply(this.root,arguments)}findFirst(){return this.root.findFirst.apply(this.root,arguments)}findById(){return this._container.findById.apply(this._container,arguments)}serialize(){return this.root.trim(),this.root.serialize.apply(this.root,arguments)}align(){return Ai.apply(this._container,arguments)}distribute(){return Si.apply(this._container,arguments)}move(){return function(t,e,r){this.app.commander.execute(new Ye({changes:[{component:t,to_container:e,to_index:r}]}))}.apply(this._container,arguments)}zorder(){return function(t){var e=this.selected.filter(t=>!t.stuck);if(!(0==e.length||e[0].isRootModel()||e.length>1&&("forward"==t||"backward"==t))){var r,n=e[0].parent;if("forward"==t){let t=n.indexOf(e[0]);r=[{component:e[0],from_container:n,to_container:n,from_index:t,to_index:t+1}]}else if("backward"==t){let t=n.indexOf(e[0]);r=[{component:e[0],from_container:n,to_container:n,from_index:t,to_index:t-1}]}else r=e.filter(t=>t.parent===n).sort((e,r)=>{let i=n.indexOf(e)<n.indexOf(r);return"front"==t?i:!i}).map((e,r)=>(n.indexOf(e),{component:e,to_container:n,to_index:"front"==t?n.components.length-r-1:r}));var i=new Ye({changes:r});this.app.commander.execute(i)}}.apply(this._container,arguments)}symmetryX(){return function(){Be.around(this.app.commander,zi,this)}.apply(this._container,arguments)}symmetryY(){return function(){Be.around(this.app.commander,Wi,this)}.apply(this._container,arguments)}on(){return function(t,e,r){switch(t){case"execute":case"redo":case"undo":case"command-reset":this.app.commander.on(t,e,r);break;case"selected":this.on(t,e,r);break;case"mode":this.app.on(t,e,r);break;default:this.on(t,e,r)}}.apply(this._container,arguments)}once(){return function(t,e,r){switch(t){case"execute":case"redo":case"undo":case"command-reset":this.app.commander.once(t,e,r);break;case"selected":this.once(t,e,r);break;case"mode":this.app.once(t,e,r);break;default:this.once(t,e,r)}}.apply(this._container,arguments)}off(){return function(t,e,r){switch(t){case"execute":case"redo":case"undo":case"command-reset":this.app?this.app.commander.off(t,e,r):this.off(t,e,r);break;case"selected":this.off(t,e,r);break;case"mode":this.app.off(t,e,r);break;default:this.off(t,e,r)}}.apply(this._container,arguments)}get mode(){return this.app.mode}set mode(t){void 0!==t&&(this.app.mode=t)}toDataURL(){return function(t,e,r,n){var i=this.model_layer,s=i._overlay;return new Promise(function(a,o){if(i){var l=i.get("width"),h=i.get("height");r=r||l,n=n||h;var c=i.get("translate"),d=i.get("scale"),u=Math.min(r/l,n/h);r=l*u,n=h*u,i.set("translate",{x:0,y:0}),i.set("scale",{x:u/ot,y:u/ot});var p=zt.createCanvas(r,n),f=p.getContext("2d");if(i.draw(f),i.set("translate",c),i.set("scale",d),!s)return a(p.toDataURL(t,e)),void(p=null);ji.toPng(s,{sx:u,sy:u,width:r,height:n}).then(function(i){var s=new Image;s.onload=function(){f.drawImage(s,0,0,r,n),a(p.toDataURL(t,e)),p=null},s.src=i},function(r){Object(Z.b)(r),a(p.toDataURL(t,e)),p=null})}else o("No target model")})}.apply(this._container,arguments)}group(){return function(){var t=this.selected.filter(t=>!!t.parent&&!t.stuck);if(!(t.length<2)){var e=t[0].parent,r=[],n=t.sort((t,r)=>e.components.indexOf(t)-e.components.indexOf(r));n.forEach(t=>{r.push(t.bounds)});var i=zt.union(r),s=t[0].transcoordP2S(i.left,i.top),a=ci({type:"group",left:(s=t[0].transcoordS2T(s.x,s.y)).x,top:s.y,width:i.width,height:i.height}),o=[{component:a,to_container:e}];n.forEach(t=>{o.push({component:t,to_container:a})}),this.app.commander.execute(new Ye({changes:o})),this.selected=[a]}}.apply(this._container,arguments)}ungroup(){return function(){if(0!==this.selected.length){var t=[],e=[];this.selected.forEach(r=>{if(r.isGroup()){var n=r.parent;r.components.forEach(r=>{t.push(r),e.push({component:r,to_container:n})}),e.push({component:r,to_container:null})}}),this.app.commander.execute(new Ye({changes:e})),this.selected=t}}.apply(this._container,arguments)}fit(t){this._container.once("redraw",()=>this._container.fit(t)),this._container.invalidate()}get ids(){return function(){return Object.values(this.indexMap).map(t=>{let{id:e,data:r}=t.model;return{key:e,value:r}}).sort((t,e)=>t.key>e.key?1:-1)}.apply(this._container)}set data(t){this._container.data=t}get data(){return this._container.data}get variables(){return function(){return Object.values(this.indexMap).filter(t=>"variable"===t.get("type")).map(t=>{let{id:e,data:r,dataType:n="string"}=t.model;return{key:e,value:r}}).sort((t,e)=>t.key>e.key?1:-1)}.apply(this._container)}set variables(t){(function(t){var e=Object.values(this.indexMap).filter(t=>"variable"===t.get("type")).reduce((t,e)=>(t[e.get("id")]=e,t),{}),r=[];t.forEach(t=>{let n=e[t.key];n?(n.set("data",t.value),delete e[t.key]):r.push({type:"variable",id:t.key,left:0,top:0,width:100,height:20,data:t.value})}),Mi.call(this,r,{x:-100,y:0}),this.selected=Object.values(e),Pi.call(this)}).apply(this._container,[t])}get baseUrl(){return this.app.baseUrl}set baseUrl(t){this.app.baseUrl=t}};function Zi({target:t,model:e,style:r,layers:n=[],handlers:i=[],mode:s=it,refProvider:a}){var o=null;if("string"==typeof t){if(!(o=document.getElementById(t)))throw`target element '${t}' is not exist`;if(o.firstChild)throw`target element '${t}' is not empty`}else o=t;return o&&o.style&&(o.style.cursor="default",o.style.overflow="hidden"),new Ji(new ar({target_element:o,model:e,style:r,layers:n,handlers:i},new gi(s,a)))}var $i=new WeakSet;class ts{static get residents(){return $i}constructor(t,e){this.counters={},this.references={},this.creator=t,this.disposer=e,$i.add(this)}dispose(){if(this.disposer)for(let t in this.references)this.disposer.call(null,t,this.references[t]);delete this.references,delete this.counters}get ids(){return Object.keys(this.references)}add(t,e){var r=this;return new Promise(function(n,i){var s=r.references[t];if(s)s===e?i(Error("Reference ID and target duplicate")):e?i(Error("Reference ID duplicate")):n(s);else{function a(e){e=G(e,function(){this.release=(()=>r.release(this))}),r.references[t]=e,r.counters[t]=1,n(e)}if(e)a(e);else{if(!r.creator)return void i(Error("Reference id("+t+") is not allowed. Reference creator should be defined."));r.creator.call(null,t,function(t){a(t)},function(t){i(t)})}}})}get(t,e){return new Promise((r,n)=>{var i=this.references[t];i?this.counters.hasOwnProperty(t)?(this.counters[t]++,r(i)):n(Error("No Reference Count")):e?this.add(t).then(t=>{r(t)},t=>{n(t)}):n(Error("No References for "+t))})}_id(t){for(let e in this.references){if(this.references[e]===t)return e}return-1}release(t){var e=this._id(t),r=this.references[e];r?(this.counters[e]--,0==this.counters[e]&&(this.disposer&&this.disposer.call(null,e,r),delete this.references[e],delete this.counters[e],Object(Z.a)("RELEASED",e))):Object(Z.b)("No Referenced ID")}}var es={},rs={},ns=[];function is(t){var e="SCRIPT"==t.target.tagName?es:rs,r=t.target.src||t.target.href;e[r]=!0,ns.forEach((t,n)=>{let{resolve:i,scripts:s,styles:a}=t;if(e==es){let t=s.indexOf(r);t>-1&&t<s.length-1&&as(s[t+1])}for(let t=0;t<s.length;t++)if(!es[s[t]])return;if(a)for(let t=0;t<a.length;t++)if(!rs[a[t]])return;i(),ns[n]=null}),ns=ns.filter(t=>t)}function ss(t){var e=t.target.src,r="SCRIPT"==t.target.tagName?es:rs;ns.forEach((n,i)=>{let{reject:s,scripts:a,styles:o}=n,l=!1;if(r===es){for(let t=0;t<a.length;t++)if(a[t]==e){l=!0;break}}else if(o)for(let t=0;t<o.length;t++)if(o[t]==e){l=!0;break}l&&(s(t),ns[i]=null)}),ns=ns.filter(t=>t),delete r[e],document.head.removeChild(t.target)}function as(t){es[t]=!1;var e=document.createElement("script");e.onload=is,e.onerror=ss,e.type="text/javascript",e.src=t,document.head.appendChild(e)}class os{static load(t,e){return"string"==typeof t&&(t=[t]),"string"==typeof e&&(e=[e]),new Promise(function(r,n){if((!t||t instanceof Array)&&(!e||e instanceof Array)){var i,s=!0;if(e&&e.forEach(t=>{rs.hasOwnProperty(t)||function(t){rs[t]=!1;var e=document.createElement("link");e.onload=is,e.onerror=ss,e.type="text/css",e.rel="stylesheet",e.media="screen,print",e.href=t,document.head.appendChild(e)}(t),rs[t]||(s=!1)}),t&&t.length>0&&t.forEach(t=>{es.hasOwnProperty(t)?es[t]||(s=!1):i=i||t}),i)as(i);else if(s)return void r();ns.push({resolve:r,reject:n,scripts:t,styles:e})}else n("invalid sources for load")})}}var ls=0,hs=performance.now(),cs=0;function ds(){return ls}requestAnimationFrame(function t(){requestAnimationFrame(t),cs++;var e=performance.now(),r=e-hs;r<1e3||(ls=Math.round(1e3*cs/r),hs=e,cs=0)});var us=a;r.d(e,"polyfill",function(){return"done"}),r.d(e,"create",function(){return Zi}),r.d(e,"Model",function(){return us}),r.d(e,"Layer",function(){return on}),r.d(e,"EventMap",function(){return Oe}),r.d(e,"ReferenceMap",function(){return ts}),r.d(e,"ScriptLoader",function(){return os}),r.d(e,"Scene",function(){return Ji}),r.d(e,"license",function(){return cn.b}),r.d(e,"version",function(){return"0.0.0"}),r.d(e,"FPS",function(){return ds}),r.d(e,"NOTHING",function(){return nt}),r.d(e,"MODE_VIEW",function(){return it}),r.d(e,"MODE_EDIT",function(){return st}),r.d(e,"MODE_SHIFT",function(){return at}),r.d(e,"MAX_UNDO_SIZE",function(){return 30}),r.d(e,"DPPX",function(){return ot}),r.d(e,"GESTURES",function(){return lt}),r.d(e,"KEYEVENTS",function(){return ht}),r.d(e,"DEFAULT",function(){return ct}),r.d(e,"Component",function(){return zt}),r.d(e,"ContainerAbstract",function(){return ce}),r.d(e,"Container",function(){return ge}),r.d(e,"RootContainer",function(){return ar}),r.d(e,"Shape",function(){return or}),r.d(e,"Line",function(){return yr}),r.d(e,"Ellipse",function(){return vr}),r.d(e,"Rect",function(){return wr}),r.d(e,"Polygon",function(){return Er}),r.d(e,"Polyline",function(){return Sr}),r.d(e,"Ruler",function(){return Pr}),r.d(e,"ImageView",function(){return Ir}),r.d(e,"AudioPlayer",function(){return Br}),r.d(e,"Text",function(){return Lr}),r.d(e,"Group",function(){return Fe}),r.d(e,"LocalRef",function(){return Hr}),r.d(e,"GlobalRef",function(){return Nr}),r.d(e,"InfoWindow",function(){return Ur}),r.d(e,"HTMLOverlayElement",function(){return Xr}),r.d(e,"HTMLOverlayContainer",function(){return qr}),r.d(e,"Path",function(){return Qr}),r.d(e,"Triangle",function(){return Vr}),r.d(e,"Donut",function(){return Zr}),r.d(e,"Star",function(){return en}),r.d(e,"Variable",function(){return nn}),r.d(e,"RectPath",function(){return ae}),r.d(e,"ValueHolder",function(){return sn}),r.d(e,"DataSource",function(){return an}),r.d(e,"MoveHandle",function(){return le}),r.d(e,"Layout",function(){return Gt}),r.d(e,"AbsoluteLayout",function(){return Xt}),r.d(e,"CardLayout",function(){return Vt}),r.d(e,"LinearHorizontalLayout",function(){return Zt}),r.d(e,"LinearVerticalLayout",function(){return ee}),r.d(e,"TableLayout",function(){return ne}),r.d(e,"HTMLAbsoluteLayout",function(){return se}),r.d(e,"error",function(){return Z.b}),r.d(e,"warn",function(){return Z.c}),r.d(e,"debug",function(){return Z.a})}});
//# sourceMappingURL=bundle.js.map